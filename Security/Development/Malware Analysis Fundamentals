                    Malware Analysis Fundamentals 
                    Course Notes
  
  
                    Section 1 - Course Overview
1 - Overview
Brief Introduction to the author
Malware Analysis is easier than is usually thought
Quick run through of the syllabus
Students should be familiar with both Windows OS and setting up virtual machines


                    Section 2 - Introduction and Setting up Your Malware Analysis Lab
1 - Introduction
Course overview
The course is intended to take the student from knowing little to being able to analyze malware
Although the focus will be on windows malware the techniques are adaptable to other systems

2 - The Malware Analysis Process
Malware analysis has a process
  - Obtain the malware
  - Analyse the malware using 2 techniques
    - Static Analysis
      - This is analysing the malware without executing it
    - Dynamic Analysis
      - This is where the behaviour of the malware is examined through execution
  -  Report
    - The findings from the analysis are written up
The focus of the course will be on the static and dynamic phases
No tool or technique will give you all the information that you need
You rarely get a chance to analyse a malware sample from top to bottom
In order to get the best result from limited time to analyse you should have a set of questions to ask
  - Is this file malicious
  - How does the malware modify the system
  - Who does the malware contact and why
  - How can the malware be detected and removed
When discussing malware there must be a discussion about packers
Packers are a protection mechanism commonly used by malware
  - They compress or encrypt executable files
  - It also obfuscates program internals such as method signatures, variable names etc
  - They may also contain anti-analysis features
There will be real malware analysed so proper care must be taken

3 - Virtual Machines as Malware Sandboxes
When performing malware analysis you should have a dedicated system
  - One of the best ways to do this is to use virtual machine software such as VMWare
  - This negates the need for an additional physical system
  - Do not allow any malware to communicate over the network or the internet
    - This may alert the author of the malware that it is being analysed
    - If the malware was part of a targeted attack you may reveal that they have been caught
    - Also allowing malware access to the internet may allow it to launch attacks against other systems
  - Host Only Network Mode
    - This is where the guest is on a private network that can only communicate with the host
  - Virtual Machines also have a feature called snapshoting
    - This allows you to save the VM at a specific point in time
    - This means that you can have different snapshots with different versions of tools installed
  - The course will be using Virtual Box as the Virtual Machine software
  - There are some precautions that you should take when using a VM
    - Use a system that you don't care about
    - Segment the lab system from the rest of the network
      - This ensures that the network is doubly protected
      - Also if you give this network its own internet access it will not be tied to your organisation
    - Password protect your samples
    - Defang urls -- EG http becomes hxxp so there is no hyperlinking
  - A lot of malware has anti analysis or anti VM code in it
    - Some malware will check to see if the system hardware matches known VM signatures
  
4 - Hiding Your Virtual Machine
There are things that can be done when setting up sandboxes to get around some of these checks
  - Make the VM look as real as possible
    - Try having dual-core CPU and at least 1gb ram
  - Install software that most end users will install
    - Browsers, office etc
  - Open multiple files and documents
    - There are strains of malware that check how mant documents have been opened
  - Do not install the Guest Addon VM tools
    - This is a giveaway that it is a VM, it may have a negative effect on the VM perform unfortunately
  - Trick the malware into thinking it is online
    - Some malware try to resolve common URL's to come back with a known IP address
    - This may not be possible in certain VM setups
    - There are some different methods to achieving this such as a Sandnet
      - A Sandnet tricks the malware into thinking that it is online by providin things linke DNS resolution
        but it is still segmented
In the course there is an example Sandnet used
  - The Fakenet tool is installed into the Sandnet
    - https://practicalmalwareanalysis.com/fakenet/
    - https://sourceforge.net/projects/fakenet/
  - This tricks the malware into thinking that it is online
  - It intercepts traffic using multiple protocols such as HTTP, SMTP and more
  - Fakenet logs connections and creates a PCAP file which can be used in Wireshark
VM Installation checklist
  - Install your OS and all patchers
  - Install and run your analysis tools
  - Set-up host only networking
  - Perform any additional maintenance tasks
  - Taks snapshots of the VM

5 - Demo Configuring a Virtual Machine for Malware Analysis
Configuring an example VM
  - The course uses VirtualBox but other software is ok
  - Example VM uses Windows 7 64 bit
    - 1gb ram, 2 CPU
    - Host Only networking
    - Use shared folders to share files in or out
      - use a folder that is not important
  - In the vm disable services that interfere with analysis
  - Use the fakenet application to fool malware
    - change the dump option to yes in the config file
    - It requires elevated privilige
    - Output files will be text and pcap

6 - Conclusion
A quick roadmap of the material to be covered in the rest of the course



                    Section 3 - Static Analysis Identifying Malware
1 - Introduction
A quick overview of the chapter material

2 - Static Analysis
Static Analysis techniques analyse the malaware without executing it
  - It will give glimpses of what the malware can do
There will still need to be a focus during Static Analysis
  - What kind of file is this
  - Is there any information already known about it
  - What do the embedded strings say about it
  - Is there anything unusual in the PE header
  - If it is paked which packer was used
Static analysis can still cause the malware to execute so be careful!!
Always analyse your tools as much as malware
  - This shows you how tools work
  - Ensures that there are no backdoors in the tools

3 - Our Malware Scenario

4 - File Identification

5 - File Identification Tools

6 - Cryptographic Hashing

7 - Demo File Identification and Hashing

8 - Conclusion


                    Section 4 - Static Analysis Analyzing Embedded Strings 
1 - Introduction

2 - Embedded Strings

3 - Strings Analysis Tools

4 - Demo Embedded Strings Analysis

5 - Hiding Strings

6 - Demo Finding Hidden Strings

7 - Conclusion

      
                    Section 5 - Static Analysis Understanding the PE Header   
1 - Introduction

2 - Windows PE Header

3 - PE Sections

4 - Import Address Table

5 - Resources

6 - PE Header Analysis Tools

7 - Demo PE Header Analysis

8 - Conclusion


                    Section 6 - Lab 1 Static Analysis
1 - Lab Introduction

2 - File Identification Lab Result

3 - Embedded Strings Analysis Lab Results

4 - PE Header and Hashing Lab Results

5 - Summary and Conclusion


                    Section 7 - Dynamic Analysis Considerations
1 - Introduction

2 - Dynamic Analysis Considerations and Cautions

3 - Operating System Behaviors

4 - Malware Persistence and Autoruns

5 - Autoruns


                    Section 8 - Dynamic Analysis Detecting Malware System Changes
1 - Introduction

2 - Detecting System Changes and Tools

3 - Detecting Changes Demo

4 - Conclusion


                    Section 9 - Dynamic Analysis Monitoring Malware Behavior
1 - Introduction

2 - Process Monitor

3 - Monitoring Malware Behaviour Demo

4 - Running Your Tools At The Same Time

5 - Conclusiion


                    Section 10 - Dynamic Analysis
1 - Introduction

2 - Dynamic Analysis Demo

3 - Conclusion


                    Section 11 - Progressing Your Malware Analysis Skills
1 - Introduction

2 - Course Recap

3 - Where To Go From Here

4 - Conclusion
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    

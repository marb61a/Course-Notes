                    Firewalls and SELinux
                    Course Notes


                    Section 1 - Introduction 
1 - Welcome to firewalls and SELinux 
Brief intro to the course and the author

2 - Prerequisites 
There are some pre-requisites for students taking the course
  - Use a test system or vm
  - Do not use a live system
  - Have some experience with Linux
  - The course uses Fedora 25 as its distro



                    Section 2 - Firewall Basics on Linux 
1 - Iptables and Firewalld 
Firewalls can be complex and complicated
  - On the Fedora distro being used this is even more true
  - This is because of the fact that there are many open sources add-ons
  - Some of these directly interact with the kernel
  - Firewalls will use Netfilter which is in the core of the networking system
    - Netfilter cannot be directly configured, tools are needed
  - There are 2 different conflicting tools available IPTables and Firewalld
IPTables
  - This has been in existence longer
  - It may become deprecated
Firewalld
  - Is newer and runs on the basis of a different security metaphor
  - It is also thought of as being easier to configure
These 2 systems cannot work together on the same system at the same time
  - There are some mutual exclusion rules which need to be added and are covereed by the course
Example Syntax
  // To see if IPTables is running on the system
  $ sudo -s                                 // This enters the system into an elevated privilige (sudo) session
  # systemctl status iptables               // This checks whether IPTables is running, the hash symbol indicates a root user
  # ls -Fla iptables                        // This will show more detailed information about whether IPTable is installed
  # systemctl mask iptables                 // IPTables will need to be masked out to prevent it running by itself 
  
  # systemctl stop iptables                 // Some systems will have IPTables running so this stops it

2 - Installing Firewalld 
To ensure that you have it Firewalld installed
On Fedora Systems
  - dnf install firewalld
  - dnf has replaced yum as package manager since Fedora 22
  - firewalld is written in Python

3 - Installing the Firewalld GUI controls 
To run the firewalld gui
  - # firewall-config
  - This might need packages to be installed
    - There will be a demo on systems both with and without GUI
    - The firewall-config utility is not installed by default

4 - Installing GUI controls with no GUI 
To install the firewall-config utility from the terminal
  - dnf install firewall-config

5 - Understand Firewalld zones 
Zones will need to be properly understood in order to correctly configure the service
  - A zone defines the level of trust for network connections
  - These are one to many relations
  - A connection can only be part of one zone
  - One zone can be used for multiple connections
To get a list of supported zones from firewalld at the terminal
  - firewall-cmd --get-zones
To see which have enabled features
  - firewall-cmd --list-all-zones

6 - Understand Firewalld services
A firewalld service is defined as
  - A list of local ports and destinations 
  - It is also a list of firewall helper modules automatically loaded if a service is enabled
This makes it convenient to see what TCP/UDP ports are being used by your programs
To see which services are installed by default
  - firewalld-cmd --get-services
  - This will probably need to be ran in a root session
  - This saves having to remebering port numbers for various applications

7 - Zones explored 
This is done while in a root session
To see which zones are available
  - firewalld-cmd --list-all-zones
  - To navigate up through the list use shift-function key-up arrow
  - Masquerading means that Network Address Translation is either turned on or off
When using the firewall GUI, depending on the distro it will be available in the application tray
  - The output is the exact same as the command line, it is just a different way of looking at the same information
  - Depending on the individual they may prefer the GUI over the CLI



                    Section 3 - Configuring Firewalld for Local Protection 
1 - Firewall-cmd configuration preparation 
Again this will be at the CLI and will require a root session
If a zone is not specified it will be assumed to be the default
To see which is the default zone
  - firewalld-cmd --get-default-zone
To change the default zone to something else
  - firewalld-cmd --set-default-zone=value

2 - Allowing the Apache web server 

3 - Allowing any mail server 

4 - Allowing an XMPP server 

5 - Allowing an SMB server 

6 - Allowing an NFS server 

7 - Allowing an LDAP server 

8 - Allowing a PostgreSQL server 

9 - Allowing FTP and SFTP servers 

10 - VM Port Forwarding 

11 - ShieldsUP! panic mode 


                    Section 4 - SELinux Fundamentals 
1 - Installing SELinux utils 
The course throughout uses Fedora 25
  - That includes the server and desktop versions
  - SELinux comes as default in Fedora 25
    - It is also installed in RHEL, CentOS and Gentoo distos to name a few
  - There are however some pieces missing from the installation
  - SELinux can run in multiple modes
    - It uses policies to define operations
    - It uses targeeted policy as a default
To see if SELinux is on the system from the terminal
  - Set up a sudo session -- sudo -s
  - To query whether the package is installed -- rpm qa | grep selinux
    - This will show all instances where SELinux is used
  - You will need to install a package that is not there by default
    - SETroubleshoot-server which includes SE-alert
    - These packages work to troubleshoot denials and are recommended by the instructor
    - To install use -- dnf install setroubleshoot-server
    - There may also be dependencies needed on a system so they should be installed
  - There are another couple of utilities that are used in the course that aren't installed by default
    - dnf install policycoreutils-python
    - dnf install policycoreutils-gui
  - You may wish to reboot the system after the installations
    - This can be done with typing reboot at the terminal
    - This maybe easier than reloading services individually so that changes take effect

2 - Discretionary vs. mandatory access 

3 - Understanding contexts 

4 - Installing SELinux man pages 

5 - Understanding Booleans 



                    Section 5 - Working with SELinux 
1 - Enabling SELinux and modes 

2 - Graphical management tools 

3 - Changing context labels 

4 - Changing ports on services 

5 - Copying files 

6 - Moving files 



                    Section 6 - SELinux Troubleshooting 
1 - Running sepolicy 

2 - Finding SELinux logs 

3 - Making domains permissive 

4 - Disabling and reenabling SELinux 



                    Section 7 - Conclusion 
1 - Next steps 
Some suggested next steps for students to take after completing the course

Some recommendations for how to continue and a thank you from the instructor

                    Web Application Penetration Testing
                    Course Notes Part 8


Module 3 : Information Gathering (Cont)
Gathering Information on Your Targets (Cont)
  - Nslookup is another very handy tool that lets you translate hostnames to IP addresses and vice versa
  - There are different ways of running for different OS
    - On Windows click Start -> Run -> cmd -> nslookup google.com
    - On *nix open a console and type nslookup google.com
  - The previous query is referred to as a lookup or as seen previously, it is an "A"
    - If you provide a domain name, DNS returns the IP  addresses for the matching hosts
  - If you provide an IP address, DNS returns the domain name associated with that IP
    - 172.194.113.224 is the IP address found for the above lookup
  - Trying to query the DNS of google for the whole record
    - nslookup -querytype=ANY google.com
    - The previous command returns the following important information
      - Name Servers, CNAME's, A Records, MX
    - This information should be saved for the subsequent steps of your penetration testing engagement
  - Every IP address on the Internet is assigned to an organisation
    - An organisation can purchase a block of IP addresses according to their needs and it will "own" that entire block
    - The whois database tracks the owners of public IP addresses as well as domain names
  - Sometimes organisations are not  the owners of the IP addresses they use for their presence on the internet
    - They may just rely on ISPs and hosting companies that lease one or more smaller netblocks to them
    - Finding the netblock owner and the ISPs our target relies on is an important step in testing
  - Another example of nslookup this time is to know know which ISP's, hosting and IP addresses our target uses
    - Using Nslookup we get the IP addresses associated to each subdomain
    - We will perform a whois request for each of these IP addresses to uncover the ISP's that these IP addresses belong to
    - When the organisation is big, net-blocks may be assigned directly to it, so no Hosting services are involved
    - The first step is to gather all the IP addresses related to a domain or subdomain
    - Example uses statcounter.com so the first step is nslookup statcounter.com 
      - There should be 2 ip addresses registered for that particular domain which need to be stored
      - Use the nslookup www.statcounter.com to see if the sub-domain has different IP address
      - In this case there are a further 2 which should also be stored
      - The next steps is to check the IP addresses and the ISP's they come from
      - There are several tools such as whois.domaintools.com 
      - This process should be done for all IP addresses
      - At the end of this process, we can build a table with all the IP addresses used by the target and the ISP's they belong to
    - All of this should be added to the pen testing documentation
    - There is a quicker way of doing this which combines several steps
      - Using the Netcraft site and doing a search for statcounter.com
      - This will reveal the Hosting provider for statcounter.com as well as its IP netblock

Infrastructure 
  - The infrastructure behind a web application is what supports it and allows it to function
    - This includes the web server that is directly involved in the execution of any web application
    - The two most common web servers used on the internet today are Apache and Microsoft IIS
  - Discovering what kind of web server is behind your application will give you a hint about what OS the server is running 
    - This in turn shows what vulnerabilities could be applied
    - For example discovering an IIS (Internet Information Service) web server will tip us off that the server is running an OS in the Windows Server OS family
      - These guesses are correct in 90% of the cases when dealing with IIS and Windows Server 
      - This is different in the many different Linux and BSD distributions which may run different Apache versions
  - Although hacking into the server operating system is beyond the scope of our web application test engagement
    -Having a clear understandin of the infrastructure will be really useful in the next testing steps
  - Uncovering both the web server type and version will give us enough information to mount many different attacks against its components 
    - IIS components, usually called ISAPI extensions, work as dynamic libraries
      - These extend the functionalities of the web server and performing different tasks for the web server
      - There are differnt types such as URL rewriting, load balancing, script engines and others
      - A rewriter changes "ugly" web application URLs such as  news.php?id=12 to a more search-engine-friendly URL like news/12.html 
      - An IDS is a web application firewall that detects and prevents intrusions coming from the HTTP/S protocol
    - The presence of the above 2 modules can alter the results of tests significantly
      - This is why performing a careful fingerprint of the web server and its components can be very beneficial
  - Sometimes the simplest way to find the web server version in through HTTP response headers where the information may be leaked
    - The server response may contain a value in the Server field
    - There may not be a version of the web server, just the name
      - Version information is important  to understand the level of exposure to known vulnerabilities
  - Finding version information may be done using the Netcraft site
    - https://www.netcraft.com/
    - It provides web server analysis via its enormous information database
    - Also provided is web server version, name server and IP addresses of the different web servers in use
    - Netcraft may be very useful not only for web server fingerprinting but also for subsequent steps like collecting all available subdomains for a domain
    - The Netcraft site report shows the webserver and historical OS information about the domain 
    - Companies such as Microsoft use a server farm and the HTTP request may be routed to different web servers based on load and availability 
    - This must be taken into account when we perform our web application tests
  - It is not uncommon to find corporations or even small businesses using load balancers 
    - These route HTTP request to different servers that may even run different web servers versions
    - The advice here is to take note of all web server version-to-IP couplets for further use
  - The Nameserver is the DNS server that replies to all lookup queries regarding the namespace of a domain
    - An nslookup query for microsoft.com involves a request to ns1.msft.net
    - nslookup -type=NS microsoft.com 
  - In addition to web server version, IP addresses and Nameservers, Netcraft provides information on Server Versions, Uptime Stats and more
  - Sometimes Netcraft does not provide us with enough information regarding our target web server version
    - In addition, there are cases where Netcraft cannot be used like in the case of Internal Web Servers that are not attached to Internet
    - When this is the case, we can use both manual testing techniques and tools to identify a server
      - These include netcat, httprint, whatweb, wappalyzer
    - Some of these freely available tools rely on common web server characteristics in order to accurately identify them
    - They probe the web server with a series of requests and compare the responses to their database of signatures 
    - This is to find both a match and, accurately guess Web Server version, Installed modules and Web enabled devices
    - The most important feature of these tools is that they do not solely rely on the service banner
    - They are capable of fingerprinting the web server version even when the banner has been obfuscated / altered using security modules 
  - The first tool to inspect is Netcat
    - This is a simple utility that reads and writes data across network connections
    - By using Netcat we can establish a connection to the Web Server and look at the Server field in the HTTP response header
    - To use Netcat against an IP address simply type nc <ip address>
    - Once we establish the connection with netcat, we have to send  HEAD / HTTP/1.0 and hit enter two times 
    - Beyond the Server header we should also look at the  X-Powered-By header, which may reveal the technology behind the Web Application
    

                    AZ900 Microsoft Azure Cloud Fundamentals 2021
                    Additional Material Course Notes Part 26


Resource Tagging and the Portal(Cont)
  - Currently this virtual machine has two. Project : ABC is the first tag and CostCenter with the value of YHZ is the second one
    - We can even add a third one here. for example, we might tie it to a department
    - We are going to put it Department, if we've already created that, as we start typing it'll show up.
    - However, nothing's popping up so this is a brand new tag we are creating, we are going to set the Value to IT.
  - We've now got a third tag that we are adding here to this particular resource
    - We can go back and remove any one of these at any point in time, so click Save
    - So now that we've got those listed, we see the third one has been added at the bottom
    - If we were to go to another resource, let's close out of this virtual machine
    - Let's just pick a storage account and let's look at the tags for it.
    - When we click on Tags, we'll see whatever it's been tagged with already.
  - Bear in mind, Azure administrators can apply policies that can add default tags. So there might be times when you're creating a resource and you don't add tags. And after you check it, after it's been created, there are tags. That's because of a policy. Anyway, here we can see this storage account has CostCenter : YHZ. If I were to type department, we'll notice it already knows it exists. And in the same way, it knows it's already got a value that's been typed in for another resource. And that's fine, we can go ahead and work with that.
When I click that, it's kind of like a little filter, Now, notice that we've also got a little square icon also over here, and it allows me to show resources with this tag. So let's do it for the first one here, CostCenter : YHZ.
it'll show me resources that have been tagged with that item. So specifically, we can see that all of these items are listed here. And let's just kind of move over a little bit so we can see them all. So they're all listed here as being items that are tagged with that same value. So we can see at the top here, Resources with tag CostCenter : YHZ. Now when you're creating a new resource, for example, let's just get out of here, we're not going to save that. I'm going to click Create a resource.
Let's say we were going to create a brand new storage account. It could be anything but let's say that's what it was.
Now when you're in the midst of creating a new resource in Azure, during the creation, whether in the GUI or at the command line, you can specify tags.
    - We can see the Tags part of the wizard right here.
  - When you go there, it's going to look familiar, you can put in the name and value, up to 50 of them
    - Okay, so we can do that as well. Let's go back to our All resources view.
  - Because another aspect of working with tags in the GUI here in the portal, is that you can modify a selection of objects in terms of tagging
    - What that means is if we were to, let's say, put check marks by a couple of these resources
    - We can then click the Assign tags button up at the top of the view.
  - Within here, I'll see each of the selected items listed and I can delete tags and make changes. But I can also add one up here. So for example, if I wanted to, I could put in a tag, let's call it Stage. And for Value I'm going to put in Testing.
    - It's the testing stage that we are applying to this and we are going to go ahead and click Save.
    - If we look at any one of these items, let's say this storage account, this second one here that was part of our initial selection.
  - We can also see it says it assigned it to three resources. But let's just check this one anyway
    - Go to Tags, we'll see whatever was already applied previous to my last action.
    - But we will also see that Stage was added with the value of Testing.


Resource Tagging and the CLI
  - The CLI can prove very handy when it comes to manipulating tags in an Azure environment. 
    - To get started here, we are going to type in az tag list
    - When we do that, it should show me details about all of the tags in this entire subscription, but there's too much metadata here.
    - All we really want to see are the names of tags, so clear the screen, use the up arrow key to bring up that previous command.
  - We are going to use --query [ ] because it's an array or list of items. And for each of them, we want to see tagName, where Name has a capital N.
  - That's better. So now I can see the names of tags, not the values that have been applied in my entire subscription. I want to add a new one. So I'm going to run az tag create. And I want to create one, --name, called ClientID. We might want to do this if we want to track resources based on clients, for doing projects for clients, for billing purposes, for chargeback to clients.
    - What we've done is created the tag called ClientID.
    - We can verify this, of course, if we bring up, using the up arrow key, our az tag list command where we're querying for tagName.
  - There's ClientID shown at the bottom of the list, perfect
    - Now we want to add a value for the ClientID tag and then we can apply it to a resource
    - To add a value, we are going to run az tag add-value --name, well, the name of the tag is ClientID and --value, set it to a value of 1234.
  - We want to apply that to a resource. So to do that, we are going to use, let's say, az network vnet update
    - We are going to apply this to a VNet, a virtual network, that's deployed in a group, -g, called rg1, resource group 1. -n for the name of the VNet
    - Is Vnet1, and --set tags. in this case ClientID, of course we could also specify the value here, 1234, that we want to add to that VNet.
    - By adding the value up above, what we're really simply doing is making it available to be assigned to individual resources.
  - If we flip over here into the portal where we've pulled up the tags for Vnet1
    - We indeed will see that ClientID with a value of 1234 has been successfully added.


Resource Tagging and PowerShell
  - You can use PowerShell cmdlets to manage tags in an Azure environment.
    - To get started, we want to make sure we get a handle on a specific storage account that we've already created
    - We want to store that in a variable that we are going to call storacct, we can see here $storacct
    - We are going to tell it that we want to run get-azresource-resourcename
    - Here's the name of the storage account we have, it's in a resource group called rg1,
    - We want to do this because we want to apply tags to that storage account.
    - Now let's just run $storacct to make sure we have a handle on that storage account
    - Looks good and currently we can see the tags for it CostCenter YHZ.
  - Now what we want to do is add something new
    - We are going to go ahead in terms tags and run $storacct
    - We have that variable the points to the $storacct.tags.add
    - In parenthesis and we will start double quotes
    - We want to set the Stage key with the value of Development and we are going to go ahead and press Enter.
  - Now let's just clear the screen with cls and use the up arrow key to bring up our $storacct variable
    - Notice that Stage and Development the key and value pair have been added as a tag for that storage account, we can also do other stuff like this.
  - In parenthesis get-azresource -tag, we are going to specify here an @ symbol with an open curly brace
    - In quotes we are going to say Stage and = Development put all of the each of these items in quotes
    - The next thing we are going to do is close off my curly bracket and my parentheses and .Name
    - What does this mean? Well, it means that what we want to do is to show the names of any Azure resources that have that listed tag name and value
    - So "Stage"="Development", when we press enter, we still don't see anything here.
  - Well, that's strange because when we looked at our variable, it returned Stage Development
    - Well, that's the variable, it's not been committed to Azure yet
    - What we need to do is run set-azresource to apply the change -tag, and then $storeacct.tags the tags property
    - Because we know that the tags property here contains what we just modified plus what was already there to begin with
    - So, $storeacct.tags -resourceid give it the resource ID that's going to be $storeacct.resourceid
    - Great working with variables isn't it makes things much easier
    - We'll just use -force to suppress any questions, after that's done, it will have committed that change to that resource.
  - We are going to clear the screen we're going to use the up arrow key to get-azresource once again, we can see our storage account storacct333325.
    - Indeed is tagged with "Stage"="Development".                    


Azure Monitoring Overview
  - In order to keep your Azure environment secure and running optimally, you should perform monitoring.
    - In order to monitor something to determine if something is abnormal, you need to know what is normal
    - That's where monitoring baselines kick in, whether it's for determining what normal activity looks like at the network level
    - For the amount of network transmissions, for example, what is normal when it comes to activity on a host
    - Such as how much memory is usually used within normal workload conditions, or how busy the CPU is
    - That also goes for an application, which could be spread out across multiple virtual machine hosts
    - Monitoring baselines will vary from one company to another, even from one department within an organization to another
    - Depending on how technology is being used. So an anomaly from the normal usage could indicate a security incident
    - It could just be a normal spike in activity, but if we gather enough activity over time, we'll know that that occurs.
  - So a security baseline then can be used to detect anomalies
    - Performance baselines can also be used simply to detect that things are busy or that they have slowed down
    - In response we might resize virtual machine instances
    - Or configure autoscaling accordingly to accommodate the increase or decrease in those workloads
    - So baseline anomalies could show up as busy CPU utilization
    - Which could be indicative beyond of just a busy workload of cryptocurrency mining, if the machine has been infected, or ransomware
    - If we have excessive network traffic way beyond normal that could be indicative of a distributed denial of service or a DDoS network attack
    - Or we might have device operating system changes while the hardware is the same
    - Now that would mean that we might have a Windows host that is all of a sudden a Linux host, but everything else about it looks the same
    - So that could be indicative of someone having infected the machine or maybe booted it from a USB drive into a different OS, and so on
    - The other thing to think about is system and data access outside of regular work hours at irregular times
    - So there are a lot of different aspects of Azure resources that we might monitor to determine if there's an anomaly of some kind.
  - Now Azure monitoring gives us a number of options to track this stuff, including centrally
    - So we can monitor Azure resource activity logs
    - Now these activity logs are essentially audit logs of management tasks applied to Azure resources
    - Such as starting and stopping a VM or reconfiguring a VM or a web app
    - We can also look at the Azure Performance Diagnostics Windows VM extension
    - If you enable performance diagnostics, then you're getting more details on metrics like CPU utilization and traffic in and out
    - Disk I/O activity, for monitoring purposes, you can also pin a lot of these items to custom dashboards
    - So that you can pull up a dashboard and see what's of relevance for you when it comes to monitoring your Azure environment
    - You can also work with Azure Application Insights if you want to track activity and performance metrics for a specific web app
    - So that's really what that one is about.
  - Here on the screen we have a screenshot of monitoring some performance metrics for an individual VM or virtual machine
    - We can see the CPU average utilization, the network traffic total, the disk bytes total, the disk operations per second on average
    - These are important metrics to monitor. However, we can also monitor things centrally 
    - Instead of doing this and going to an individual Azure resource, in this case a VM.
  - That's where Log Analytics workspaces kick in. This is centralized monitoring of Azure log data and also performance metric data
    - Configuration and log data feeds into Azure Monitor from the Log Analytics workspace
    - You can also run log queries in the Log Analytics workspace
    - Or from Azure Monitor, again, because Azure Monitor gets a lot of its data from Log Analytics workspaces
    - Your alert notifications can be configured in the Log Analytics workspace
  - Now, there are a number of data sources that Log Analytics workspaces draw upon
    - Including storage account logs, Azure activity logs, physical and virtual servers
    - And you can even link it to your existing System Center Operations Manager or SCOM environment, if you have one
    - By adding servers to the Log Analytics workspace
    - It means that their performance metrics and log data can be collected centrally in the Log Analytics workspace.


Individual Resource Monitoring
  - There's a wealth of information available for each and every Azure resource whether you're interested in monitoring the performance of an item or auditing who did what to it from a management perspective or viewing things like operating system log details for VMs. 
All of this is available here in the portal. So I'm going to start in the portal by clicking to open up an existing virtual machine.
And the first thing we're going to do is click on the Activity log on the left.
This is a log that really only relates to the management of this resource in Azure. And so on the right the default Timespan is the Last 6 hours. Let's get more stuff shown here by changing that, let's say, to the Last month and I'll click Apply.
Now we'll see that there are quite a few other operations related to the management of this VM. When we filter in that way we can see the name of the operation, whether it succeeded or not, the date and time stamp, the subscription it applies to and the user that initiated it. We can also further filter this. So for example, for Event severity, let's say the only thing I'm really interested in are Critical and Error messages, I'm not interested in seeing Warning or Informational.
So I can unselect those or deselect them and now I've got a really small filtered list. And I can click on any one of these specific activity log entries to get more detail.
Now, we also have other options for monitoring here.
I'm going to scroll way down in the navigation bar down to the Monitoring section where I'm going to click on Metrics. This is more related to the performance in this case of the VM.
So we can select a metric from the drop-down list. For example, I'll just go down in this list and choose Percentage CPU.
Now the Percentage CPU item is added here and we can see its value. We can see it's been plotted against the timeline on the bottom, and the percentage going across the top, from the bottom to the top.
We can also add metrics, you have more than one thing shown at the same time.
So I'm going to go ahead and maybe and add Disk Read Bytes/second. And when you do that it will be plotted.
You'll see it might have a value. So we can see the values are being plotted but notice in the legend it's a different color. So this could be very important as well.
So we can monitor these metrics to track how this is doing. So performing well, do we maybe need to resize the VM, maybe scale it up so it can handle the workload better? That type of thing. We can also go to Logs over on the left.
Now it's not enabled by default, so I'm going to go ahead and click the Enable button. Now when you do that, you're going to have to select the subscription and a Log Analytics workspace that you want this associated with. So I'm okay with the default selection for the Log Analytics workspace. So I'm going to go ahead and click Enable.
Once that's enabled and you're still in the Logs blade, over on the right you'll see that things have changed.
You've got a query builder tab at the top here, it's called New Query 1. So this is a log query and down the left, you have a bunch of table names that you can select from.
 Now if you expand any of these table names, what you will be exposing are the fields or columns within those tables.
And you can see the data type is string or whatever it happens to be depending on the nature of what you're looking at. You can actually start selecting items.
So for example, if I double-click on one of these items, such as a column, I could see it puts it in here over on the right.
But of course you can also select from some example query. So if I go to Performance and availability, I could start scrolling down and saying maybe I want to view Virtual Machine available memory and I could run that.
It puts in the query statement here, where for example, the name of the table which is case sensitive is Perf. And then I'm piping that to where and I'm asking for TimeGenerated over an hour ago and so on and you can run the query by clicking Run. If there are no results, then you're going to get a message that says there are no results. Otherwise, you'll see some of the details. So this is one thing that we can do here, work with log queries within an individual resource. Let's go up to Diagnostic settings here for this Windows virtual machine.
So I've got a storage account selected here for storage.
And I'm going to choose Enable guest-level monitoring.
The next thing I can do is determine under Overview, for example, which performance counters I'm interested in gathering. There are some default selections.
I can go to Logs and determine which operating system logs I'm interested in and some details.
So for example, I'm interested in the Application log with Critical, Error, Warning types of events, severities. And I could do the same type of thing for the Security and System logs. And I can even ask for additional items like IIS web server logs if there is one available there.
And I can save all of these settings.
So when you enable the diagnostic settings, you're really saying I want to start to get more details of the inner workings of the workloads running in those, well, in this case in this VM.


Log Analytics Workspaces
In Azure, a Log Analytics workspace is a resource that you can create and configure in the Azure environment.
To get started here in the portal, I'm going to look at my All resources view. And I'm going to filter it for objects that are Log Analytics workspaces because I already have some here.
So I'm going to filter for Log Analytics workspaces, click outside of it. Here I can see I've got a couple of them. Now why would you have more than one Log Analytics workspace? Here I've got some for different regions or locations, Canada Central I see under the Location heading and East US.
Well that's one reason, you might want to have your centralized logging through the Log Analytics workspace per region. But you could have multiple Log Analytic workspaces within the same region. Maybe because you have different monitoring requirements for different resources within the same region. So to get started to add a new Log Analytics workspace, I'm going to click the Add button.
And I'm going to search up log analytic, and there it is.
Now I'm going to select Log Analytics and choose Create.
First thing I have to do is create a name for it or specify a name. So I'm going to call it LogAnalytics-2.
I'm going to deploy this into an existing resource group.
Now, up above, it's kind of outlined my name in red, in a red outline, because that name is taken. And so I'm going to put in some characters to make that a unique name and I'll kind of click outside of it. And now the name is unique.
So make sure you adhere to your naming standards within your organization when you change some of these names. I'm going to specify the location where I want this specific Log Analytics workspace. So I'm going to choose Canada Central.
I'm going leave it with my Pay-as-you-go subscription for the pricing tier and I'm going to choose OK.
And now back here in the All resources view, I can see my newly created Log Analytics workspace.
So I'm going to go ahead and click on it to open it up. Because one of the first things that you really should contend with is which data sources are connected. To your newly created Log Analytics workspace.
Because remember, this serves as a centralized performance metric and log data feed. Where's that coming from? Well, we can scroll down and go under Workspace Data Sources. Here we can click Virtual machines and we're going to see all of the virtual machines that we've got deployed.
But I can see here that they are connected to other workspaces.
So I could go in and click on a specific virtual machine and disconnect it from that workspace, and then connect it to this one.
Now, they may not already be connected to other Log Analytics workspaces if you don't have any already defined.
That would be one thing that we would do.
The other thing is to look at Storage account logs and add storage account logs as well.
And if you go to Azure Activity log, you'll also be able to link a subscription or connect your subscription here into your Log Analytics workspace.
So that that type of activity, that would be the management of Azure resources, shows up centrally here in your Log Analytics workspace.
Also, if you go in the navigation bar in your workspace to Workspace summary.
Here you can add components such as Network Performance Monitor.
So if I were to click Add, I could search in the Azure Marketplace for Network Performance Monitor.
And I would add this one, this is from Microsoft.
If I wanted to be able to monitor connectivity, let's say between virtual machine endpoints or different subnets in my environment.


Log Analytics Workspace Data Sources
A Log Analytics workspace in Azure is created automatically.
It is automatically created for the region in which you deploy resources. So notice here in my example, I have two default workspaces, one for the Canada Central region because I've deployed resources there. And also another for Eastern US because I've also deployed resources there.
So you can build your own manual Log Analytics workspace or work with the ones that are created automatically. You can think of it as a centralized way as the name implies to analyze logged information. So instead of going to view the log details for each and every Azure resource, instead you can have it collected in one location. So, for example, let's open up one of these default Log Analytics workspaces.
What's important is determining the data sources attached to the workspace. So, you can see that when you open up the workspace, if you scroll down in the navigation bar on the left. And you go to the Workspace Data Sources section. You can see that we can click on Virtual machines to pull up that blade.
This will give me a list of all of my VMs and I'll see which ones are attached to this workspace. As opposed to other workspaces or just not connected to any workspace at all.
So we have a number of them here that are connected. Now you can select and click on an individual, in this case, virtual machine, and either disconnect or connect it at any point in time.
Now Connect is unavailable because this VM AppServer2 is already connected to this Log Analytics workspace. 
But let's say we went to this other virtual machine which is showing us Not connected to any workspace, well, then I have the option to click Connect.
So we've got a number of options available from that perspective.
And by connecting the virtual machine here, you are allowing yourself to have a centralized place here in the Log Analytics workspace. To view all of the log information for all of these attached items.
Now those are just Virtual machines. Other data sources include Storage accounts logs.

[Video description begins] He clicks an option called "Storage accounts logs" in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

So in the same way you can go there and you can click Add if there are none there already added.

[Video description begins] He clicks a button called "Add" and a blade called "Add storage account log" opens. [Video description ends]

And you can specify storage accounts that you want to add to this centralized Log Analytics workspace.

[Video description begins] He clicks an option called "Storage account Please select a storage account" and a blade called "Choose storage account" opens. [Video description ends]

So if I were to select a Storage account, I can then specify the Data Type.
So what type of stuff is stored in that storage account in terms of logging that you want it connected here.
So maybe, for example, I know I've got some IIS logs stored there.
So I could go ahead and select that and add it here.
You can also take a look at Azure activity logs.
Now activity logs are essentially kind of like audit logs that give you information about the management of Azure resources themselves. As opposed to what's happening within them, such as for a virtual machine. And so you can link or connect your subscriptions. 
So if I go to my subscription, I could choose Connect to connect that here to have that information here as well.
So you have a number of different data sources then so that you can centrally collect logged information from your Azure environment.


Log Queries
In Azure, it's important to have the skills to properly create log queries and also to be able to interpret the results for the general overall well being and improved performance, perhaps, of your workloads running in Azure. Now you can work with log queries for an individual resource.
For example, I can open up an individual virtual machine and in the navigation bar on the left, if I scroll all the way down, under Monitoring, I can then go to Logs.
Now from here I can start to conduct log queries.
So I can start typing in things where I can refer over on the left here to table names. There's a table, for example, called Event, and if I expand that I can see the fields within it, I can start referring to them.
So for example, if I want to see everything in the Event table, I can simply say Event and I can continue on and tell it I want to count, or sort, and so on.
But if all I want to do is just take a look at that table, then I could just run that query.
And if there are results, I would see them here. And you also have the option of using a number of Example queries.
If I click that up at the top, so for example, maybe I'll look at Performance and availability and I could scroll through and there are numerous items here.
So such as Virtual Machine free disk space, when I click Run, it puts those query statements in here up above.
And I can go ahead and run the query. Of course, I can select the Time range.
It doesn't have to be the Last 24 hours, maybe the Last 7 days, and that type of thing.
So when you're working with these types of queries, that's what you can do.
Now, you can also do this from the perspective if I go Home here of a Log Analytics workspace in Azure.
So if I open up a specific Log Analytics workspace, then I can go to Logs, and I can pretty much do the same type of thing.
Now, when you first enable logging in your Azure environment, it might take time before it starts to populate this and you can start to use it.
And that's why up here I've got another browser window open, where to learn how to work with log queries, this is very useful. You've got a Demo environment made available by Microsoft.
Now when you select it, you can sign in using your normal Azure credentials, and then start to work with log queries.
So we could see on the left, we're in the Demo environment where we can see a number of interesting categories. 
For example, if I go under Security, then I'll start to see a number of table names. These are table names. So for example, there's SecurityAlert. If I expand that, I then see the fields or columns if you wish within the SecurityAlert table.
So interesting. So if I start typing in, watch it, let's put in securityalert, but I'm going to put it in all lowercase letters.
If I try to run this query, I'm going to get a SYNTAX ERROR. And that's because the table names are case sensitive. So if I were to put in SecurityAlert in proper or initial caps and then run it, now we have some results showing up down there. Now when you're constructing these log queries, you can start to type things in, I'm going to put in a space. I'm going to type in a vertical pipe, which is a pipe symbol. I want to take the result of what's on the left and feed it into something on the right such as counting the number of occurrences or ordering them or summarizing them or doing something of that nature. So let's say, for example, that we want to run a search. So I'm going to type in the word search in and then I'm going to specify the name of the table. And we know that the name of the table is going to be case sensitive. So SecurityAlert. It would tell it I'm looking for ssh. And I could even, if I really wanted to, I could pipe it and tell it I want to only take, let's say, 5 entries.
And then, of course, what I'm going to do is click Run to run that query. We can see the result of the query is now showing down below. We've got some security alerts for Failed SSH brute force attacks. In your environment, you'll be able to click the Save button to save the query so you can run it in the future. Now, this is not a complicated query that we've got here. It's a one liner, but sometimes it can get quite complex and you're going to want to reuse them as opposed to recreating them every time. You'll find them by going into the Query explorer under Saved Queries.
You can also go into Azure Monitor. So Azure Monitor up at the top, I'll just click Monitor.
Monitor is simply a way to bring together a lot of your different log information throughout your entire subscription, for example. So let's say here in Monitor, I were to click on Logs over on the left.
Or from here I can select a scope. So let's say, I select my Pay-As-You-Go subscription and I click Apply.
And so now we're in the very familiar interface where we can begin running our queries. We can also navigate different types of tables. And of course we can see the columns so we can start building our queries and working with the results and saving them and getting to them from the Query explorer.


Dashboard Queries
You can run Azure log queries from within specific resources or from a Log Analytics workspace, or even from Azure Monitor.
So I'm going to go into Monitor by searching for that in the portal here in the top search bar and I'll choose Monitor.
Azure Monitor brings everything together in one location. So that you can query Logs for items, for example, in the scope of your entire subscription, or it could be a resource group.
But at any rate here, I've got a default workspace Log Analytics workspace object selected here.
I could choose Select Scope and change that up if I so chose, but I'm going to leave it as it is because what I want to do is just run a basic query here.
I'm going to look in the Heartbeat table and let's say we run it.
Well, there are no results found for the Last 24 hours, but how about we go back 7 days and run that again?
Think of a Heartbeat as being a "I am alive" type of message sent by computers in Azure. And we can see down below, we do have some activity related to that, including showing the ComputerIP addresses. Now, we know that we can save log queries, I could click the little Save button here.
And I can give this a name and save it as either a Query or a Function.
If you save it as a Function, then you could call that from another query using the short name of the function. But at any rate, and then you can specify a Category. Now, that's fine, but we can also pin this to a dashboard.
So I'm going to go ahead and click the Pin to dashboard button here.
We could choose an existing one or create a new one, I'm going to create a new one.
And I'm going to call it Dashboard1.
It's going to be for my Pay-As-You-Go subscription and I can specify the Location, let's say Canada Central for this.
And then I'm going to choose Apply.

[Video description begins] He clicks a button called "Apply" and the blade closes. The home page of the Microsoft Azure opens. [Video description ends]

Now, here in the portal, you can search for dashboard at any time up in the bar and I'm going to choose Shared dashboards.

[Video description begins] A blade called "Shared dashboard" opens. It includes a table with four columns and one row. The column headers are Name, Go to dashboard, Location, and Subscription. [Video description ends]

And I can see Dashboard1 listed here, so I'm going to click to open that up.

[Video description begins] He clicks a row entry called "Dashboard1" and the corresponding blade opens. [Video description ends]

However, it says No data for the given query. And if I try to refresh the update, still no joy. Now, that's because it's the Past 24 hours by default, so there's no data to show for that. So let's choose the Past 7 days, I'll click Apply.

[Video description begins] He clicks a drop-down list box called "UTC Time" and selects an option called "Past 7 days". [Video description ends]

And after a moment we should see that we have our result for Heartbeat messages sent from computers. Now at this point, it says This dashboard has unpublished changes. We just changed the time range filter. So I'm going to go ahead and choose Publish changes.

Video description begins] He clicks a button called "Publish changes". [Video description ends]

So this way, we can put the types of resultant log query information that's relevant to us at the time on a dashboard for quick access.
    
                    
Performance Metrics
Using performance metrics and monitoring them in Azure helps you optimize the performance of resources. For things like virtual machines or for web applications. If you're using, for example, Application Insights to track the performance of a web app.

[Video description begins] The Microsoft Azure web portal opens. [Video description ends]

Let's open up an existing virtual machine here in the portal to view its individual performance metrics. 

[Video description begins] He clicks a virtual machine called "WinSrv2019-1" and the corresponding blade opens. It is divided into two parts: navigation pane and content pane. [Video description ends]

Now we can do that by scrolling down in the navigation bar or the properties for that VM. All the way down under the Monitoring section where we can click on Metrics.

[Video description begins] The corresponding page opens in the content pane. [Video description ends]

Now over here on the right, we can select a metric from the drop-down list. So for example, I'm going to go down, let's say into the P's and choose Percentage CPU. And we can see that the CPU performance metric has been mapped on a chart.

[Video description begins] He clicks a drop-down list box called "Metric" and selects an option called "Percentage CPU". [Video description ends]

We can see the percentages going up on the left. And it's plotted against a timeline going across the bottom from left to right.

[Video description begins] He points to the graph. [Video description ends]

But you can also click the Add metric button to add more than one metric on a single graph. So for example, maybe I'm interested in some other metric like Disk Write Bytes if I'm interested in disk performance.

[Video description begins] He clicks the Metric drop-down list box and selects an option called "Disk Write Bytes". [Video description ends]

So now I've got both items plotted. And I can see by the legend that in this particular case, the Disk Write Bytes is shown in red. So I can track that performance metric separately from my Percentage CPU. If I hover over any of those metrics, it allows me to zoom in on that specific metric. Because it's highlighted and everything else is dimmed on the graph. We can also pin this to a dashboard so that we have an easy convenient way to look at this. Instead of coming in each time we're interested in this and setting it up from scratch. 

[Video description begins] He clicks an option called "Overview" in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

Now if I go back to the Overview blade for this VM over on the right, if I scroll down. 

[Video description begins] The content pane includes graphs called "CPU (average)", "Network (total)", "Disk bytes (total)", and "Disk operations/sec (average)". [Video description ends]

I can also see some standard performance metrics, which by default shows me activity for the last hour. But I could choose, let's say last 7 days.

[Video description begins] He selects an option called "7 days". [Video description ends]

Where I can see the CPU usage average, the network traffic total, I can see the disk bytes total, disk operations per second. So we've got a lot of these items that are here automatically by default. But let me search here in the search bar in the portal for monitor.

[Video description begins] He clicks the Monitor option and the Monitor blade opens. It is divided into two parts: navigation pane and content pane. [Video description ends]

Azure Monitor is a centralized tool that allows you to also view performance metrics from here, instead of from an individual resource.

[Video description begins] He selects an option called "Metrics" in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

Now from here I have to select a scope.

[Video description begins] He opens the Select a scope blade. it includes tabs called "Browse" and "Recent". The Browse tab is selected. It includes a table with three columns and several rows. The column headers are Scope, Resource type, and Location. [Video description ends]

So this is different because we're not already in a resource like a VM, so it doesn't know what to show us. We have to select a scope. So I can drill down within a subscription and then ultimately within a resource group.

[Video description begins] He points to a subscription called "Pay-As-You-Go" under the Scope column header. [Video description ends]

And I could even select, for example, a Log Analytics workspace.

[Video description begins] He expands a resource group called "defaultresourcegroup-cca". [Video description ends]

So what we could do here is we have the ability because notice that we can expand and collapse our subscriptions. This is a way for you to be able to monitor performance metrics across different subscriptions by adding different scopes. So I'm going to add a Log Analytics workspace here and I'll click Apply.

[Video description begins] He clicks a button called "Apply" and the Select a scope blade closes. [Video description ends]

Now what you have to think about is the data sources attached to that Log Analytics workspace. So the specific virtual machines or storage account logs. Because from there you'll be able to then determine which specific metrics you might be interested in. 

[Video description begins] He clicks a drop-down list box called "Metric" and selects an option called "Disk Writes/sec". [Video description ends]

So for example, if I were to choose, let's say Disk Writes/sec, then I will have some information plotted that is available based on all of the information that's made available to that Log Analytics workspace.


Action Groups and Alert Rules
Instead of going to each and every resource in Azure to monitor the performance, you can configure instead alerts. Alerts can send you notifications through your configuration of what are called action groups. And this way, you are notified when there are issues based on your configured thresholds, instead of you having to go through and peruse all of your Azure resources, which is much more time consuming.

[Video description begins] The Microsoft Azure web portal opens. [Video description ends]

So let's get started with this. First thing I want to do here is open up an existing Log Analytics workspace.

[Video description begins] He clicks a Log Analytics workspace called "LogAnalytics-2yhz76" and the corresponding blade opens. It is divided into two parts: navigation pane and content pane. [Video description ends]

The reason I'm doing this is because a Log Analytics workspace is a centralized logging hub. Where if I scroll down in the navigation bar, we have a number of different types of data sources that can feed their performance metric and log data into this Log Analytics workspace. And so as a result, we can configure some alerting here within the Log Analytics workspace. So if I scroll down under the Monitoring section in the left-hand navigator, there's Alerts.

[Video description begins] He clicks an option called "Alerts" in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

Now these are alerts that will be specific to this Log Analytics workspace. So before I create an alert rule, I'm going to first click on Manage actions.

[Video description begins] He clicks a button called "Manage actions" and the corresponding blade opens. It includes a table with five columns and one row. The column headers are Action group name, Short name, Resource group, Status, and Actions. [Video description ends]

When I do that, I can create a new action group, I can add an action group. There might be some that are here already based on what you might have configured previously, but I'm going to add a new action group.

[Video description begins] He clicks a button called "Add action group" and a blade called "Add action group" opens. [Video description ends]

And this action group is going to be used for notification for administrators. I'm going to call it AdminNotify.

[Video description begins] He enters AdminNotify in a text box called "Action group name". [Video description ends]

The short name will be the same because the Short name field is required. The next thing down below is I'm going to add an action type, you can add multiple action types to this action group. We can see here we can trigger an Automation Runbook or an Azure Function, or we can have an e-mail message sent or in my case I want an SMS text message sent. 

[Video description begins] He clicks a drop-down list box called "Action Type" and selects an option called "Email/SMS/Push/Voice". A blade called "Email/SMS/Push/Voice" opens. [Video description ends]

So I'm going to select that item, that's going to open up a new blade where I'm going to turn on the check mark for SMS and I'm going to specify a phone number.

[Video description begins] The Email/SMS/Push/Voice blade closes. [Video description ends]

Now the next thing I need to do is supply a name, so I'm going to call it TextITDirector.

[Video description begins] He enters TextITDirector in a text box called "Action name". [Video description ends]

And then I'm going to click OK. So I've got my action group configuration created and it now shows up in the list, it says AdminNotify.
Let's go back into the Alerts for our Log Analytics workspace. And in the Alerts blade or view, I'm going to click New alert rule.
I want to create an alert to be notified when something happens. In this case, specifically be notified through an SMS text message based on the phone number we've configured. So the resource here in the alert rule is already specified. It's a specific Log Analytics workspace. It could be based on something else. I mean we could have done this, we could have configured an alert for a specific virtual machine for example. But in this case, the resource is the Log Analytics workspace. Now we have to add a condition. So under CONDITION, I will click Add.
So for the Monitor service in the upper right in that drop-down list, I'm going to choose Platform. I'm going to see platform-specific items and I'm going to filter the list for processor and there we go, % Processor Time.
So I'm going to select that item to configure a condition.
I want to look for busy or overburdened processor utilization. Then I'm going to scroll down and I can select a specific dimension if I want to filter or zoom into a specific Computer or an ObjectName and so on.
But I don't, I just want it overall. So what I want to do is essentially I want to be notified when we've got an 80% Greater than, 80% on Average of CPU utilization. Now we can see the frequency of evaluating this type of condition which is going to be every minute. And we can see the Aggregation granularity (Period) is set to 5 minutes. So I'm going to go ahead and click Done.
So we've now got our condition whenever the CPU processor utilization is above a certain amount. Then we have to go down and apply this to an action group. We don't have an action group selected, but we just created one recently. So I'm going to go ahead and click on Add.
There's the AdminNotify action group where we've got 1 SMS text message that will be sent, and I'm going to go ahead and choose Select.
Then all the way down at the bottom, I have to give this a name. So I'm going to call this alert rule BusyCPU, and I'm going to scroll down further and just click outside of that, and then I can click Create alert rule.
Now if we have any issues related to that alert rule, they will show up here in the Alerts blade or the Alerts view.
Now we can also use our action groups and configure alerts for an individual resource as we've alluded to.
So let's say I opened up an individual virtual machine here in the portal.
What I could do is scroll down in its navigation bar on the left, and go down under Monitoring and there's Alerts.
When I go into Alerts, it's the same type of interface that we just saw.
For example if I click Manage alert rules, I will see any alert rules created for this specific resource of which there are none. Now I could click New alert rule, and I could go through and configure the same type of thing we did.
The difference being that the resource is a specific VM as opposed to a Log Analytics workspace. So I could go through the same types of motions and add a condition for it. 
And when it comes to the action groups, if I were to click Add, then I would see my global list of action groups including AdminNotify.


Application Insights
One common use of Microsoft Azure is the deployment of customized web applications. And so developers will always be interested in monitoring how the app is being used and how it's performing. And we can do that by enabling Application Insights.
So here in the portal, to do that, I'm going to create a new web application.
And during the creation I'm going to make sure I enable Application Insights, you can also turn it on after the fact.
So when I go to create a web app, there are some common things I need to fill in.
Including the resource group it will be deployed into, a name for it.
So I'm just going to put in a unique name here, custom name.
And I'm going to use a code-based application, I'll just choose here, let's say ASP.NET.
I'm going to deploy this in Canada Central as a region.
And it's going to create a new application service plan, App Service Plan. That's fine, it determines the underlying horsepower and the pricing tier, I'm going to accept the default for the sizing. I'm going to click Next on monitoring, so Next: Monitoring.
This is where we want to make sure that Application Insights is enabled. And it is, it's set to Yes. And it's going to create a new Application Insights resource. And here, it's pretty much got the name of my web application. That's fine, perfect. 
So I'm going to go ahead and choose Next, and continue all the way through accepting defaults by clicking the Next button.
Finally, I'll click the Create button to create this web app where App Insights is actually enabled now.
We can now see our deployment is complete, I'm going to click Go to resource to go into the web application.
Where in the left-hand navigation bar, if I scroll down under the Settings section, I'll see Application Insights. I'm going to click to open up that blade.
We're over on the right, I can see it's enabled, this is where you can enable or disable it. And I can see that it's connected to my Application Insights resource. So there's a separate resource that's created and there's a link to it here, which I will click on.
In the Overview blade of the App Insights object, so that's what we're looking at now, over on the right. I can see some performance metrics such as Failed requests for the app, Server response time, Server requests, and overall Availability. 
If I click Live Metrics over on the left, after a moment I'll get some new live metrics related to my application. So Incoming Requests, Request Duration, failure rates, and so on. So for developers, this is going to be absolutely crucial so that they might know what to tweak within the application to optimize performance.


Network Performance Monitor
In Azure, the Network Performance Monitor tool allows you to monitor and identify network problems. Whether they're related to firewall issues or maybe they're related to routing configuration errors.
Either way, here in a Log Analytics workspace, when you want to work with the Network Performance Monitor, you have to add it here. Here's what that means. If I scroll down in the left-hand navigation bar for this Log Analytics workspace, I can then click on Workspace summary over on the left.
Now you're not going to see the Network Performance Monitor listed here by default. It's showing up here because I've already added it.  
What you would normally do is click the Add button up at the top and you would search for Network Performance Monitor.
And you could add it by selecting it from the marketplace, here it is. Network Performance Monitor from Microsoft, but I've already got that done. So I'm going to go back here to the Overview where the Network Performance Monitor panel is listed here.
So, when you first go into that, you're going to be configuring it. So I'm going to go ahead and click on the Configure link up at the top.
And then on the left I'm going to click SETUP.
This is what you're going to see the first time you come in. It wants you to install the OMS agents, the monitoring agents within your hosts. Now if you added virtual machines to this Log Analytics workspace. They automatically already have the Microsoft monitoring agent extension installed. So it's already done. You can also tweak and configure performance monitoring.
You can also tweak and configure service connectivity monitoring such as for Office 365, Microsoft Dynamics.
You can also monitor ExpressRoute dedicated circuit connections.
So over on the left, I'm going to click NETWORKS.
I've already added a couple of networks here. I've got my default network and I can see the subnetwork range for that VNet is 10.0.1.0. But I've also already added VNet9 here. You can click the Add network button and just fill in the details for the network name. And you'll be able to select an unallocated subnet that it's detected down below here. So I've done that and I've called it VNet9. 
IThen if I click on SUBNETWORKS over on the left, 'll see the subnets that stem from those virtual networks.  
And if I click on NODES, I can see here I've got three virtual machines in Azure. They're up and running. The AGENT STATUS shows as being Healthy. Now these three virtual machines in my case are added to this Log Analytics workspace. And as we've mentioned, they automatically get the monitoring agent installed, so they're good and ready to go. 
And if I click PERFORMANCE MONITOR on the left, I can click add a rule.
Now when I add a rule over on the right, I can select a network, I can select a subnet, and I can choose connectivity to another subnet.
I can add exceptions and I can tell it I want to use ICMP versus TCP to test the connectivity.
And I can determine when it will generate an alert if the connectivity between those subnets is not available. So the default is to autodetect sudden changes. But we can say if there is a loss, a packet condition loss, greater than or equal to a certain percentage. Or latency, network latency, speed greater than or equal to a certain number of milliseconds. So network latency means network slow down issues. So we can have that trigger. So once we've got that done, then our rule will show up. And if I go back to the overview here for my workspace summary.
That's when, when you come into Network Performance Monitor, you get to see here that you've got some problems.

[Video description begins] He opens the DefaultWorkspace-048b82ac-4519-403b-ab05-6b4305502109-CCA blade. [Video description ends]

Potentially, hopefully not. So we know that within a Log Analytics workspace. If we scroll down and look at the workspace data sources that virtual machines can serve as a data source.

[Video description begins] He clicks an option called "Virtual machines" and the corresponding page opens in the content pane. [Video description ends]

And I've got a couple of them here, WinSrv2019-1, -2 and 3, they're added to this workspace. Of course, we can just click on it to open it up and connect or disconnect it.

[Video description begins] He clicks a Virtual machine called "WinSrv2019-1" and the corresponding blade opens. [Video description ends]

But once you actually connect a virtual machine to a workspace, the Microsoft monitoring agent is automatically installed in the VM.

[Video description begins] He closes the blade. [Video description ends]

And that way the VM can report back to this Log Analytics workspace. So let's just flip over and take a look at one of those virtual machines.

[Video description begins] He opens a new Microsoft Azure web portal. The Virtual machines blade is open. He clicks the WinSrv2019-1 virtual machine and the corresponding blade opens. It is divided into two parts: navigation pane and content pane. [Video description ends]

If I actually click to open it up, and if we take a look at the virtual machine extensions.

[Video description begins] He clicks an option called 'Extensions" in the navigation pane and the corresponding page opens in the content pane. it includes a table with three columns and three rows. The column headers are Name, Type, and Version. [Video description ends]

What will have been added because it won't have been there before is the Microsoft Azure monitoring dependency agent. That gets installed when you connect or link that VM to a workspace. Now in the case of Network Performance Monitoring, that's going to be important.

[Video description begins] He switches back to the DefaultWorkspace-048b82ac-4519-403b-ab05-6b4305502109-CCA | Virtual machines blade in the previous Microsoft Azure web portal. [Video description ends]

If we take a look at the result of our configuration. If we go under Workspace summary here in the Log Analytics workspace.

[Video description begins] He clicks the Workspace summary option in the navigation pane and the Overview blade opens. [Video description ends]

We could see that now that it's had time for those servers to start reporting back information about network connectivity. We're going to start seeing some potential alerts. I can see there's an alert here. There's 1 of 1 subnetwork link that is considered unhealthy. 

[Video description begins] He clicks the Network Performance Monitor option and the Network Performance Monitor blade opens. [Video description ends]

So if I click on that panel to open it up, then I can read more details about exactly what the issue is. So we can see that that health event was generated by a rule called Rule1. And if I kind of click on that rule to see what it's about, we've got a 100% transmission loss.

[Video description begins] He clicks a link called "Rule 1" and a blade called "Affected Subnetworks Link" opens. [Video description ends]

And we can see it's between subnets within the rule that were specified. And in this case, those subnets are the 10.0.1.0 subnet, and the 13.0.1.0 subnet. There's a link on the right that says View affected node links. So I could also click on that to get even further detail.

[Video description begins] A blade called "Node Links" opens. [Video description ends]

And from here I can see the node links where on the left I have the name of a virtual machine. And it's pointing to another one listed to the right of it. And I can see the IP address interfaces, and I can see in this case we have a 100% packet loss. Now, that often might be due to routing problems between subnets and so on. But this is one of the overall purposes of using Network Performance Monitor or NPM in Azure. To identify these types of network connectivity issues.



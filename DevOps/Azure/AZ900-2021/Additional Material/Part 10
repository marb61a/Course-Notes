                    AZ900 Microsoft Azure Cloud Fundamentals 2021
                    Additional Material Course Notes Part 10


Azure Monitoring Overview
In order to keep your Azure environment secure and running optimally, you should perform monitoring.
Now in order to monitor something to determine if something is abnormal, you need to know what is normal. And that's where monitoring baselines kick in. Whether it's for determining what normal activity looks like at the network level, for the amount of network transmissions, for example. What is normal when it comes to activity on a host. Such as how much memory is usually used within normal workload conditions, or how busy the CPU is. And that also goes for an application, which could be spread out across multiple virtual machine hosts. Monitoring baselines will vary from one company to another, even from one department within an organization to another. Depending on how technology is being used. So an anomaly from the normal usage could indicate a security incident. It could just be a normal spike in activity. But if we gather enough activity over time, we'll know that that occurs.
So a security baseline then can be used to detect anomalies. And performance baselines can also be used simply to detect that things are busy or that they have slowed down. And in response we might resize virtual machine instances. Or configure autoscaling accordingly to accommodate the increase or decrease in those workloads. So baseline anomalies could show up as busy CPU utilization. Which could be indicative beyond of just a busy workload of cryptocurrency mining, if the machine has been infected, or ransomware. If we have excessive network traffic way beyond normal that could be indicative of a distributed denial of service or a DDoS network attack. Or we might have device operating system changes while the hardware is the same. Now that would mean that we might have a Windows host that is all of a sudden a Linux host, but everything else about it looks the same. So that could be indicative of someone having infected the machine or maybe booted it from a USB drive into a different OS, and so on. The other thing to think about is system and data access outside of regular work hours at irregular times. So there are a lot of different aspects of Azure resources that we might monitor to determine if there's an anomaly of some kind.
Now Azure monitoring gives us a number of options to track this stuff, including centrally. So we can monitor Azure resource activity logs. Now these activity logs are essentially audit logs of management tasks applied to Azure resources. Such as starting and stopping a VM or reconfiguring a VM or a web app. We can also look at the Azure Performance Diagnostics Windows VM extension. If you enable performance diagnostics, then you're getting more details on metrics like CPU utilization and traffic in and out, and disk I/O activity, for monitoring purposes. You can also pin a lot of these items to custom dashboards. So that you can pull up a dashboard and see what's of relevance for you when it comes to monitoring your Azure environment. You can also work with Azure Application Insights if you want to track activity and performance metrics for a specific web app. So that's really what that one is about.
Here on the screen we have a screenshot of monitoring some performance metrics for an individual VM or virtual machine. So we can see the CPU average utilization, the network traffic total, the disk bytes total, the disk operations per second on average. These are important metrics to monitor. However, we can also monitor things centrally instead of doing this and going to an individual Azure resource, in this case a VM.
And that's where Log Analytics workspaces kick in. This is centralized monitoring of Azure log data and also performance metric data. So configuration and log data feeds into Azure Monitor from the Log Analytics workspace. You can also run log queries in the Log Analytics workspace. Or from Azure Monitor, again, because Azure Monitor gets a lot of its data from Log Analytics workspaces. Your alert notifications can be configured in the Log Analytics workspace.
Now, there are a number of data sources that Log Analytics workspaces draw upon. Including storage account logs, Azure activity logs, physical and virtual servers. And you can even link it to your existing System Center Operations Manager or SCOM environment, if you have one. Now by adding servers to the Log Analytics workspace. It means that their performance metrics and log data can be collected centrally in the Log Analytics workspace.


Individual Resource Monitoring
There's a wealth of information available for each and every Azure resource whether you're interested in monitoring the performance of an item or auditing who did what to it from a management perspective or viewing things like operating system log details for VMs. 
All of this is available here in the portal. So I'm going to start in the portal by clicking to open up an existing virtual machine.

[Video description begins] He clicks a virtual machine called "WinSrv2019-1" and the corresponding blade opens. It is divided into two parts: navigation pane and content pane. [Video description ends]

And the first thing we're going to do is click on the Activity log on the left.

[Video description begins] He clicks an option called "Activity log" in the navigation pane and the corresponding page opens in the content pane. It includes a table with six columns and three rows. The column headers are Operation name, Status, Time, Time Stamp, Subscription, and Event initiated by. [Video description ends]

This is a log that really only relates to the management of this resource in Azure. And so on the right the default Timespan is the Last 6 hours. Let's get more stuff shown here by changing that, let's say, to the Last month and I'll click Apply.

[Video description begins] He clicks a drop-down list box called "Timespan" and selects an option called "Last month". He clicks a button called "Apply". [Video description ends]

Now we'll see that there are quite a few other operations related to the management of this VM. When we filter in that way we can see the name of the operation, whether it succeeded or not, the date and time stamp, the subscription it applies to and the user that initiated it. We can also further filter this. So for example, for Event severity, let's say the only thing I'm really interested in are Critical and Error messages, I'm not interested in seeing Warning or Informational.

[Video description begins] He clicks a drop-down list box called "Event severity". [Video description ends]

So I can unselect those or deselect them and now I've got a really small filtered list. And I can click on any one of these specific activity log entries to get more detail.

[Video description begins] He clicks an Operation name called "VirtualMachines" and the corresponding blade opens. [Video description ends]

Now, we also have other options for monitoring here.

[Video description begins] He closes the blade. [Video description ends]

I'm going to scroll way down in the navigation bar down to the Monitoring section where I'm going to click on Metrics. This is more related to the performance in this case of the VM.

[Video description begins] The corresponding page opens in the content pane. [Video description ends]

So we can select a metric from the drop-down list. For example, I'll just go down in this list and choose Percentage CPU.

[Video description begins] He clicks a drop-down list box called "Metric" and selects an option called "Percentage CPU". [Video description ends]

Now the Percentage CPU item is added here and we can see its value. We can see it's been plotted against the timeline on the bottom, and the percentage going across the top, from the bottom to the top.

[Video description begins] He points to a graph. [Video description ends]

We can also add metrics, you have more than one thing shown at the same time.

[Video description begins] He clicks a button called "Add metric". The options called "Scope", "Metric Namespace", "Metric", and "Aggregation" are displayed. [Video description ends]

So I'm going to go ahead and maybe and add Disk Read Bytes/second. And when you do that it will be plotted.

[Video description begins] He clicks a drop-down list box called "Metric" and selects an option called "Data Disk Read Bytes/Sec (Deprecated)". [Video description ends]

You'll see it might have a value. So we can see the values are being plotted but notice in the legend it's a different color. So this could be very important as well.

[Video description begins] He points to the graph. [Video description ends]

So we can monitor these metrics to track how this is doing. So performing well, do we maybe need to resize the VM, maybe scale it up so it can handle the workload better? That type of thing. We can also go to Logs over on the left.

[Video description begins] He clicks an option called “Logs” and its corresponding page opens in the content pane. [Video description ends]

Now it's not enabled by default, so I'm going to go ahead and click the Enable button. Now when you do that, you're going to have to select the subscription and a Log Analytics workspace that you want this associated with. So I'm okay with the default selection for the Log Analytics workspace. So I'm going to go ahead and click Enable.

[Video description begins] He clicks a button called "Enable" and a message box called "Submiting deployment" is displayed. [Video description ends]

Once that's enabled and you're still in the Logs blade, over on the right you'll see that things have changed.

[Video description begins] A tab called "New Query 1" is displayed. It is divided into two parts: navigation pane and content pane. [Video description ends]

You've got a query builder tab at the top here, it's called New Query 1. So this is a log query and down the left, you have a bunch of table names that you can select from.

[Video description begins] He points to the navigation pane. [Video description ends]

 Now if you expand any of these table names, what you will be exposing are the fields or columns within those tables.

[Video description begins] He expands a table name called "SecurityEvent". [Video description ends]

And you can see the data type is string or whatever it happens to be depending on the nature of what you're looking at. You can actually start selecting items.

[Video description begins] He expands a table name called "AzureActivity". [Video description ends]

So for example, if I double-click on one of these items, such as a column, I could see it puts it in here over on the right.

[Video description begins] He double-clicks a column name called "ActivityStatus (string)". The ActivityStatus column name is displayed in a text box called "Type your query here or click one of the example queries to start" in the content pane. A section called "Get started with sample queries" is also displayed in the content pane. It includes tabs called "History", "Performance and availability", and "3 more". [Video description ends]

But of course you can also select from some example query. So if I go to Performance and availability, I could start scrolling down and saying maybe I want to view Virtual Machine available memory and I could run that.

[Video description begins] He clicks a button called "Run" in a section called "Virtual Machine available memory". A code snippet is displayed. [Video description ends]

It puts in the query statement here, where for example, the name of the table which is case sensitive is Perf. And then I'm piping that to where and I'm asking for TimeGenerated over an hour ago and so on and you can run the query by clicking Run. If there are no results, then you're going to get a message that says there are no results. Otherwise, you'll see some of the details. So this is one thing that we can do here, work with log queries within an individual resource. Let's go up to Diagnostic settings here for this Windows virtual machine.

[Video description begins] He clicks an option called “Diagnostic settings” and its corresponding page opens in the content pane. [Video description ends]

So I've got a storage account selected here for storage.

[Video description begins] He points to a storage account called "storacct333325" in a drop-down list box called "Diagnostics storage account". [Video description ends]

And I'm going to choose Enable guest-level monitoring.

[Video description begins] He clicks a button called "Enable guest-level monitoring". The corresponding page opens in the content pane. It includes tabs called "Overview", "Performance counters", "Logs", "Crash dumps", "Sinks", and "Agent". [Video description ends]

The next thing I can do is determine under Overview, for example, which performance counters I'm interested in gathering. There are some default selections.

[Video description begins] He clicks a link called "Configure performance counters" and the Performance counters tab opens. He points to a table with two columns and six rows. The column headers are Performance counter and Sample rate (seconds). [Video description ends]

I can go to Logs and determine which operating system logs I'm interested in and some details.

[Video description begins] He clicks the Logs tab. [Video description ends]

So for example, I'm interested in the Application log with Critical, Error, Warning types of events, severities. And I could do the same type of thing for the Security and System logs. And I can even ask for additional items like IIS web server logs if there is one available there.

[Video description begins] He selects a checkbox called "IIS logs" and a value called "wad-iis-logfiles" is displayed in a text box called "Storage container name". [Video description ends]

And I can save all of these settings.

[Video description begins] He clicks a button called "Save". [Video description ends]

So when you enable the diagnostic settings, you're really saying I want to start to get more details of the inner workings of the workloads running in those, well, in this case in this VM.
Log Analytics Workspaces

[Video description begins] Topic title: Log Analytics Workspaces. The presenter is Dan Lachance. [Video description ends]

In Azure, a Log Analytics workspace is a resource that you can create and configure in the Azure environment.

[Video description begins] The Microsoft Azure web portal opens. A blade called "All resources" is open. It includes a table with four columns and several rows. The column headers are Name, Type, Resource group, Location, and Subscription. [Video description ends]

To get started here in the portal, I'm going to look at my All resources view. And I'm going to filter it for objects that are Log Analytics workspaces because I already have some here.

[Video description begins] He clicks a drop-down list box called "Type" and deselects an option called "Select all". He further selects an option called "Log Analytics workspace". [Video description ends]

So I'm going to filter for Log Analytics workspaces, click outside of it. Here I can see I've got a couple of them. Now why would you have more than one Log Analytics workspace? Here I've got some for different regions or locations, Canada Central I see under the Location heading and East US.

[Video description begins] He points to the table. [Video description ends]

Well that's one reason, you might want to have your centralized logging through the Log Analytics workspace per region. But you could have multiple Log Analytic workspaces within the same region. Maybe because you have different monitoring requirements for different resources within the same region. So to get started to add a new Log Analytics workspace, I'm going to click the Add button.

[Video description begins] A blade called "New" opens. [Video description ends]

And I'm going to search up log analytic, and there it is.

[Video description begins] He clicks an option called "Log Analytics" and the corresponding blade opens. [Video description ends]

Now I'm going to select Log Analytics and choose Create.

[Video description begins] He clicks a button called "Create" and a blade called "Log Analytics workspace" opens. [Video description ends]

First thing I have to do is create a name for it or specify a name. So I'm going to call it LogAnalytics-2.

[Video description begins] He enters LogAnalytics-2 in a text box called "Log Analytics Workspace". [Video description ends]

I'm going to deploy this into an existing resource group.

[Video description begins] He clicks a drop-down list box called "Resource group" and selects an option called "Rg1". [Video description ends]

Now, up above, it's kind of outlined my name in red, in a red outline, because that name is taken. And so I'm going to put in some characters to make that a unique name and I'll kind of click outside of it. And now the name is unique.

[Video description begins] He enters LogAnalytics-2yhz76 in the Log Analytics Workspace text box. [Video description ends]

So make sure you adhere to your naming standards within your organization when you change some of these names. I'm going to specify the location where I want this specific Log Analytics workspace. So I'm going to choose Canada Central.

[Video description begins] He clicks a drop-down list box called "Location" and selects an option called "Canada Central". [Video description ends]

I'm going leave it with my Pay-as-you-go subscription for the pricing tier and I'm going to choose OK.

[Video description begins] He clicks a button called "OK". The All resources blade opens. [Video description ends]

And now back here in the All resources view, I can see my newly created Log Analytics workspace.

[Video description begins] He points to LogAnalytics-2yhz76 in the table. [Video description ends]

So I'm going to go ahead and click on it to open it up. Because one of the first things that you really should contend with is which data sources are connected. To your newly created Log Analytics workspace.

[Video description begins] He clicks LogAnalytics-2yhz76 under the Name column header and the corresponding blade opens. It is divided into two parts: navigation pane and content pane. [Video description ends]

Because remember, this serves as a centralized performance metric and log data feed. Where's that coming from? Well, we can scroll down and go under Workspace Data Sources. Here we can click Virtual machines and we're going to see all of the virtual machines that we've got deployed.

[Video description begins] The corresponding page opens in the content pane. It includes a table with six columns and several rows. The column headers are Name, Log Analytics Connection, OS, Subscription, Resource group, and Location. [Video description ends]

But I can see here that they are connected to other workspaces.

[Video description begins] He points to the Log Analytics Connection column. [Video description ends]

So I could go in and click on a specific virtual machine and disconnect it from that workspace, and then connect it to this one.

[Video description begins] He clicks a resource name called "WinSrv2019-1" and the corresponding blade opens. [Video description ends]

Now, they may not already be connected to other Log Analytics workspaces if you don't have any already defined.

[Video description begins] He clicks a button called "Disconnect" and a dialog box called "Disconnect" opens. He clicks a button called "Yes" and the dialog box closes. [Video description ends]

That would be one thing that we would do.

[Video description begins] He switches back to the LogAnalytics-2yhz76 | virtual machines blade. [Video description ends]

The other thing is to look at Storage account logs and add storage account logs as well.

[Video description begins] He clicks an option called "Storage account logs" in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

And if you go to Azure Activity log, you'll also be able to link a subscription or connect your subscription here into your Log Analytics workspace.

[Video description begins] He clicks an option called "Azure Activity log" in the navigation pane and the corresponding page opens in the content pane. It includes a table with two columns and one row. The column headers are Subscription and Log Analytics Connection. [Video description ends]

So that that type of activity, that would be the management of Azure resources, shows up centrally here in your Log Analytics workspace.

[Video description begins] He clicks a subscription called "Pay-As-You-Go" and the corresponding blade opens. He clicks a button called "Connect". [Video description ends]

Also, if you go in the navigation bar in your workspace to Workspace summary.

[Video description begins] He closes the blade and returns to the LogAnalytics-2yhz76 | Azure Activity log blade. [Video description ends]

Here you can add components such as Network Performance Monitor.

[Video description begins] He clicks an option called "Workspace summary" in the navigation pane and a blade called "Overview" opens. [Video description ends]

So if I were to click Add, I could search in the Azure Marketplace for Network Performance Monitor.

[Video description begins] He clicks a button called "Add" and a blade called "Marketplace" opens. It is divided into two parts: navigation pane and content pane. [Video description ends]

And I would add this one, this is from Microsoft.

[Video description begins] He selects an option called "Network Performance Monitor" and the corresponding page opens in the content pane. [Video description ends]

 If I wanted to be able to monitor connectivity, let's say between virtual machine endpoints or different subnets in my environment.


Log Analytics Workspace Data Sources
A Log Analytics workspace in Azure is created automatically.

[Video description begins] The Microsoft Azure web portal opens. The home page is open. It includes a table with three columns and several rows. The column headers are Name, Type, and Last Viewed. [Video description ends]

It is automatically created for the region in which you deploy resources. So notice here in my example, I have two default workspaces, one for the Canada Central region because I've deployed resources there. And also another for Eastern US because I've also deployed resources there.

[Video description begins] He points to the Name column in the table. [Video description ends]

So you can build your own manual Log Analytics workspace or work with the ones that are created automatically. You can think of it as a centralized way as the name implies to analyze logged information. So instead of going to view the log details for each and every Azure resource, instead you can have it collected in one location. So, for example, let's open up one of these default Log Analytics workspaces.

[Video description begins] He clicks a row entry and the corresponding blade open. It is divided into two parts: navigation pane and content pane. [Video description ends]

What's important is determining the data sources attached to the workspace. So, you can see that when you open up the workspace, if you scroll down in the navigation bar on the left. And you go to the Workspace Data Sources section. You can see that we can click on Virtual machines to pull up that blade.

[Video description begins] He clicks an option called "Virtual machines" in the navigation pane and the corresponding page opens in the content pane. It includes a table with six columns and several rows. The column headers are Name, Log Analytics Connection, OS, Subscription, Resource group, and Location. [Video description ends]

This will give me a list of all of my VMs and I'll see which ones are attached to this workspace. As opposed to other workspaces or just not connected to any workspace at all.

[Video description begins] He points to the Log Analytics Connection column. [Video description ends]

So we have a number of them here that are connected. Now you can select and click on an individual, in this case, virtual machine, and either disconnect or connect it at any point in time.

[Video description begins] He clicks a row entry called "AppServer2" under the Name column header and the corresponding blade opens. [Video description ends]

Now Connect is unavailable because this VM AppServer2 is already connected to this Log Analytics workspace. 

[Video description begins] He closes the blade. [Video description ends]

But let's say we went to this other virtual machine which is showing us Not connected to any workspace, well, then I have the option to click Connect.

[Video description begins] He clicks a row entry called "WinSrv2019-2" under the Name column header and the corresponding blade opens. [Video description ends]

So we've got a number of options available from that perspective.

[Video description begins] He closes the blade. [Video description ends]

 And by connecting the virtual machine here, you are allowing yourself to have a centralized place here in the Log Analytics workspace. To view all of the log information for all of these attached items.

[Video description begins] He points to the Name column. [Video description ends]

Now those are just Virtual machines. Other data sources include Storage accounts logs.

[Video description begins] He clicks an option called "Storage accounts logs" in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

So in the same way you can go there and you can click Add if there are none there already added.

[Video description begins] He clicks a button called "Add" and a blade called "Add storage account log" opens. [Video description ends]

And you can specify storage accounts that you want to add to this centralized Log Analytics workspace.

[Video description begins] He clicks an option called "Storage account Please select a storage account" and a blade called "Choose storage account" opens. [Video description ends]

So if I were to select a Storage account, I can then specify the Data Type.

[Video description begins] He selects a storage account called "storacct333325" and the Choose storage account blade closes. [Video description ends]

So what type of stuff is stored in that storage account in terms of logging that you want it connected here.

[Video description begins] He clicks an option called "Data Type Please select a data type" and a blade called "Data Type" opens. [Video description ends]

So maybe, for example, I know I've got some IIS logs stored there.

[Video description begins] He selects an option called "IIS logs" and the Data Type blade closes. [Video description ends]

So I could go ahead and select that and add it here.

[Video description begins] He clicks a button called "OK" and the Add storage account log blade closes. [Video description ends]

You can also take a look at Azure activity logs.

[Video description begins] He clicks an option called "Azure Activity log" in the navigation pane and the corresponding page opens in the content pane. It includes a table with two columns and one row. The column headers are Subscription and Log Analytics Connection. [Video description ends]

Now activity logs are essentially kind of like audit logs that give you information about the management of Azure resources themselves. As opposed to what's happening within them, such as for a virtual machine. And so you can link or connect your subscriptions. 

[Video description begins] He clicks a row entry called "Pay-As-You-Go" under the Subscription column header and the corresponding blade opens. [Video description ends]

So if I go to my subscription, I could choose Connect to connect that here to have that information here as well.

[Video description begins] He closes the blade. [Video description ends]

 So you have a number of different data sources then so that you can centrally collect logged information from your Azure environment.
Log Queries

[Video description begins] Topic title: Log Queries. The presenter is Dan Lachance. [Video description ends]

In Azure, it's important to have the skills to properly create log queries and also to be able to interpret the results for the general overall well being and improved performance, perhaps, of your workloads running in Azure. Now you can work with log queries for an individual resource.

[Video description begins] The Microsoft Azure web portal opens. [Video description ends]

For example, I can open up an individual virtual machine and in the navigation bar on the left, if I scroll all the way down, under Monitoring, I can then go to Logs.

[Video description begins] He clicks a Virtual machine called "WinSrv2019-1" and the corresponding blade opens. It is divided into two parts: navigation pane and content pane. [Video description ends]

Now from here I can start to conduct log queries.

[Video description begins] He clicks an option called "Logs" in the navigation pane and the corresponding page opens in the content pane. It includes a tab called "New Query1". It is divided into two parts: navigation pane and content pane. [Video description ends]

So I can start typing in things where I can refer over on the left here to table names. There's a table, for example, called Event, and if I expand that I can see the fields within it, I can start referring to them.

[Video description begins] He expands a table name called "Event" in the navigation pane. [Video description ends]

So for example, if I want to see everything in the Event table, I can simply say Event and I can continue on and tell it I want to count, or sort, and so on.

[Video description begins] He enters Event in a text box called "Type your query here or click one of the example queries to start". [Video description ends]

But if all I want to do is just take a look at that table, then I could just run that query.

[Video description begins] He clicks a button called "Run" and the result is displayed in the content pane. [Video description ends]

And if there are results, I would see them here. And you also have the option of using a number of Example queries.

[Video description begins] He clicks an option called "Example queries". A new tab called "New Query 2" opens. In the content pane tabs called "History" and "Performance and availability" are displayed. [Video description ends]

If I click that up at the top, so for example, maybe I'll look at Performance and availability and I could scroll through and there are numerous items here.

[Video description begins] He selects the Performance and availabilty tab. [Video description ends]

So such as Virtual Machine free disk space, when I click Run, it puts those query statements in here up above.

[Video description begins] He clicks a button called "Run" in a section called "Virtual Machine free disk space". [Video description ends]

And I can go ahead and run the query. Of course, I can select the Time range.

[Video description begins] He clicks a button called "Run". [Video description ends]

It doesn't have to be the Last 24 hours, maybe the Last 7 days, and that type of thing.

[Video description begins] He clicks a drop-down list box called "Time range" and selects an option called "Last 7 days" and clicks a button called "Run". [Video description ends]

So when you're working with these types of queries, that's what you can do.

[Video description begins] He selects the New Query 1 tab. [Video description ends]

Now, you can also do this from the perspective if I go Home here of a Log Analytics workspace in Azure.

[Video description begins] He clicks a link called "Home" and the Microsoft Azure home page opens. [Video description ends]

So if I open up a specific Log Analytics workspace, then I can go to Logs, and I can pretty much do the same type of thing.

[Video description begins] He clicks a Log Analytics workspace and a corresponding blade opens. It is divided into two parts: navigation pane and content pane. [Video description ends]

Now, when you first enable logging in your Azure environment, it might take time before it starts to populate this and you can start to use it.

[Video description begins] He clicks an option called "Logs" and the corresponding page opens in the content pane. It includes a tab called "New Query 1". [Video description ends]

And that's why up here I've got another browser window open, where to learn how to work with log queries, this is very useful. You've got a Demo environment made available by Microsoft.

[Video description begins] He opens a new tab and a page called "Get started with log queries in Azure Monitor" is open. [Video description ends]

Now when you select it, you can sign in using your normal Azure credentials, and then start to work with log queries.

[Video description begins] A web page called "Logs - Microsoft Azure" opens. It includes a tab called "New Query 1". It is divided into two parts: navigation pane and content pane. [Video description ends]

So we could see on the left, we're in the Demo environment where we can see a number of interesting categories. 

[Video description begins] He expands an option called "Security" in the navigation pane. [Video description ends]

For example, if I go under Security, then I'll start to see a number of table names. These are table names. So for example, there's SecurityAlert. If I expand that, I then see the fields or columns if you wish within the SecurityAlert table.

[Video description begins] He expands a table name called "SecurityAlert". [Video description ends]

So interesting. So if I start typing in, watch it, let's put in securityalert, but I'm going to put it in all lowercase letters.

[Video description begins] In the content pane, he enters securityalert in the Type your query here or click one of the example queries to start text box. He clicks the Run button. [Video description ends]

If I try to run this query, I'm going to get a SYNTAX ERROR. And that's because the table names are case sensitive. So if I were to put in SecurityAlert in proper or initial caps and then run it, now we have some results showing up down there. Now when you're constructing these log queries, you can start to type things in, I'm going to put in a space. I'm going to type in a vertical pipe, which is a pipe symbol. I want to take the result of what's on the left and feed it into something on the right such as counting the number of occurrences or ordering them or summarizing them or doing something of that nature. So let's say, for example, that we want to run a search. So I'm going to type in the word search in and then I'm going to specify the name of the table. And we know that the name of the table is going to be case sensitive. So SecurityAlert. It would tell it I'm looking for ssh. And I could even, if I really wanted to, I could pipe it and tell it I want to only take, let's say, 5 entries.

[Video description begins] He enters search in (SecurityAlert) "ssh" | take 5 in the Type your query here or click one of the example queries to start text box. He clicks the Run button. [Video description ends]

And then, of course, what I'm going to do is click Run to run that query. We can see the result of the query is now showing down below. We've got some security alerts for Failed SSH brute force attacks. In your environment, you'll be able to click the Save button to save the query so you can run it in the future. Now, this is not a complicated query that we've got here. It's a one liner, but sometimes it can get quite complex and you're going to want to reuse them as opposed to recreating them every time. You'll find them by going into the Query explorer under Saved Queries.

[Video description begins] He clicks an option called "Query explorer" and the corresponding blade opens. [Video description ends]

You can also go into Azure Monitor. So Azure Monitor up at the top, I'll just click Monitor.

[Video description begins] A blade called "Monitor | Overview" opens. It is divided into two parts: navigation pane and content pane. [Video description ends]

Monitor is simply a way to bring together a lot of your different log information throughout your entire subscription, for example. So let's say here in Monitor, I were to click on Logs over on the left.

[Video description begins] He clicks an option called "Logs". A blade called "Select a scope" opens. It includes a table with three columns and several rows. The column headers are Scope, Resource type, and Location. [Video description ends]

Or from here I can select a scope. So let's say, I select my Pay-As-You-Go subscription and I click Apply.

[Video description begins] He clicks a button called "Apply" and the blade closes. A blade called "Monitor | Logs" opens. It includes the New Query 1 tab. [Video description ends]

And so now we're in the very familiar interface where we can begin running our queries. We can also navigate different types of tables. And of course we can see the columns so we can start building our queries and working with the results and saving them and getting to them from the Query explorer.
Dashboard Queries

[Video description begins] Topic title: Dashboard Queries. The presenter is Dan Lachance. [Video description ends]

You can run Azure log queries from within specific resources or from a Log Analytics workspace, or even from Azure Monitor.

[Video description begins] The Microsoft Azure web portal opens. [Video description ends]

So I'm going to go into Monitor by searching for that in the portal here in the top search bar and I'll choose Monitor.

[Video description begins] He clicks an option called "Monitor" and a blade called "Monitor | Overview" opens. It is divided into two parts: navigation pane and content pane. [Video description ends]

Azure Monitor brings everything together in one location. So that you can query Logs for items, for example, in the scope of your entire subscription, or it could be a resource group.

[Video description begins] He clicks an option called "Logs" and the corresponding page opens in the content pane. The New Query 1 tab is open in the content pane. [Video description ends]

But at any rate here, I've got a default workspace Log Analytics workspace object selected here.

[Video description begins] He clicks a link called "Select Scope" and the Select a scope blade opens. [Video description ends]

I could choose Select Scope and change that up if I so chose, but I'm going to leave it as it is because what I want to do is just run a basic query here.

[Video description begins] He closes the blade. [Video description ends]

I'm going to look in the Heartbeat table and let's say we run it.

[Video description begins] He enters Heartbeat in the Type your query here or click one of the example queries to start text box. He clicks the Run button. [Video description ends]

Well, there are no results found for the Last 24 hours, but how about we go back 7 days and run that again?

[Video description begins] He clicks the Time range drop-down list box and selects the Last 7 days option. He clicks the Run button. [Video description ends]

Think of a Heartbeat as being a "I am alive" type of message sent by computers in Azure. And we can see down below, we do have some activity related to that, including showing the ComputerIP addresses. Now, we know that we can save log queries, I could click the little Save button here.

[Video description begins] A blade called "Save" opens. [Video description ends]

And I can give this a name and save it as either a Query or a Function.

[Video description begins] He clicks a drop-down list box called "Save as". [Video description ends]

If you save it as a Function, then you could call that from another query using the short name of the function. But at any rate, and then you can specify a Category. Now, that's fine, but we can also pin this to a dashboard.

[Video description begins] He closes the Save blade. [Video description ends]

So I'm going to go ahead and click the Pin to dashboard button here.

[Video description begins] A blade called "Pin to another dashboard" opens. It includes tabs called "Select existing" and "Create new". [Video description ends]

We could choose an existing one or create a new one, I'm going to create a new one.

[Video description begins] He clicks the Create new tab. [Video description ends]

And I'm going to call it Dashboard1.

[Video description begins] He enters Dashboard1 in a text box called "Dashboard name". [Video description ends]

It's going to be for my Pay-As-You-Go subscription and I can specify the Location, let's say Canada Central for this.

[Video description begins] He clicks a drop-down list box called "Location" and selects an option called "Canada Central". [Video description ends]

And then I'm going to choose Apply.

[Video description begins] He clicks a button called "Apply" and the blade closes. The home page of the Microsoft Azure opens. [Video description ends]

Now, here in the portal, you can search for dashboard at any time up in the bar and I'm going to choose Shared dashboards.

[Video description begins] A blade called "Shared dashboard" opens. It includes a table with four columns and one row. The column headers are Name, Go to dashboard, Location, and Subscription. [Video description ends]

And I can see Dashboard1 listed here, so I'm going to click to open that up.

[Video description begins] He clicks a row entry called "Dashboard1" and the corresponding blade opens. [Video description ends]

However, it says No data for the given query. And if I try to refresh the update, still no joy. Now, that's because it's the Past 24 hours by default, so there's no data to show for that. So let's choose the Past 7 days, I'll click Apply.

[Video description begins] He clicks a drop-down list box called "UTC Time" and selects an option called "Past 7 days". [Video description ends]

And after a moment we should see that we have our result for Heartbeat messages sent from computers. Now at this point, it says This dashboard has unpublished changes. We just changed the time range filter. So I'm going to go ahead and choose Publish changes.

Video description begins] He clicks a button called "Publish changes". [Video description ends]

So this way, we can put the types of resultant log query information that's relevant to us at the time on a dashboard for quick access.
Performance Metrics

[Video description begins] Topic title: Performance Metrics. The presenter is Dan Lachance. [Video description ends]

Using performance metrics and monitoring them in Azure helps you optimize the performance of resources. For things like virtual machines or for web applications. If you're using, for example, Application Insights to track the performance of a web app.

[Video description begins] The Microsoft Azure web portal opens. [Video description ends]

Let's open up an existing virtual machine here in the portal to view its individual performance metrics. 

[Video description begins] He clicks a virtual machine called "WinSrv2019-1" and the corresponding blade opens. It is divided into two parts: navigation pane and content pane. [Video description ends]

Now we can do that by scrolling down in the navigation bar or the properties for that VM. All the way down under the Monitoring section where we can click on Metrics.

[Video description begins] The corresponding page opens in the content pane. [Video description ends]

Now over here on the right, we can select a metric from the drop-down list. So for example, I'm going to go down, let's say into the P's and choose Percentage CPU. And we can see that the CPU performance metric has been mapped on a chart.

[Video description begins] He clicks a drop-down list box called "Metric" and selects an option called "Percentage CPU". [Video description ends]

We can see the percentages going up on the left. And it's plotted against a timeline going across the bottom from left to right.

[Video description begins] He points to the graph. [Video description ends]

But you can also click the Add metric button to add more than one metric on a single graph. So for example, maybe I'm interested in some other metric like Disk Write Bytes if I'm interested in disk performance.

[Video description begins] He clicks the Metric drop-down list box and selects an option called "Disk Write Bytes". [Video description ends]

So now I've got both items plotted. And I can see by the legend that in this particular case, the Disk Write Bytes is shown in red. So I can track that performance metric separately from my Percentage CPU. If I hover over any of those metrics, it allows me to zoom in on that specific metric. Because it's highlighted and everything else is dimmed on the graph. We can also pin this to a dashboard so that we have an easy convenient way to look at this. Instead of coming in each time we're interested in this and setting it up from scratch. 

[Video description begins] He clicks an option called "Overview" in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

Now if I go back to the Overview blade for this VM over on the right, if I scroll down. 

[Video description begins] The content pane includes graphs called "CPU (average)", "Network (total)", "Disk bytes (total)", and "Disk operations/sec (average)". [Video description ends]

I can also see some standard performance metrics, which by default shows me activity for the last hour. But I could choose, let's say last 7 days.

[Video description begins] He selects an option called "7 days". [Video description ends]

Where I can see the CPU usage average, the network traffic total, I can see the disk bytes total, disk operations per second. So we've got a lot of these items that are here automatically by default. But let me search here in the search bar in the portal for monitor.

[Video description begins] He clicks the Monitor option and the Monitor blade opens. It is divided into two parts: navigation pane and content pane. [Video description ends]

Azure Monitor is a centralized tool that allows you to also view performance metrics from here, instead of from an individual resource.

[Video description begins] He selects an option called "Metrics" in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

Now from here I have to select a scope.

[Video description begins] He opens the Select a scope blade. it includes tabs called "Browse" and "Recent". The Browse tab is selected. It includes a table with three columns and several rows. The column headers are Scope, Resource type, and Location. [Video description ends]

So this is different because we're not already in a resource like a VM, so it doesn't know what to show us. We have to select a scope. So I can drill down within a subscription and then ultimately within a resource group.

[Video description begins] He points to a subscription called "Pay-As-You-Go" under the Scope column header. [Video description ends]

And I could even select, for example, a Log Analytics workspace.

[Video description begins] He expands a resource group called "defaultresourcegroup-cca". [Video description ends]

So what we could do here is we have the ability because notice that we can expand and collapse our subscriptions. This is a way for you to be able to monitor performance metrics across different subscriptions by adding different scopes. So I'm going to add a Log Analytics workspace here and I'll click Apply.

[Video description begins] He clicks a button called "Apply" and the Select a scope blade closes. [Video description ends]

Now what you have to think about is the data sources attached to that Log Analytics workspace. So the specific virtual machines or storage account logs. Because from there you'll be able to then determine which specific metrics you might be interested in. 

[Video description begins] He clicks a drop-down list box called "Metric" and selects an option called "Disk Writes/sec". [Video description ends]

So for example, if I were to choose, let's say Disk Writes/sec, then I will have some information plotted that is available based on all of the information that's made available to that Log Analytics workspace.
Action Groups and Alert Rules

[Video description begins] Topic title: Action Groups and Alert Rules. The presenter is Dan Lachance. [Video description ends]

Instead of going to each and every resource in Azure to monitor the performance, you can configure instead alerts. Alerts can send you notifications through your configuration of what are called action groups. And this way, you are notified when there are issues based on your configured thresholds, instead of you having to go through and peruse all of your Azure resources, which is much more time consuming.

[Video description begins] The Microsoft Azure web portal opens. [Video description ends]

So let's get started with this. First thing I want to do here is open up an existing Log Analytics workspace.

[Video description begins] He clicks a Log Analytics workspace called "LogAnalytics-2yhz76" and the corresponding blade opens. It is divided into two parts: navigation pane and content pane. [Video description ends]

The reason I'm doing this is because a Log Analytics workspace is a centralized logging hub. Where if I scroll down in the navigation bar, we have a number of different types of data sources that can feed their performance metric and log data into this Log Analytics workspace. And so as a result, we can configure some alerting here within the Log Analytics workspace. So if I scroll down under the Monitoring section in the left-hand navigator, there's Alerts.

[Video description begins] He clicks an option called "Alerts" in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

Now these are alerts that will be specific to this Log Analytics workspace. So before I create an alert rule, I'm going to first click on Manage actions.

[Video description begins] He clicks a button called "Manage actions" and the corresponding blade opens. It includes a table with five columns and one row. The column headers are Action group name, Short name, Resource group, Status, and Actions. [Video description ends]

When I do that, I can create a new action group, I can add an action group. There might be some that are here already based on what you might have configured previously, but I'm going to add a new action group.

[Video description begins] He clicks a button called "Add action group" and a blade called "Add action group" opens. [Video description ends]

And this action group is going to be used for notification for administrators. I'm going to call it AdminNotify.

[Video description begins] He enters AdminNotify in a text box called "Action group name". [Video description ends]

The short name will be the same because the Short name field is required. The next thing down below is I'm going to add an action type, you can add multiple action types to this action group. We can see here we can trigger an Automation Runbook or an Azure Function, or we can have an e-mail message sent or in my case I want an SMS text message sent. 

[Video description begins] He clicks a drop-down list box called "Action Type" and selects an option called "Email/SMS/Push/Voice". A blade called "Email/SMS/Push/Voice" opens. [Video description ends]

So I'm going to select that item, that's going to open up a new blade where I'm going to turn on the check mark for SMS and I'm going to specify a phone number.

[Video description begins] The Email/SMS/Push/Voice blade closes. [Video description ends]

Now the next thing I need to do is supply a name, so I'm going to call it TextITDirector.

[Video description begins] He enters TextITDirector in a text box called "Action name". [Video description ends]

And then I'm going to click OK. So I've got my action group configuration created and it now shows up in the list, it says AdminNotify.

[Video description begins] He clicks a button called "OK" and the Add action group blade closes. [Video description ends]

Let's go back into the Alerts for our Log Analytics workspace. And in the Alerts blade or view, I'm going to click New alert rule.

[Video description begins] He clicks a button called "New alert rule" and a blade called "Create rule" opens. [Video description ends]

I want to create an alert to be notified when something happens. In this case, specifically be notified through an SMS text message based on the phone number we've configured. So the resource here in the alert rule is already specified. It's a specific Log Analytics workspace. It could be based on something else. I mean we could have done this, we could have configured an alert for a specific virtual machine for example. But in this case, the resource is the Log Analytics workspace. Now we have to add a condition. So under CONDITION, I will click Add.

[Video description begins] He clicks a button called "Add" and a blade called "Configure signal logic" opens. It includes a table with three columns and several rows. The column headers are Signal name, Signal type, and Monitor service. [Video description ends]

So for the Monitor service in the upper right in that drop-down list, I'm going to choose Platform. I'm going to see platform-specific items and I'm going to filter the list for processor and there we go, % Processor Time.

[Video description begins] He clicks a drop-down list box called "Monitor service" and selects an option called "Platform". [Video description ends]

So I'm going to select that item to configure a condition.

[Video description begins] He clicks a row entry % Processor Time under the Signal name column header. [Video description ends]

I want to look for busy or overburdened processor utilization. Then I'm going to scroll down and I can select a specific dimension if I want to filter or zoom into a specific Computer or an ObjectName and so on.

[Video description begins] He enters 80 in a text box called "Threshold value". [Video description ends]

But I don't, I just want it overall. So what I want to do is essentially I want to be notified when we've got an 80% Greater than, 80% on Average of CPU utilization. Now we can see the frequency of evaluating this type of condition which is going to be every minute. And we can see the Aggregation granularity (Period) is set to 5 minutes. So I'm going to go ahead and click Done.

[Video description begins] He clicks a button called "Done" and the Configure signal logic blade closes. [Video description ends]

So we've now got our condition whenever the CPU processor utilization is above a certain amount. Then we have to go down and apply this to an action group. We don't have an action group selected, but we just created one recently. So I'm going to go ahead and click on Add.

[Video description begins] He clicks a button called "Add" and a blade called "Select an action group to attach to this alert rule" opens. It includes a table with two columns and two rows. The column headers are Action group name and Contain actions. [Video description ends]

There's the AdminNotify action group where we've got 1 SMS text message that will be sent, and I'm going to go ahead and choose Select.

[Video description begins] He selects a checkbox for a row entry called "AdminNotify" under the Action group column header and clicks a button called "Select". The blade closes. [Video description ends]

Then all the way down at the bottom, I have to give this a name. So I'm going to call this alert rule BusyCPU, and I'm going to scroll down further and just click outside of that, and then I can click Create alert rule.

[Video description begins] He enters BusyCPU in a text box called "Alert rule name". [Video description ends]

Now if we have any issues related to that alert rule, they will show up here in the Alerts blade or the Alerts view.

[Video description begins] He clicks a button called "Create alert rule" and the Create rule blade closes. [Video description ends]

Now we can also use our action groups and configure alerts for an individual resource as we've alluded to.

[Video description begins] He clicks the Home link and the home page of the Microsoft Azure opens. [Video description ends]

So let's say I opened up an individual virtual machine here in the portal.

[Video description begins] He clicks the WinSrv2019-1 virtual machine and the corresponding blade opens. [Video description ends]

What I could do is scroll down in its navigation bar on the left, and go down under Monitoring and there's Alerts.

[Video description begins] He clicks the Alerts option in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

When I go into Alerts, it's the same type of interface that we just saw.

[Video description begins] He clicks a button called "Manage alert rules" and a blade called "Rules" opens. [Video description ends]

For example if I click Manage alert rules, I will see any alert rules created for this specific resource of which there are none. Now I could click New alert rule, and I could go through and configure the same type of thing we did.

[Video description begins] He clicks the New alert rule button and the Create rule blade opens. [Video description ends]

The difference being that the resource is a specific VM as opposed to a Log Analytics workspace. So I could go through the same types of motions and add a condition for it. 

[Video description begins] He clicks the Add button and the corresponding blade opens. [Video description ends]

And when it comes to the action groups, if I were to click Add, then I would see my global list of action groups including AdminNotify.
Application Insights

[Video description begins] Topic title: Application Insights. The presenter is Dan Lachance. [Video description ends]

One common use of Microsoft Azure is the deployment of customized web applications. And so developers will always be interested in monitoring how the app is being used and how it's performing. And we can do that by enabling Application Insights.

[Video description begins] The Microsoft Azure web portal opens. [Video description ends]

So here in the portal, to do that, I'm going to create a new web application.

[Video description begins] He clicks a link called "Create a resource" and a blade called "New" opens. [Video description ends]

And during the creation I'm going to make sure I enable Application Insights, you can also turn it on after the fact.

[Video description begins] He enters web in the search box and selects an option called "Web App". A blade called "Web App" opens. [Video description ends]

So when I go to create a web app, there are some common things I need to fill in.

[Video description begins] He clicks a button called "Create" and a blade called "Web App" opens. It includes tabs called "basics", "Monitoring", "Tags", and "Review + create". The Basics tab is selected. [Video description ends]

Including the resource group it will be deployed into, a name for it.

[Video description begins] He clicks a drop-down list box called "Resource group" and selects an option called "Rg1". [Video description ends]

So I'm just going to put in a unique name here, custom name.

[Video description begins] He enters webappyhz44660 in a text box called "Name". [Video description ends]

And I'm going to use a code-based application, I'll just choose here, let's say ASP.NET.

[Video description begins] He clicks a drop-down list box called "Runtime stack" and selects an option called "ASP.NET V4.7". [Video description ends]

I'm going to deploy this in Canada Central as a region.

[Video description begins] He clicks a drop-down list box called "Region" and selects an option called "Canada Central". [Video description ends]

And it's going to create a new application service plan, App Service Plan. That's fine, it determines the underlying horsepower and the pricing tier, I'm going to accept the default for the sizing. I'm going to click Next on monitoring, so Next: Monitoring.

[Video description begins] He clicks a button called "Next: Monitoring" and the Monitoring tab opens. [Video description ends]

This is where we want to make sure that Application Insights is enabled. And it is, it's set to Yes. And it's going to create a new Application Insights resource. And here, it's pretty much got the name of my web application. That's fine, perfect. 

[Video description begins] He clicks a button called "Next: Tags" and the Tags tab opens. [Video description ends]

So I'm going to go ahead and choose Next, and continue all the way through accepting defaults by clicking the Next button.

[Video description begins] He clicks a button called "Next: Review + create" and the Review + create tab opens. [Video description ends]

Finally, I'll click the Create button to create this web app where App Insights is actually enabled now.

[Video description begins] A blade called "Microsoft.Web-WebApp-Portal-d1ce8ec2-b131 | Overview" opens. It is divided into two parts: navigation pane and content pane. [Video description ends]

We can now see our deployment is complete, I'm going to click Go to resource to go into the web application.

[Video description begins] He clicks a button called "Go to resource" and a blade called "webappyhz44660" opens. It is divided into two parts: navigation pane and content pane. [Video description ends]

Where in the left-hand navigation bar, if I scroll down under the Settings section, I'll see Application Insights. I'm going to click to open up that blade.

[Video description begins] He selects an option called "Application Insights" in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

We're over on the right, I can see it's enabled, this is where you can enable or disable it. And I can see that it's connected to my Application Insights resource. So there's a separate resource that's created and there's a link to it here, which I will click on.

[Video description begins] He clicks a link called "webappyhz44660" and the corresponding blade opens. [Video description ends]

In the Overview blade of the App Insights object, so that's what we're looking at now, over on the right. I can see some performance metrics such as Failed requests for the app, Server response time, Server requests, and overall Availability. 

[Video description begins] He clicks an option called "Live Metrics" in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

If I click Live Metrics over on the left, after a moment I'll get some new live metrics related to my application. So Incoming Requests, Request Duration, failure rates, and so on. So for developers, this is going to be absolutely crucial so that they might know what to tweak within the application to optimize performance.
Network Performance Monitor

[Video description begins] Topic title: Network Performance Monitor. The presenter is Dan Lachance. [Video description ends]

In Azure, the Network Performance Monitor tool allows you to monitor and identify network problems. Whether they're related to firewall issues or maybe they're related to routing configuration errors.

[Video description begins] The Microsoft Azure web portal opens. A blade called "DefaultWorkspace-048b82ac-4519-403b-ab05-6b4305502109-CCA" is open. It is divided into two parts: navigation pane and content pane. [Video description ends]

Either way, here in a Log Analytics workspace, when you want to work with the Network Performance Monitor, you have to add it here. Here's what that means. If I scroll down in the left-hand navigation bar for this Log Analytics workspace, I can then click on Workspace summary over on the left.

[Video description begins] He clicks an option called "Workspace summary" in the navigation pane and a blade called "Overview" opens. [Video description ends]

Now you're not going to see the Network Performance Monitor listed here by default. It's showing up here because I've already added it.  

[Video description begins] A blade called "Marketplace" opens. It is divided into two parts: navigation pane and content pane. [Video description ends]

What you would normally do is click the Add button up at the top and you would search for Network Performance Monitor.

[Video description begins] He selects an option called "Network Performance Monitor". [Video description ends]

And you could add it by selecting it from the marketplace, here it is. Network Performance Monitor from Microsoft, but I've already got that done. So I'm going to go back here to the Overview where the Network Performance Monitor panel is listed here.

[Video description begins] He switches to the Overview blade. He clicks an option called "Network Performance Monitor" and a blade called "Network Performance Monitor" opens. [Video description ends]

So, when you first go into that, you're going to be configuring it. So I'm going to go ahead and click on the Configure link up at the top.

[Video description begins] A blade called "Network Performance Monitor Configuration" opens. It is divided into two parts: navigation pane and content pane. [Video description ends]

And then on the left I'm going to click SETUP.

[Video description begins] He clicks an option called "SETUP" in the navigation pane and the corresponding page opens in the content pane. It includes tabs called "Common Settings", "Performance Monitor", "Service Connectivity Monitor", and "ExpressRoute Monitor". The Common Settings tab is selected. [Video description ends]

This is what you're going to see the first time you come in. It wants you to install the OMS agents, the monitoring agents within your hosts. Now if you added virtual machines to this Log Analytics workspace. They automatically already have the Microsoft monitoring agent extension installed. So it's already done. You can also tweak and configure performance monitoring.

[Video description begins] He selects the Performance Monitor tab. [Video description ends]

You can also tweak and configure service connectivity monitoring such as for Office 365, Microsoft Dynamics.

[Video description begins] He selects the Service Connectivity Monitor tab. [Video description ends]

You can also monitor ExpressRoute dedicated circuit connections.

[Video description begins] He selects the ExpressRoute Monitor tab. [Video description ends]

So over on the left, I'm going to click NETWORKS.

[Video description begins] He clicks an option called "NETWORKS" in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

I've already added a couple of networks here. I've got my default network and I can see the subnetwork range for that VNet is 10.0.1.0. But I've also already added VNet9 here. You can click the Add network button and just fill in the details for the network name. And you'll be able to select an unallocated subnet that it's detected down below here. So I've done that and I've called it VNet9. 

[Video description begins] He clicks an option called "SUBNETWORKS" in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

IThen if I click on SUBNETWORKS over on the left, 'll see the subnets that stem from those virtual networks.  

[Video description begins] He clicks an option called "NODES" in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

And if I click on NODES, I can see here I've got three virtual machines in Azure. They're up and running. The AGENT STATUS shows as being Healthy. Now these three virtual machines in my case are added to this Log Analytics workspace. And as we've mentioned, they automatically get the monitoring agent installed, so they're good and ready to go. 

[Video description begins] He clicks an option called "PERFORMANCE MONITOR" in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

And if I click PERFORMANCE MONITOR on the left, I can click add a rule.

[Video description begins] He clicks a drop-down list box called "Select a network" and selects an option called "VNet9". [Video description ends]

Now when I add a rule over on the right, I can select a network, I can select a subnet, and I can choose connectivity to another subnet.

[Video description begins] He clicks a drop-down list box called "Select a subnetwork" and selects an option called "13.0.1.0/24". [Video description ends]

I can add exceptions and I can tell it I want to use ICMP versus TCP to test the connectivity.

[Video description begins] He clicks a drop-down list box called "Select a network" and selects an option called "Default". He clicks a drop-down list box called "Select a subnetwork" and selects an option called "10.0.1.0/24". [Video description ends]

And I can determine when it will generate an alert if the connectivity between those subnets is not available. So the default is to autodetect sudden changes. But we can say if there is a loss, a packet condition loss, greater than or equal to a certain percentage. Or latency, network latency, speed greater than or equal to a certain number of milliseconds. So network latency means network slow down issues. So we can have that trigger. So once we've got that done, then our rule will show up. And if I go back to the overview here for my workspace summary.

[Video description begins] He opens the Overview blade. [Video description ends]

That's when, when you come into Network Performance Monitor, you get to see here that you've got some problems.

[Video description begins] He opens the DefaultWorkspace-048b82ac-4519-403b-ab05-6b4305502109-CCA blade. [Video description ends]

Potentially, hopefully not. So we know that within a Log Analytics workspace. If we scroll down and look at the workspace data sources that virtual machines can serve as a data source.

[Video description begins] He clicks an option called "Virtual machines" and the corresponding page opens in the content pane. [Video description ends]

And I've got a couple of them here, WinSrv2019-1, -2 and 3, they're added to this workspace. Of course, we can just click on it to open it up and connect or disconnect it.

[Video description begins] He clicks a Virtual machine called "WinSrv2019-1" and the corresponding blade opens. [Video description ends]

But once you actually connect a virtual machine to a workspace, the Microsoft monitoring agent is automatically installed in the VM.

[Video description begins] He closes the blade. [Video description ends]

And that way the VM can report back to this Log Analytics workspace. So let's just flip over and take a look at one of those virtual machines.

[Video description begins] He opens a new Microsoft Azure web portal. The Virtual machines blade is open. He clicks the WinSrv2019-1 virtual machine and the corresponding blade opens. It is divided into two parts: navigation pane and content pane. [Video description ends]

If I actually click to open it up, and if we take a look at the virtual machine extensions.

[Video description begins] He clicks an option called 'Extensions" in the navigation pane and the corresponding page opens in the content pane. it includes a table with three columns and three rows. The column headers are Name, Type, and Version. [Video description ends]

What will have been added because it won't have been there before is the Microsoft Azure monitoring dependency agent. That gets installed when you connect or link that VM to a workspace. Now in the case of Network Performance Monitoring, that's going to be important.

[Video description begins] He switches back to the DefaultWorkspace-048b82ac-4519-403b-ab05-6b4305502109-CCA | Virtual machines blade in the previous Microsoft Azure web portal. [Video description ends]

If we take a look at the result of our configuration. If we go under Workspace summary here in the Log Analytics workspace.

[Video description begins] He clicks the Workspace summary option in the navigation pane and the Overview blade opens. [Video description ends]

We could see that now that it's had time for those servers to start reporting back information about network connectivity. We're going to start seeing some potential alerts. I can see there's an alert here. There's 1 of 1 subnetwork link that is considered unhealthy. 

[Video description begins] He clicks the Network Performance Monitor option and the Network Performance Monitor blade opens. [Video description ends]

So if I click on that panel to open it up, then I can read more details about exactly what the issue is. So we can see that that health event was generated by a rule called Rule1. And if I kind of click on that rule to see what it's about, we've got a 100% transmission loss.

[Video description begins] He clicks a link called "Rule 1" and a blade called "Affected Subnetworks Link" opens. [Video description ends]

And we can see it's between subnets within the rule that were specified. And in this case, those subnets are the 10.0.1.0 subnet, and the 13.0.1.0 subnet. There's a link on the right that says View affected node links. So I could also click on that to get even further detail.

[Video description begins] A blade called "Node Links" opens. [Video description ends]

And from here I can see the node links where on the left I have the name of a virtual machine. And it's pointing to another one listed to the right of it. And I can see the IP address interfaces, and I can see in this case we have a 100% packet loss. Now, that often might be due to routing problems between subnets and so on. But this is one of the overall purposes of using Network Performance Monitor or NPM in Azure. To identify these types of network connectivity issues.
Network Watcher

[Video description begins] Topic title: Network Watcher. The presenter is Dan Lachance. [Video description ends]

Before you can troubleshoot network connectivity issues in Azure, you need to be aware of the network configuration. You've got to know what's there. How many VNets, subnets, VNet peering is enabled and so on.

[Video description begins] The Microsoft Azure web portal opens. [Video description ends]

So here in the portal, I'm going to search for network and I'm going to select Network Watcher from the list.

[Video description begins] A blade called "Network Watcher" opens. It is divided into two parts: navigation pane and content pane. [Video description ends]

One of the things I can do here is click on Topology over in the left-hand navigation bar to open up the Topology blade.

[Video description begins] He clicks an option called "Topology" in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

Now on the right, it's got my subscription automatically selected from the Resource Group drop-down list. I'm going to choose a resource group I'm interested in here.

[Video description begins] He clicks a drop-down list box called "Resource group" and selects an option called "Rg1". [Video description ends]

And I can also select a VNet to further filter my topology map.

[Video description begins] He clicks a drop-down list box called "Virtual Network" and selects an option called "VNet1". The Topology map is displayed. [Video description ends]

It draws a topology map in a hierarchy, where at the top, we have our virtual network. In this case, it's called VNet1 under which we then see the subnets. And this is part of knowing what you have. If you're called in to troubleshoot something and you didn't set it up, it's helpful to know what's there. So we can see we have a number of subnets, including a GatewaySubnet, an AzureFireWallSubnet, an AzureBastionSubnet. And under each subnet we can then see the associated network interfaces and ultimately the public IP addresses associated with those interfaces and of course the virtual machines. So this is one of the things we can do with the Network Watcher tool, is learn a bit about our topology in the Azure environment. Over on the left, I can also click on Connection monitor.

[Video description begins] He clicks an option called "Connection monitor" in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

So I can click the Add button over on the right to add a connection monitor.

[Video description begins] A blade called "Add connection monitor" opens. [Video description ends]

I'm going to call this Monitor1.

[Video description begins] He enters Monitor1 in a text box called "Name". [Video description ends]

And I'm going to select a virtual machine here that would be a virtual machine that is the source I want to monitor from and then I want to select a destination virtual machine.

[Video description begins] He clicks a drop-down list box called "Virtual machine" and selects an option called "WinSrv2019-1". [Video description ends]

I can also specify a port number on which I want that connectivity to be checked.

[Video description begins] He clicks a drop-down list box called "Virtual machine" and selects an option called "WinSrv2019-2". [Video description ends]

So I'll put in Port 80 and I'll just click Add to add that connection monitor.

[Video description begins] He enters 80 in a text box called "Port". [Video description ends]

And we can now see the monitor has been added to the list and under the Status column it says it is currently running.

[Video description begins] He clicks a button called "Add" and the Add connection monitor blade closes. [Video description ends]

Now we can actually click on that connection monitor configuration and that'll open up another panel down below where we can scroll down and see some details over the last hour, six hour all the way up to the last 30 days. And down below according to the legend, we can see that we've got percentage of probes that have failed is 100. That's not good. Well, that could be due to a number of reasons. Perhaps the target virtual machine isn't reachable due to routing problems, but if they're in the same subnet, it's not a routing issue. Or it could be a network security group preventing connectivity to a port. Or perhaps Port 80 simply isn't in a listening state on that machine, there's no web server. So there are plenty of reasons that could happen, but we can identify that this is happening here using Network Watcher. We can also run a Packet capture as we can see over here on the left, we can view our Effective security rules, network security group security rule.

[Video description begins] He clicks an option called "Effective security rules" in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

So from here we can select the subscription, a resource group and ultimately a virtual machine.

[Video description begins] He clicks a drop-down list box called "Resource group" and selects an option called "Rg1". [Video description ends]

So when I do that I can see a network interface for that virtual machine and the association with the network security group here at the subnet level that says as opposed to linked directly to the network interface, and we can see any rules that might be applicable.

[Video description begins] He clicks a drop-down list box called "Virtual machine" and selects an option called "WinSrv2019-1". [Video description ends]

We can also click on Packet capture on the left and click the Add button to add a packet capturing session.

[Video description begins] He clicks an option called "Packet capture" in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

Sometimes you'll create a packet capturing session because you want to be able to actually examine the detailed specific network traffic that is occurring on a network.

[Video description begins] A blade called "Add packet capture" opens. [Video description ends]

Now specifically what you're going to do is to choose the target virtual machine that you're interested in and you can select to store the resultant packet file name, the packet capture file name in a storage account. Or you can have it stored in a file within the virtual machine in question, the target virtual machine that we have to select above or you can have it stored in both places. The packet capture file will use a .cap format. So you can open it up with standard tools like Wireshark.

                    AZ900 Microsoft Azure Cloud Fundamentals 2021
                    Additional Material Course Notes Part 34


Azure Cost Analysis
  - One important aspect of cloud computing is being able to manage costs, even though it's often pay-as-you-go, you get charged for your resource consumption
    - You want to make sure that you are tracking it and identifying where most of those charges are coming from
    - We can do that by looking at Azure cost analysis.
    - To get started here in the portal, we are going to go into Subscriptions, because billing occurs at the subscription level.
  - We've got a Pay-As-You-Go subscription listed here, we can see the Current cost, and  can see that it's Active.
    - We are going to click directly on the subscription.
    - Because when we do that, we get this new navigation bar on the left
    - And one of the things we see is Cost analysis, which is precisely what we want to do right now.
  - Knowing that we have a specific dollar amount based on my Azure usage is not enough
    - We want to know how it's broken down, in the example, we can see it's Canadian dollars. It's only $1 and 48 cents
    - We can see that it's charted here, just scroll little bit over to the right according to days of the month as we can see
    - It looks like the usage has been increasing since about March 4th
    - If we scroll down a little bit, we can also see the Service name breakdown
    - Well, where is that money being spent? Is it virtual machines? Is it storage? Is it databases?
    - We can see by looking under Service name at this graph, that we've got the bulk of it coming from SQL database.
  - Little bit coming from virtual machines and storage and we can also then see it's broken down here by Location
    - We might have different Azure administrators using our Azure account to deploy resources in different Azure regions
    - We can see the cost here per region that looks like all of the cost is stemming from the US East region
    - Now, depending on how you use resource groups to organize related Azure resources it will determine how useful it is to look at the cost per resource group.
  - Often many organizations will create resource groups for specific apps that might have multiple components like a web server type of app
    - It might have some custom code and it might have a back-end database
    - All of those resources might be organised in one resource group and then you can see the charges per resource group
    - Basically, in that example, you'd be able to see the charges per web application
    - Or you might have resource groups for different departments, if that make sense in your organization or different projects
    - And then you would deploy resources into them accordingly
    - Tou'll then be able to see the cost breakdown per resource group
    - It really depends on what your requirements are
    - You can also click the Export button to export this information as a PNG type of graphic file or as Excel data or as a CSV file.
  - Then you can download the charts, you can also schedule the export of this information on a periodic basis 
    - Maybe to a storage account for business analysts that might require this type of cost breakdown.
    - Now, we can also get a little more granular at the top by clicking Cost by resource.
  - Why is this useful? Because it's showing us the individual Azure resources, like specific SQL servers that were deployed specific virtual machines
    - Disks for virtual machines, storage accounts, and so on.
    - Wee have a cost associated with it over in the right hand column.
    - So it's just a way to really drill right down to the specific deployed resources that are incurring costs in your Azure account through your subscription.


Azure Budgets
  - While it's important to analyze costs and pore over the numbers
    - It's also equally important to save time and get notified when costs on a monthly basis exceed a certain value
    - That's where Azure budgets come in as being useful.
  - So I'm going to click here in the portal on Subscriptions. I see, I have a Pay-As-You-Go subscription, which I'm going to click on.
    - Now we know that we can click on Cost analysis, and of course, that is very important.
    - But we're talking here about getting notified when a certain threshold value is exceeded
    - For that, we're going to go to Budgets over here on the left, we don't have any budget shown on the right.
  - Go ahead and click Add The first thing you have to think about is the scope to which you want the budget applied
    - What do you want to look at costs for, do you want to look at it for your entire subscription?
    - We can click Change scope and from here, we could switch to a different directory.
  - Right now, we are using the Quick24x7 Azure AD tenant
    - We could also drill down, for example, under our root management group for our tenant, we can click that.
    - We can then click down on a management group, perhaps that's the level where we want to apply the budget.
    - We can also click on the management group and then go down under my subscription, and even go down into a specific resource group.
  - You have all of these scopes that you can apply your budget to
    - We are just going to Cancel out of there and are going to leave it directly on our Pay-As-You-Go subscription.
  - We could also click Add filter, because maybe what we want to do is filter by something specific.
    - For example, we could specify that we want to look at a type of service we want to filter on
    - Or maybe a ResourceLocation, so we can choose a specific region if we wanted to filter on that.
    - However, we going to click the x to remove the filter as we don't want to apply that.
  - The next thing that need to do here is, we need to specify a unique name for the budget.
    - This example we are going to call this Budget1.
    - The Reset period will be on a monthly basis, but we could change that to whatever time period makes the most sense for me, we could set an Expiration date.
  - We are going to leave those default settings, and we are going to set the budget amount
    - For example, we want to know once we're exceeding $500 a month
    - To help along with this, down below, we can see last month's costs
    - We can see the past six months' cost, and the maximum monthly forecast cost
    - Based on those small values, perhaps 500 is a little large
    - Maybe for example, if we get above a 100, which might be indicative of abnormal cloud usage in our particular case, then we can put that value in.
  - Having done that, we are going to scroll down and click on the Next> button
    - Up at the top, if we scroll back up, we can set alerts.
    - When we get to a percentage of that value, let's see when we get to 80% of our $100, then we want to have something happen.
  - We can work with an Action group, the Action group allows us to specify things like, what you want to occur
    - Do you want to trigger some kind of code, or do you want to trigger some kind of a notification?
    - We even have a Manage action group option here, click on that, it'll take us in where we can see what we could do
    - What could be triggered when 80% of our budget is reached.
    - We could click Add action group, maybe what we want to do send something like an SMS text message.
  - We are going to call this AG1 for action group 1, the same thing for the Short name, which is a required field, as indicated by the red asterisk.
    - Down below, what we want to do is Select an action type.
    - In this case, it's going to be Email/SMS/Push/Voice.
  - Let's say that we want to send SMS text notifications, it's country code, and we could just fill in the number
    - After we've done that, we would then go down and click OK
    - Of course, it wants us to fill in a valid phone number
    - We'll just change it into something else
    - All 5s in a phone number is actually reserved and used for works of fiction like movies and television shows
    - We just going to go ahead and leave that as it is for SMS
    - So we're just basically adding this specific type of notification
    - We are just going to call this TextMsgNotify, this is in our action group AG1 and click OK.
  - Essentially, we want to be able to use that within our budget.
    - It's showing up in the list, go ahead and select it to get back to where we were in configuring our notifications
    - We are just going to scroll back here, we've got AG1, and go back here, that's where we want this to be showing up
  - After a moment, you might have to go to the previous screen and back, you'll see the group
    - Here it is, AG1, down below we can also specify, of course, the recipients' email
    - We just going to scroll over to the right so that we can see the scroll bar
  - Maybe, we've got a group called admins@quick24x7.com, and we want them to receive notifications in addition to our SMS text messaging
    - So having done that, we are just good to go down and create the budget
    - There you have it, the budget creation succeeded, we now have our budget called Budget1
    - We can expect to be notified when we get to 80% of our budgeted value in the currency specified for the subscription, in this case, CA$100.00


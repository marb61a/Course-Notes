                    AZ900 Microsoft Azure Cloud Fundamentals 2021
                    Additional Material Course Notes Part 14
                    
                    
Performance Metrics
Using performance metrics and monitoring them in Azure helps you optimize the performance of resources. For things like virtual machines or for web applications. If you're using, for example, Application Insights to track the performance of a web app.

[Video description begins] The Microsoft Azure web portal opens. [Video description ends]

Let's open up an existing virtual machine here in the portal to view its individual performance metrics. 

[Video description begins] He clicks a virtual machine called "WinSrv2019-1" and the corresponding blade opens. It is divided into two parts: navigation pane and content pane. [Video description ends]

Now we can do that by scrolling down in the navigation bar or the properties for that VM. All the way down under the Monitoring section where we can click on Metrics.

[Video description begins] The corresponding page opens in the content pane. [Video description ends]

Now over here on the right, we can select a metric from the drop-down list. So for example, I'm going to go down, let's say into the P's and choose Percentage CPU. And we can see that the CPU performance metric has been mapped on a chart.

[Video description begins] He clicks a drop-down list box called "Metric" and selects an option called "Percentage CPU". [Video description ends]

We can see the percentages going up on the left. And it's plotted against a timeline going across the bottom from left to right.

[Video description begins] He points to the graph. [Video description ends]

But you can also click the Add metric button to add more than one metric on a single graph. So for example, maybe I'm interested in some other metric like Disk Write Bytes if I'm interested in disk performance.

[Video description begins] He clicks the Metric drop-down list box and selects an option called "Disk Write Bytes". [Video description ends]

So now I've got both items plotted. And I can see by the legend that in this particular case, the Disk Write Bytes is shown in red. So I can track that performance metric separately from my Percentage CPU. If I hover over any of those metrics, it allows me to zoom in on that specific metric. Because it's highlighted and everything else is dimmed on the graph. We can also pin this to a dashboard so that we have an easy convenient way to look at this. Instead of coming in each time we're interested in this and setting it up from scratch. 

[Video description begins] He clicks an option called "Overview" in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

Now if I go back to the Overview blade for this VM over on the right, if I scroll down. 

[Video description begins] The content pane includes graphs called "CPU (average)", "Network (total)", "Disk bytes (total)", and "Disk operations/sec (average)". [Video description ends]

I can also see some standard performance metrics, which by default shows me activity for the last hour. But I could choose, let's say last 7 days.

[Video description begins] He selects an option called "7 days". [Video description ends]

Where I can see the CPU usage average, the network traffic total, I can see the disk bytes total, disk operations per second. So we've got a lot of these items that are here automatically by default. But let me search here in the search bar in the portal for monitor.

[Video description begins] He clicks the Monitor option and the Monitor blade opens. It is divided into two parts: navigation pane and content pane. [Video description ends]

Azure Monitor is a centralized tool that allows you to also view performance metrics from here, instead of from an individual resource.

[Video description begins] He selects an option called "Metrics" in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

Now from here I have to select a scope.

[Video description begins] He opens the Select a scope blade. it includes tabs called "Browse" and "Recent". The Browse tab is selected. It includes a table with three columns and several rows. The column headers are Scope, Resource type, and Location. [Video description ends]

So this is different because we're not already in a resource like a VM, so it doesn't know what to show us. We have to select a scope. So I can drill down within a subscription and then ultimately within a resource group.

[Video description begins] He points to a subscription called "Pay-As-You-Go" under the Scope column header. [Video description ends]

And I could even select, for example, a Log Analytics workspace.

[Video description begins] He expands a resource group called "defaultresourcegroup-cca". [Video description ends]

So what we could do here is we have the ability because notice that we can expand and collapse our subscriptions. This is a way for you to be able to monitor performance metrics across different subscriptions by adding different scopes. So I'm going to add a Log Analytics workspace here and I'll click Apply.

[Video description begins] He clicks a button called "Apply" and the Select a scope blade closes. [Video description ends]

Now what you have to think about is the data sources attached to that Log Analytics workspace. So the specific virtual machines or storage account logs. Because from there you'll be able to then determine which specific metrics you might be interested in. 

[Video description begins] He clicks a drop-down list box called "Metric" and selects an option called "Disk Writes/sec". [Video description ends]

So for example, if I were to choose, let's say Disk Writes/sec, then I will have some information plotted that is available based on all of the information that's made available to that Log Analytics workspace.

Action Groups and Alert Rules
Instead of going to each and every resource in Azure to monitor the performance, you can configure instead alerts. Alerts can send you notifications through your configuration of what are called action groups. And this way, you are notified when there are issues based on your configured thresholds, instead of you having to go through and peruse all of your Azure resources, which is much more time consuming.

[Video description begins] The Microsoft Azure web portal opens. [Video description ends]

So let's get started with this. First thing I want to do here is open up an existing Log Analytics workspace.

[Video description begins] He clicks a Log Analytics workspace called "LogAnalytics-2yhz76" and the corresponding blade opens. It is divided into two parts: navigation pane and content pane. [Video description ends]

The reason I'm doing this is because a Log Analytics workspace is a centralized logging hub. Where if I scroll down in the navigation bar, we have a number of different types of data sources that can feed their performance metric and log data into this Log Analytics workspace. And so as a result, we can configure some alerting here within the Log Analytics workspace. So if I scroll down under the Monitoring section in the left-hand navigator, there's Alerts.

[Video description begins] He clicks an option called "Alerts" in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

Now these are alerts that will be specific to this Log Analytics workspace. So before I create an alert rule, I'm going to first click on Manage actions.

[Video description begins] He clicks a button called "Manage actions" and the corresponding blade opens. It includes a table with five columns and one row. The column headers are Action group name, Short name, Resource group, Status, and Actions. [Video description ends]

When I do that, I can create a new action group, I can add an action group. There might be some that are here already based on what you might have configured previously, but I'm going to add a new action group.

[Video description begins] He clicks a button called "Add action group" and a blade called "Add action group" opens. [Video description ends]

And this action group is going to be used for notification for administrators. I'm going to call it AdminNotify.

[Video description begins] He enters AdminNotify in a text box called "Action group name". [Video description ends]

The short name will be the same because the Short name field is required. The next thing down below is I'm going to add an action type, you can add multiple action types to this action group. We can see here we can trigger an Automation Runbook or an Azure Function, or we can have an e-mail message sent or in my case I want an SMS text message sent. 

[Video description begins] He clicks a drop-down list box called "Action Type" and selects an option called "Email/SMS/Push/Voice". A blade called "Email/SMS/Push/Voice" opens. [Video description ends]

So I'm going to select that item, that's going to open up a new blade where I'm going to turn on the check mark for SMS and I'm going to specify a phone number.

[Video description begins] The Email/SMS/Push/Voice blade closes. [Video description ends]

Now the next thing I need to do is supply a name, so I'm going to call it TextITDirector.

[Video description begins] He enters TextITDirector in a text box called "Action name". [Video description ends]

And then I'm going to click OK. So I've got my action group configuration created and it now shows up in the list, it says AdminNotify.

[Video description begins] He clicks a button called "OK" and the Add action group blade closes. [Video description ends]

Let's go back into the Alerts for our Log Analytics workspace. And in the Alerts blade or view, I'm going to click New alert rule.

[Video description begins] He clicks a button called "New alert rule" and a blade called "Create rule" opens. [Video description ends]

I want to create an alert to be notified when something happens. In this case, specifically be notified through an SMS text message based on the phone number we've configured. So the resource here in the alert rule is already specified. It's a specific Log Analytics workspace. It could be based on something else. I mean we could have done this, we could have configured an alert for a specific virtual machine for example. But in this case, the resource is the Log Analytics workspace. Now we have to add a condition. So under CONDITION, I will click Add.

[Video description begins] He clicks a button called "Add" and a blade called "Configure signal logic" opens. It includes a table with three columns and several rows. The column headers are Signal name, Signal type, and Monitor service. [Video description ends]

So for the Monitor service in the upper right in that drop-down list, I'm going to choose Platform. I'm going to see platform-specific items and I'm going to filter the list for processor and there we go, % Processor Time.

[Video description begins] He clicks a drop-down list box called "Monitor service" and selects an option called "Platform". [Video description ends]

So I'm going to select that item to configure a condition.

[Video description begins] He clicks a row entry % Processor Time under the Signal name column header. [Video description ends]

I want to look for busy or overburdened processor utilization. Then I'm going to scroll down and I can select a specific dimension if I want to filter or zoom into a specific Computer or an ObjectName and so on.

[Video description begins] He enters 80 in a text box called "Threshold value". [Video description ends]

But I don't, I just want it overall. So what I want to do is essentially I want to be notified when we've got an 80% Greater than, 80% on Average of CPU utilization. Now we can see the frequency of evaluating this type of condition which is going to be every minute. And we can see the Aggregation granularity (Period) is set to 5 minutes. So I'm going to go ahead and click Done.

[Video description begins] He clicks a button called "Done" and the Configure signal logic blade closes. [Video description ends]

So we've now got our condition whenever the CPU processor utilization is above a certain amount. Then we have to go down and apply this to an action group. We don't have an action group selected, but we just created one recently. So I'm going to go ahead and click on Add.

[Video description begins] He clicks a button called "Add" and a blade called "Select an action group to attach to this alert rule" opens. It includes a table with two columns and two rows. The column headers are Action group name and Contain actions. [Video description ends]

There's the AdminNotify action group where we've got 1 SMS text message that will be sent, and I'm going to go ahead and choose Select.

[Video description begins] He selects a checkbox for a row entry called "AdminNotify" under the Action group column header and clicks a button called "Select". The blade closes. [Video description ends]

Then all the way down at the bottom, I have to give this a name. So I'm going to call this alert rule BusyCPU, and I'm going to scroll down further and just click outside of that, and then I can click Create alert rule.

[Video description begins] He enters BusyCPU in a text box called "Alert rule name". [Video description ends]

Now if we have any issues related to that alert rule, they will show up here in the Alerts blade or the Alerts view.

[Video description begins] He clicks a button called "Create alert rule" and the Create rule blade closes. [Video description ends]

Now we can also use our action groups and configure alerts for an individual resource as we've alluded to.

[Video description begins] He clicks the Home link and the home page of the Microsoft Azure opens. [Video description ends]

So let's say I opened up an individual virtual machine here in the portal.

[Video description begins] He clicks the WinSrv2019-1 virtual machine and the corresponding blade opens. [Video description ends]

What I could do is scroll down in its navigation bar on the left, and go down under Monitoring and there's Alerts.

[Video description begins] He clicks the Alerts option in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

When I go into Alerts, it's the same type of interface that we just saw.

[Video description begins] He clicks a button called "Manage alert rules" and a blade called "Rules" opens. [Video description ends]

For example if I click Manage alert rules, I will see any alert rules created for this specific resource of which there are none. Now I could click New alert rule, and I could go through and configure the same type of thing we did.

[Video description begins] He clicks the New alert rule button and the Create rule blade opens. [Video description ends]

The difference being that the resource is a specific VM as opposed to a Log Analytics workspace. So I could go through the same types of motions and add a condition for it. 

[Video description begins] He clicks the Add button and the corresponding blade opens. [Video description ends]

And when it comes to the action groups, if I were to click Add, then I would see my global list of action groups including AdminNotify.
Application Insights

[Video description begins] Topic title: Application Insights. The presenter is Dan Lachance. [Video description ends]

One common use of Microsoft Azure is the deployment of customized web applications. And so developers will always be interested in monitoring how the app is being used and how it's performing. And we can do that by enabling Application Insights.

[Video description begins] The Microsoft Azure web portal opens. [Video description ends]

So here in the portal, to do that, I'm going to create a new web application.

[Video description begins] He clicks a link called "Create a resource" and a blade called "New" opens. [Video description ends]

And during the creation I'm going to make sure I enable Application Insights, you can also turn it on after the fact.

[Video description begins] He enters web in the search box and selects an option called "Web App". A blade called "Web App" opens. [Video description ends]

So when I go to create a web app, there are some common things I need to fill in.

[Video description begins] He clicks a button called "Create" and a blade called "Web App" opens. It includes tabs called "basics", "Monitoring", "Tags", and "Review + create". The Basics tab is selected. [Video description ends]

Including the resource group it will be deployed into, a name for it.

[Video description begins] He clicks a drop-down list box called "Resource group" and selects an option called "Rg1". [Video description ends]

So I'm just going to put in a unique name here, custom name.

[Video description begins] He enters webappyhz44660 in a text box called "Name". [Video description ends]

And I'm going to use a code-based application, I'll just choose here, let's say ASP.NET.

[Video description begins] He clicks a drop-down list box called "Runtime stack" and selects an option called "ASP.NET V4.7". [Video description ends]

I'm going to deploy this in Canada Central as a region.

[Video description begins] He clicks a drop-down list box called "Region" and selects an option called "Canada Central". [Video description ends]

And it's going to create a new application service plan, App Service Plan. That's fine, it determines the underlying horsepower and the pricing tier, I'm going to accept the default for the sizing. I'm going to click Next on monitoring, so Next: Monitoring.

[Video description begins] He clicks a button called "Next: Monitoring" and the Monitoring tab opens. [Video description ends]

This is where we want to make sure that Application Insights is enabled. And it is, it's set to Yes. And it's going to create a new Application Insights resource. And here, it's pretty much got the name of my web application. That's fine, perfect. 

[Video description begins] He clicks a button called "Next: Tags" and the Tags tab opens. [Video description ends]

So I'm going to go ahead and choose Next, and continue all the way through accepting defaults by clicking the Next button.

[Video description begins] He clicks a button called "Next: Review + create" and the Review + create tab opens. [Video description ends]

Finally, I'll click the Create button to create this web app where App Insights is actually enabled now.

[Video description begins] A blade called "Microsoft.Web-WebApp-Portal-d1ce8ec2-b131 | Overview" opens. It is divided into two parts: navigation pane and content pane. [Video description ends]

We can now see our deployment is complete, I'm going to click Go to resource to go into the web application.

[Video description begins] He clicks a button called "Go to resource" and a blade called "webappyhz44660" opens. It is divided into two parts: navigation pane and content pane. [Video description ends]

Where in the left-hand navigation bar, if I scroll down under the Settings section, I'll see Application Insights. I'm going to click to open up that blade.

[Video description begins] He selects an option called "Application Insights" in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

We're over on the right, I can see it's enabled, this is where you can enable or disable it. And I can see that it's connected to my Application Insights resource. So there's a separate resource that's created and there's a link to it here, which I will click on.

[Video description begins] He clicks a link called "webappyhz44660" and the corresponding blade opens. [Video description ends]

In the Overview blade of the App Insights object, so that's what we're looking at now, over on the right. I can see some performance metrics such as Failed requests for the app, Server response time, Server requests, and overall Availability. 

[Video description begins] He clicks an option called "Live Metrics" in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

If I click Live Metrics over on the left, after a moment I'll get some new live metrics related to my application. So Incoming Requests, Request Duration, failure rates, and so on. So for developers, this is going to be absolutely crucial so that they might know what to tweak within the application to optimize performance.
Network Performance Monitor

[Video description begins] Topic title: Network Performance Monitor. The presenter is Dan Lachance. [Video description ends]

In Azure, the Network Performance Monitor tool allows you to monitor and identify network problems. Whether they're related to firewall issues or maybe they're related to routing configuration errors.

[Video description begins] The Microsoft Azure web portal opens. A blade called "DefaultWorkspace-048b82ac-4519-403b-ab05-6b4305502109-CCA" is open. It is divided into two parts: navigation pane and content pane. [Video description ends]

Either way, here in a Log Analytics workspace, when you want to work with the Network Performance Monitor, you have to add it here. Here's what that means. If I scroll down in the left-hand navigation bar for this Log Analytics workspace, I can then click on Workspace summary over on the left.

[Video description begins] He clicks an option called "Workspace summary" in the navigation pane and a blade called "Overview" opens. [Video description ends]

Now you're not going to see the Network Performance Monitor listed here by default. It's showing up here because I've already added it.  

[Video description begins] A blade called "Marketplace" opens. It is divided into two parts: navigation pane and content pane. [Video description ends]

What you would normally do is click the Add button up at the top and you would search for Network Performance Monitor.

[Video description begins] He selects an option called "Network Performance Monitor". [Video description ends]

And you could add it by selecting it from the marketplace, here it is. Network Performance Monitor from Microsoft, but I've already got that done. So I'm going to go back here to the Overview where the Network Performance Monitor panel is listed here.

[Video description begins] He switches to the Overview blade. He clicks an option called "Network Performance Monitor" and a blade called "Network Performance Monitor" opens. [Video description ends]

So, when you first go into that, you're going to be configuring it. So I'm going to go ahead and click on the Configure link up at the top.

[Video description begins] A blade called "Network Performance Monitor Configuration" opens. It is divided into two parts: navigation pane and content pane. [Video description ends]

And then on the left I'm going to click SETUP.

[Video description begins] He clicks an option called "SETUP" in the navigation pane and the corresponding page opens in the content pane. It includes tabs called "Common Settings", "Performance Monitor", "Service Connectivity Monitor", and "ExpressRoute Monitor". The Common Settings tab is selected. [Video description ends]

This is what you're going to see the first time you come in. It wants you to install the OMS agents, the monitoring agents within your hosts. Now if you added virtual machines to this Log Analytics workspace. They automatically already have the Microsoft monitoring agent extension installed. So it's already done. You can also tweak and configure performance monitoring.

[Video description begins] He selects the Performance Monitor tab. [Video description ends]

You can also tweak and configure service connectivity monitoring such as for Office 365, Microsoft Dynamics.

[Video description begins] He selects the Service Connectivity Monitor tab. [Video description ends]

You can also monitor ExpressRoute dedicated circuit connections.

[Video description begins] He selects the ExpressRoute Monitor tab. [Video description ends]

So over on the left, I'm going to click NETWORKS.

[Video description begins] He clicks an option called "NETWORKS" in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

I've already added a couple of networks here. I've got my default network and I can see the subnetwork range for that VNet is 10.0.1.0. But I've also already added VNet9 here. You can click the Add network button and just fill in the details for the network name. And you'll be able to select an unallocated subnet that it's detected down below here. So I've done that and I've called it VNet9. 

[Video description begins] He clicks an option called "SUBNETWORKS" in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

IThen if I click on SUBNETWORKS over on the left, 'll see the subnets that stem from those virtual networks.  

[Video description begins] He clicks an option called "NODES" in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

And if I click on NODES, I can see here I've got three virtual machines in Azure. They're up and running. The AGENT STATUS shows as being Healthy. Now these three virtual machines in my case are added to this Log Analytics workspace. And as we've mentioned, they automatically get the monitoring agent installed, so they're good and ready to go. 

[Video description begins] He clicks an option called "PERFORMANCE MONITOR" in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

And if I click PERFORMANCE MONITOR on the left, I can click add a rule.

[Video description begins] He clicks a drop-down list box called "Select a network" and selects an option called "VNet9". [Video description ends]

Now when I add a rule over on the right, I can select a network, I can select a subnet, and I can choose connectivity to another subnet.

[Video description begins] He clicks a drop-down list box called "Select a subnetwork" and selects an option called "13.0.1.0/24". [Video description ends]

I can add exceptions and I can tell it I want to use ICMP versus TCP to test the connectivity.

[Video description begins] He clicks a drop-down list box called "Select a network" and selects an option called "Default". He clicks a drop-down list box called "Select a subnetwork" and selects an option called "10.0.1.0/24". [Video description ends]

And I can determine when it will generate an alert if the connectivity between those subnets is not available. So the default is to autodetect sudden changes. But we can say if there is a loss, a packet condition loss, greater than or equal to a certain percentage. Or latency, network latency, speed greater than or equal to a certain number of milliseconds. So network latency means network slow down issues. So we can have that trigger. So once we've got that done, then our rule will show up. And if I go back to the overview here for my workspace summary.

[Video description begins] He opens the Overview blade. [Video description ends]

That's when, when you come into Network Performance Monitor, you get to see here that you've got some problems.

[Video description begins] He opens the DefaultWorkspace-048b82ac-4519-403b-ab05-6b4305502109-CCA blade. [Video description ends]

Potentially, hopefully not. So we know that within a Log Analytics workspace. If we scroll down and look at the workspace data sources that virtual machines can serve as a data source.

[Video description begins] He clicks an option called "Virtual machines" and the corresponding page opens in the content pane. [Video description ends]

And I've got a couple of them here, WinSrv2019-1, -2 and 3, they're added to this workspace. Of course, we can just click on it to open it up and connect or disconnect it.

[Video description begins] He clicks a Virtual machine called "WinSrv2019-1" and the corresponding blade opens. [Video description ends]

But once you actually connect a virtual machine to a workspace, the Microsoft monitoring agent is automatically installed in the VM.

[Video description begins] He closes the blade. [Video description ends]

And that way the VM can report back to this Log Analytics workspace. So let's just flip over and take a look at one of those virtual machines.

[Video description begins] He opens a new Microsoft Azure web portal. The Virtual machines blade is open. He clicks the WinSrv2019-1 virtual machine and the corresponding blade opens. It is divided into two parts: navigation pane and content pane. [Video description ends]

If I actually click to open it up, and if we take a look at the virtual machine extensions.

[Video description begins] He clicks an option called 'Extensions" in the navigation pane and the corresponding page opens in the content pane. it includes a table with three columns and three rows. The column headers are Name, Type, and Version. [Video description ends]

What will have been added because it won't have been there before is the Microsoft Azure monitoring dependency agent. That gets installed when you connect or link that VM to a workspace. Now in the case of Network Performance Monitoring, that's going to be important.

[Video description begins] He switches back to the DefaultWorkspace-048b82ac-4519-403b-ab05-6b4305502109-CCA | Virtual machines blade in the previous Microsoft Azure web portal. [Video description ends]

If we take a look at the result of our configuration. If we go under Workspace summary here in the Log Analytics workspace.

[Video description begins] He clicks the Workspace summary option in the navigation pane and the Overview blade opens. [Video description ends]

We could see that now that it's had time for those servers to start reporting back information about network connectivity. We're going to start seeing some potential alerts. I can see there's an alert here. There's 1 of 1 subnetwork link that is considered unhealthy. 

[Video description begins] He clicks the Network Performance Monitor option and the Network Performance Monitor blade opens. [Video description ends]

So if I click on that panel to open it up, then I can read more details about exactly what the issue is. So we can see that that health event was generated by a rule called Rule1. And if I kind of click on that rule to see what it's about, we've got a 100% transmission loss.

[Video description begins] He clicks a link called "Rule 1" and a blade called "Affected Subnetworks Link" opens. [Video description ends]

And we can see it's between subnets within the rule that were specified. And in this case, those subnets are the 10.0.1.0 subnet, and the 13.0.1.0 subnet. There's a link on the right that says View affected node links. So I could also click on that to get even further detail.

[Video description begins] A blade called "Node Links" opens. [Video description ends]

And from here I can see the node links where on the left I have the name of a virtual machine. And it's pointing to another one listed to the right of it. And I can see the IP address interfaces, and I can see in this case we have a 100% packet loss. Now, that often might be due to routing problems between subnets and so on. But this is one of the overall purposes of using Network Performance Monitor or NPM in Azure. To identify these types of network connectivity issues.
Network Watcher

[Video description begins] Topic title: Network Watcher. The presenter is Dan Lachance. [Video description ends]

Before you can troubleshoot network connectivity issues in Azure, you need to be aware of the network configuration. You've got to know what's there. How many VNets, subnets, VNet peering is enabled and so on.

[Video description begins] The Microsoft Azure web portal opens. [Video description ends]

So here in the portal, I'm going to search for network and I'm going to select Network Watcher from the list.

[Video description begins] A blade called "Network Watcher" opens. It is divided into two parts: navigation pane and content pane. [Video description ends]

One of the things I can do here is click on Topology over in the left-hand navigation bar to open up the Topology blade.

[Video description begins] He clicks an option called "Topology" in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

Now on the right, it's got my subscription automatically selected from the Resource Group drop-down list. I'm going to choose a resource group I'm interested in here.

[Video description begins] He clicks a drop-down list box called "Resource group" and selects an option called "Rg1". [Video description ends]

And I can also select a VNet to further filter my topology map.

[Video description begins] He clicks a drop-down list box called "Virtual Network" and selects an option called "VNet1". The Topology map is displayed. [Video description ends]

It draws a topology map in a hierarchy, where at the top, we have our virtual network. In this case, it's called VNet1 under which we then see the subnets. And this is part of knowing what you have. If you're called in to troubleshoot something and you didn't set it up, it's helpful to know what's there. So we can see we have a number of subnets, including a GatewaySubnet, an AzureFireWallSubnet, an AzureBastionSubnet. And under each subnet we can then see the associated network interfaces and ultimately the public IP addresses associated with those interfaces and of course the virtual machines. So this is one of the things we can do with the Network Watcher tool, is learn a bit about our topology in the Azure environment. Over on the left, I can also click on Connection monitor.

[Video description begins] He clicks an option called "Connection monitor" in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

So I can click the Add button over on the right to add a connection monitor.

[Video description begins] A blade called "Add connection monitor" opens. [Video description ends]

I'm going to call this Monitor1.

[Video description begins] He enters Monitor1 in a text box called "Name". [Video description ends]

And I'm going to select a virtual machine here that would be a virtual machine that is the source I want to monitor from and then I want to select a destination virtual machine.

[Video description begins] He clicks a drop-down list box called "Virtual machine" and selects an option called "WinSrv2019-1". [Video description ends]

I can also specify a port number on which I want that connectivity to be checked.

[Video description begins] He clicks a drop-down list box called "Virtual machine" and selects an option called "WinSrv2019-2". [Video description ends]

So I'll put in Port 80 and I'll just click Add to add that connection monitor.

[Video description begins] He enters 80 in a text box called "Port". [Video description ends]

And we can now see the monitor has been added to the list and under the Status column it says it is currently running.

[Video description begins] He clicks a button called "Add" and the Add connection monitor blade closes. [Video description ends]

Now we can actually click on that connection monitor configuration and that'll open up another panel down below where we can scroll down and see some details over the last hour, six hour all the way up to the last 30 days. And down below according to the legend, we can see that we've got percentage of probes that have failed is 100. That's not good. Well, that could be due to a number of reasons. Perhaps the target virtual machine isn't reachable due to routing problems, but if they're in the same subnet, it's not a routing issue. Or it could be a network security group preventing connectivity to a port. Or perhaps Port 80 simply isn't in a listening state on that machine, there's no web server. So there are plenty of reasons that could happen, but we can identify that this is happening here using Network Watcher. We can also run a Packet capture as we can see over here on the left, we can view our Effective security rules, network security group security rule.

[Video description begins] He clicks an option called "Effective security rules" in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

So from here we can select the subscription, a resource group and ultimately a virtual machine.

[Video description begins] He clicks a drop-down list box called "Resource group" and selects an option called "Rg1". [Video description ends]

So when I do that I can see a network interface for that virtual machine and the association with the network security group here at the subnet level that says as opposed to linked directly to the network interface, and we can see any rules that might be applicable.

[Video description begins] He clicks a drop-down list box called "Virtual machine" and selects an option called "WinSrv2019-1". [Video description ends]

We can also click on Packet capture on the left and click the Add button to add a packet capturing session.

[Video description begins] He clicks an option called "Packet capture" in the navigation pane and the corresponding page opens in the content pane. [Video description ends]

Sometimes you'll create a packet capturing session because you want to be able to actually examine the detailed specific network traffic that is occurring on a network.

[Video description begins] A blade called "Add packet capture" opens. [Video description ends]

Now specifically what you're going to do is to choose the target virtual machine that you're interested in and you can select to store the resultant packet file name, the packet capture file name in a storage account. Or you can have it stored in a file within the virtual machine in question, the target virtual machine that we have to select above or you can have it stored in both places. The packet capture file will use a .cap format. So you can open it up with standard tools like Wireshark.

                    
Azure Subscription Overview
There is a relationship between Azure AD tenants and Azure subscriptions. 
Pictured in our diagram on the left, we see our Azure AD tenant. Azure AD or Azure Active Directory is a centralized directory service in the cloud. And it allows us to create user accounts for authentication, organize them into groups, assign permissions. We can register devices in Azure AD, so users can sign in on those devices with their Azure AD credentials. That's essentially what it is. It's an identity provider. And we can associate a subscription with our Azure AD tenant, listed here as Subscription 1.

A subscription is really a way that we get features that allow us, for example, to deploy resources in Azure. It's also used for billing purposes. But what you can do is you can add multiple subscriptions to your Azure AD tenant. However, the opposite is not true. You can't have a given subscription used by multiple AD tenants. So we see here that subscriptions are related to billing.

[Video description begins] Azure Subscription Limits. [Video description ends]

Now there are some limits to what you can do within an Azure subscription, such as how many resources can be deployed and so on. As an example, our first item here is the number of subscriptions per Azure AD tenant. This is one of those items where there is no limit. But there is a number of resource tags that can be specified to an Azure resource, and it maxes out at a value of 50. The maximum number of group owners maxes out at 100. The maximum number of storage accounts per region maxes out at 250. Now, this is only to list a tiny portion of some of these limits. There are many other ones that are published online, clearly, in the Microsoft Azure documentation.

[Video description begins] Azure Subscriptions. [Video description ends]

So we have the option with our subscription to also increase any of these limits should they be a little bit too constraining. You can do this once you sign into the Azure portal by creating a customer support request. Now limits for some things, such as the number of vCPUs, virtual CPUs available for a given virtual machine instance, those limits are quoted per Azure region. Now, you also have to bear in mind that if you're using an Azure free trial subscription, that you won't have the option of creating a customer support request, at least not in it succeeding in increasing any of those limits.

The other thing to think about is that when it comes Azure subscriptions, don't forget about how it is related to both the Azure AD tenant and also your Azure account in the first place. So you can have your Azure account in which you build your Azure AD tenants, and of course, you can have multiple subscriptions. Billing is done separately for each of your subscriptions. And if you do have a free try, you can actually convert it to a paid subscription.

[Video description begins] Azure Subscription Types. [Video description ends]

Now there are a number of different types of Azure subscriptions, such as pay-as-you-go, where all of your resource usage is tracked and you pay based on what you use. But then depending on the type of support you need, will determine if you select some of the other types of subscriptions, like Professional Direct support or Developer support. Developer support would allow you to get support but only during business hours, not 24/7. Then we also have Standard support. So, if you do need full support, 24/7, then you would look at choosing the appropriate type of Azure subscription, such as Professional Direct.


Azure Subscriptions and the Portal
You can view your Azure subscriptions in the Azure portal. 

[Video description begins] The Microsoft Azure portal is open. It is divided into two parts. The first part includes a search box and a navigator button and the second part is a content pane. [Video description ends]

You can view your Azure subscriptions in the Azure portal. One way to do this is by searching for subscriptions in the search bar at the top center which I will do.

[Video description begins] A blade called "Subscriptions" opens. It includes a button labeled "Add" and a table with several columns and one row. The column headers include "Subscription name", "Subscription ID", and "Current cost". Under the blade name, there is text: Quick24x7. [Video description ends]

Now bear in mind that when you search up subscriptions you will see any subscriptions associated with your current Azure AD tenant, which is shown here as Quick24x7. So I can see I have a Pay-As-You-Go active subscription. I can even see the Current cost.

[Video description begins] He points to the following row entry, which includes: Subscription name: Pay-As-You-Go and Current cost: CA$1.48. [Video description ends]

Now in the upper right, if I click on my sign in account information area and click Switch directory and, if I choose some other Azure AD tenant, let's say EarthFarm in this example.

[Video description begins] A blade called "Directory + subscription" opens. It includes a section called 'Switch directory" under which there is a list of all the directories. He selects the following directory: EarthFarm. [Video description ends]

Then when I go to take a look at subscriptions, I can expect to see something different potentially.

[Video description begins] The Microsoft Azure portal gets refreshed. In a section called "Azure services" he selects the "Subscriptions" option. The "Subscriptions" blade opens. There are no row entries in the table. [Video description ends]

So because I've visited subscriptions recently, I can just click it from Azure services, of course, I could once again search for it in the top center. Either way, I want to look at the subscriptions for this different Azure AD tenant. Notice it says, "You don't have any subscriptions". So at this point, we have the option of clicking Add where we'll be presented with a list of subscription options.

[Video description begins] He clicks the "Add" button. The login page opens in a new tab. [Video description ends]

So at this point, I'm just going to authenticate so I can get to that screen. So now I get the option to SELECT AN OFFER.

[Video description begins] A page called "Add subscription" opens. It includes a list of offers. [Video description ends]

If I want to add a Pay-As-You-Go subscription or Pay-As-You-Go Dev/Test, Developer support, Professional Direct support, and Standard support where I can see some of the details about these. So we have some options here. And, if I were to choose one of these, it would then continue on to the point where I have to make sure I add a payment method, and so on. But I'm going to close out of that. And I'm going to switch back to my first initial directory that in this case would be the Quick24x7 Azure AD tenant where I know, I have an active subscription.

[Video description begins] He clicks the account details section and then clicks the "Switch directory" option. The "Directory + subscription" blade opens. He selects the following directory: Quick24x7. The Microsoft Azure portal gets refreshed. [Video description ends]

And once again, I'm going to go look in the subscriptions associated with that Azure AD tenant. Now I'm going to click directly on that existing subscription.

[Video description begins] He selects the "Subscriptions" option. The "Subscriptions" blade opens. There is one row entry in the table. [Video description ends]

Now I'm going to click directly on that existing subscription. 

[Video description begins] He clicks the row entry, which includes: Subscription name: Pay-As-You-Go and Current cost: CA$1.48. A blade called "Pay-As-You-Go" opens. It is divided into two parts: navigation pane and content pane. In the navigation pane, an option labeled "Overview" is selected and its corresponding page is open in the content pane. [Video description ends]

Because when you do that, it opens up a plethora of options in the navigation bar on the left. For example, we can go to Cost analysis to analyze costs, to see exactly for example, where the lion's share of our charges are coming from.

[Video description begins] He selects an option called "Cost analysis" in the navigation pane and its corresponding page opens in the content pane. [Video description ends]

We could click on Budgets, so we can configure alert notifications when our costs reach a certain point.

[Video description begins] He selects an option called "Budgets" in the navigation pane and its corresponding page opens in the content pane. [Video description ends]

We can even go through and see our Invoices over on the left under the Billing section. But at the same time, we also have some other things that we can do, when I go back to the Overview part of this.

[Video description begins] He selects the "Overview" option in the navigation pane and its corresponding page opens in the content pane. It includes the following buttons: Manage, Cancel subscription, Rename, and Change directory. [Video description ends]

We have some buttons across the top. I can cancel the subscription. I can Rename it, so, if I want to rename it from Pay-As-You-Go to something different, I can do that. I can Change directory. That means I can associate this subscription with a different Azure AD tenant. So I've got a number of options. So, I can even click on Manage to open up a new browser window where I can further manage my Azure subscription. So we have a summary for our Pay-As-You-Go subscription, where we're looking currently at the OVERVIEW.

[Video description begins] The following page opens in a new tab: Summary for Pay-As-You-Go. It includes the following tabs: OVERVIEW and BILLING HISTORY. The OVERVIEW tab is selected. [Video description ends]

And we can see a lot of options available on the right to Manage payment methods or to Download usage details for the subscription or to change the subscription address information. Or I want to switch to a different type of subscription offer. Again, I have some other options here such as canceling the subscription and so on.


Azure Subscriptions and the CLI
You can use the Azure CLI to learn about Azure subscriptions and also to determine which subscription is active. To get started here in the Azure portal, I'm going to launch the Cloud Shell.

[Video description begins] The Microsoft Azure portal is open. [Video description ends]

Now in the Cloud Shell, I'm going to start by running az account list.

[Video description begins] He clicks a button labeled "Cloud Shell" in the first part of the screen. A PowerShell window opens. The following prompt is displayed: PS /home/danlachance72>. [Video description ends]

And when I press Enter, it'll return some details.

[Video description begins] He executes the following command: az account list. The output displays details of the azure account. The details include cloud name, id, and tenant id. The prompt does not change. [Video description ends]

So we can see the name of the cloud, AzureCloud, as opposed to Azure Cloud for Government or anything like that. And we can also see the id. Now, it doesn't say subscription ID, but this is the id of our current Azure subscription. We can also see our Azure AD tenant ID. Let's examine the subscription ID for a second by jumping into the portal to take a look at that. So, notice here it starts with 048b and ends with 2109. So let's just minimize the shell here. Let's go in to Subscriptions, let's see what we've got attached to our current AZ tenant.

[Video description begins] In the Microsoft Azure portal, the "Subscriptions" blade opens. The table has one row entry. He points to the following row entry, which includes: Subscription name: Pay-As-You-Go and Current cost: CA$1.48. [Video description ends]

Now it should be a Pay-As-You-Go subscription. And notice the Subscription ID indeed starts with 048b and ends with 2109. So we can learn a bit of that information from the az account list command in the CLI.

[Video description begins] He points to the entry under the "Subscription ID" column header. He switches back to the PowerShell window. [Video description ends]

Let's clear the screen. Let's also run az account set --subscription. And here, I'm going to put in the name of it which is Pay-As-You-Go, each word separated by a dash. Now in my case, it doesn't really matter that I do that.

[Video description begins] He executes the following command: cls. No output returns and the prompt does not change. He executes the following command: az account set --subscription "Pay-As-You-Go". No output returns and the prompt does not change. [Video description ends]

Because if we go back and take a look, we've only got a single subscription here associated with our Azure AD tenant. Which is shown here by name in the form of Quick24x7.

[Video description begins] He switches back to the Microsoft Azure portal. He points to the following row entry, which includes: Subscription name: Pay-As-You-Go. He switches back to the PowerShell window. [Video description ends]

But when you have multiple subscriptions, this can be an important command. Essentially you're setting the context to that subscription. And so following commands after you do that will run in the context of that set or selected subscription. The other thing to bear in mind is that you can also, instead of setting the subscription when you have multiple subscriptions, you can also do it per command. What I mean by that as an example, is let's say we were going to use az vm create to create new VM. And normally you would specify things like --resource-group and then Rg1, let's say.

And then maybe the name, let's call it Linux1, and then maybe the --image would be based on something Ubuntu. But the key here is that we can also use the --subscription command line parameter. And so, for this individual single command, you can say, well, I want this tied to the Pay-As-You-Go, just type that in, subscription. So you can do that if you know you have to work with a number of resources and different subscriptions. You might choose to just do it at the command-line instead of keeping on setting it as up above. It really depends on what you want to do and how many commands you have to issue. But either way, it's important to have this knowledge if you're going to be working with Azure subscriptions through the CLI.


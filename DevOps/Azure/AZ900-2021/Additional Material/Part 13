                    AZ900 Microsoft Azure Cloud Fundamentals 2021
                    Additional Material Course Notes Part 13


App Service Deployment Slots
  - We are going to use the Azure Portal to create a deployment slot. You can create deployment slots for testing purposes
    - So that you can keep a production version of your web app available while having a different URL
    - So different DNS name, for your deployment slot as you do testing.
  - Then you can swap out deployment slots. So once your testing is successful, you can make that the production version of the web app
    - In the portal we are going to click on an existing web app, open up its navigation bar, and scroll down and choose Deployment slots
    - We'll see that there is a default deployment slot for every web app and it's called PRODUCTION, we can see it's currently Running
    - What we are going to do then, is we're going to click Add slot up at the top
    - We are going to call this one Testing. And I'm going to choose to Clone settings from the original app that we're in in the first place.
  - When you clone settings, you're cloning things like connection strings, HTTP version settings, and so on
    - We are going to choose to Clone settings from our source web application, after a moment, it says it successfully created the slots
  - We are going to go ahead and click Close, and sure enough we can see the slot is listed here as Running and it shows up as a link
    - That's because we are currently in the PRODUCTION slot.
    - If we click that link to open up our Testing slot, and in it, it looks and feels just like the whole web application.
    - Notice at the top, we're in our Testing version of the app, a different deployment slot.
  - When we go down to the Deployment slots from within it, notice that neither shows as a link 
    - Because we're actually looking at it from the perspective of the deployment slot.
    - We are going to click the X to close out of here.
    - We want to make sure we're back on the original app.
  - When we say original app, we mean the real App Service, see by looking at the name that we are in the real App Service
    - Notice the URL happens to be a custom DNS domain name with an SSL binding.
  - Notice that if we go back into the Deployment slots, let's do this once again
    - We are going to click on the link for the deployment slot
    - Look at its URL in the Overview blade so always keep your eye on the naming up here at the top.
    - Notice that what we're looking at here is we have a different name for the deployment slot
    - It doesn't use our custom DNS name at all.
  - You get a different DNS name then for that purpose, if you start making configuration changes
    - You would do it, for example, in your testing deployment slot., so go down to Configuration.
    - Go down and make a change to a connection string used for a database or something like that
    - Down below, there are no connection strings. Let's say, we want to add one, and we are doing this in the deployment slot.
  - We are going to call this BackendDB, and maybe the value is just going to be testdbstring, it's going to be for MySQL
    - We also can turn on this Deployment slot setting. When we do that, it means that this setting is only for the deployment slot
    - We don't want to do that, it's part of our testing, we are going to click OK, and Save that change
    - We'll click Continue, the reason we didn't want that to be a sticky setting for the deployment slot only is because based on our testing
    - If it works out well, then we might want to make sure that that setting is propagated to our production slot
    - Close out of this one, when we say this one, we're referring to our deployment slot for testing
    - Go back to our primary one which means we're in our primary web application
  - What we want to do, actually, we can do it either here in the Deployment slots view, we can Swap, or we can do it from the Overview page
    - It doesn't make a difference. You could have a swap option there.
    - Swapping means you want to take another Deployment slot and make it production, for example, so click the Swap button
    - What we want to do is we want the source to be testing, and we want to swap it with the target of production.
    - Down below, it picks up the change, the source change, the source, of course, is our deployment testing slot
    - We are going to swap this out, so click Swap, essentially, after you've tested your testing deployment slot and the web app store works correctly
    - By swapping it to production, it results in no downtime
  - This is as opposed to as in the old days in the 90s and early 2000s, when you might visit a site and see a site under construction webpage
    - There's no longer a need for that when using Deployment slots, we can see it successfully completed the swap
    - We are going to close out here, we're still looking at our main application as in not looking at it from the perspective of within a deployment slot
    - If we were to scroll down, let's say, and just go down to Settings and Configuration, we want to take a look at the connection string
  - When we scroll over to the right, and then of course scroll down, let's see what's going on
    - Notice that our connection string has been brought over from our testing deployment slot.
    - That's just an example of a setting, as opposed to actually change the content in the site, that comes across when you perform the swap


App Service Scaling
  - When you deploy an application in the Azure Cloud, sometimes you won't know how much underlying horsepower you're going to need
    - Or how many virtual machines you'll need to support the workload
  - We're talking here both about vertical scaling with horsepower, and horizontal scaling with the number of nodes supporting an application
    - Luckily, we can change that after the fact
    - Remember that when you deploy a web app in Azure, it needs to be associated with an App Service plan
    - The App Service plan is actually where you configure the scaling
  - Take a look at this first from the perspective of an application, a web application service
    - When we click on the web app to open it up, scroll down in the options, we'll see that we have Scale up and Scale out
    - It says, App Service plan, here in parentheses. So, what I could also do is look at this from the perspective of the App Service plan
    - Open up an existing App Service plan here called APPSP1
    - We'll see the exact same thing here, under Settings, we'll see Scale up and Scale out.
  - The scaling up or down means you're either increasing or decreasing respectively the horsepower
    - Like number of CPU compute units, or ACUs, Azure Compute Units, as they're called for web apps
    - Scaling out would be for horizontal scaling, adding or removing virtual machine nodes.
  - Start here with scaling up, currently we can see our current pricing tier, 210 total ACU, 3.5 gig of RAM
  - Let's say that we've determined that for the web apps associated with this App Service plan
    - Remember that when you go to Apps, you will see one or more apps associated with this service plan
    - We also see we have a deployment slot here too.
  - They are all consuming the resources that you would see here under Scale up
    - They are all together consuming the ACUs, the Azure Compute Units, and the 3.5 gig of RAM.
    - You might find over time that it's just not enough, and if that's the case, you can Scale up.
    - Let's say we're going to switch it over to 420 total ACU 7 gigs of RAM for example
    - Then we just simply select that and choose Apply.
  - As you might guess, you're going to pay more for this
    - Only do this, if you need it or if you're just experimenting with these web applications in Azure, make sure you delete them when you're finished
    - Of course, not if you're using them for business purposes
    - But because if you don't remove them, and they're left running constantly, you are paying for that, even though you might not be using it
    - Be very careful with that, at this point, if we're looking at our notification bar, it currently updated our service plan.
  - We are now using the P2V2 pricing tier for production, we also have scaling out options
    - Currently, we can manually scale, pretty now we've got an instance count of 1
    - We could manually drag the slider over to determine how many underlying instances are available for our applications
    - This is the number of instances of course that are available for the apps associated with this App Service plan, we looked at that under the Apps blade.
  - We could also choose auto scaling instead of just manually setting a fixed number of virtual machine workers.
    - We can go down here and we could specify a metric.
    - We might say that after a metric has been violated or exceeded, we'll say, let's Add a rule here for that.
    - Then we can add or remove virtual machine nodes.
  - We could specify after the CPU percentage gets to a specific value, CPU percentage, then we could specify that we want to start adding items.
    - When it's greater than 70%, duration of 10 minutes, then we can tell it we want it increased by a single instance.
    - So we do have the option to enable horizontal scaling as well.
    - I'm just going to Discard those settings.
  - Currently, all we've really done here is juiced up the underlying Azure Compute Units or ACUs
    - And the amount of RAM available to the apps associated with this App Service plan.


                    AZ900 Microsoft Azure Cloud Fundamentals 2021
                    Additional Material Course Notes Part 37


Resource Group Deployments
  - You can view past resource deployments into an Azure resource group by opening up its properties in the portal
    - To start with, let's go to the Resource groups view where we're going to see the resource groups within this subscription.
So for example, Rg1, resource group 1. If I click to open that resource group in the Overview blade, I'll see any resources currently deployed in that resource group.
Now here it says there are No resources to display. However, if I click on the Deployments item in the navigation bar, I can see that there have been deployments to this resource group in the past. So either those resources were deleted, or they were moved to another resource group.
So let's close this resource group for a moment and let's go into our second resource group here called Rg3.
So again in the Overview part of that, we do see there is an active object here within this resource group. It's a storage account.
And in the same way, if we go to the Deployments part, we'll see see that there are no deployments listed to this.
Well, how can that be when we can see there's a storage account currently assigned to Rg3? That would be because it must have been moved from another one. So let's go back into our initial resource group, Rg1, let's go the Deployments section.
  - Here we can see that there was a template deployment for one or more resources
    - We don't quite know yet, into this resource group on a specific date and time.
    - If we click on the link for that template, we can actually Download the details related to that template, it's a zip file.
  - We are just going to choose Open to open it up directly, and it going to open up the deployment.json file
    - This gives you the details about what in that template was deployed to the resource group.
  - Unless we scroll down through here, it looks like it was a storage account, that looks like the only thing that was deployed here
    - We can learn that quite easily by viewing that information.
    - What's equally interesting about that, if we go back here to the Deployments, is if we select an existing deployment.
    - We're here have a deployment of the storage account into this resource group. We have a Redeploy button up at the top.
  - It means what it says, based on the selection, you can deploy that item again
    - You would only do that if it doesn't already exist
    - For example, we are going to click Redeploy, this is what you would normally see if you were deploying from a template.
  - We can select a Resource group where we want to deploy this item
    - For example, Rg3 or we can create a new resource group, whatever the case might be
    - Interestingly, even though it was originally deployed into Rg1, this storage account was moved to another resource group
    - So it doesn't actually exist here anymore, we are going to deploy it back into Rg1
    - What we doing is creating a new storage account from that original deployment
    - We would do that if we want to use a lot of the settings from it as opposed to deploying a brand new storage account from scratch.
  - It's the only reason you would do this, assuming we are okay with all of these settings as per my original deployment
    - Then down at the bottom, we could choose that we agree to the terms and conditions stated above
    - The only thing we'll have to account for though is the name of the storage account
    - If that storage account is still being used somewhere, then the name isn't unique
    - We'll just add a 2, let's say to the end of it, to make sure that the Storage Account Name is unique and choose Purchase.
  - Let's see if it validated, excellent, the deployment is currently in progress
    - What we're doing is redeploying a storage account into this resource group based on a past deployment
    - Of course, the original storage account is no longer here. It's in Rg3
    - After a moment, if we go look at my notification bell icon in the upper right, it looks like the resource deployment succeeded
    - Go back and look at the deployments here for our resource group.
  - Let's take a look at the Overview here where we can see active current items here
    - We can see that there is now a storage account that was deployed into Rg1 and we redeployed it from a past deployment.


Resource Group Cost Analysis
  - In Azure, you can view and track your costs based at the subscription level.
    - For example, here in the portal if I go to my Subscriptions, and if I click on an active subscription, when I open it up, I'll have the option of clicking Cost analysis over on the left.
  - Then we'll see all the costs associated with this subscription. Of course, I can change the time period or time frame for which that is representative of, but we have the option of doing that. But what we're talking about here is doing a cost analysis at the resource group level. Now think about how you might use a resource group in Azure, you might use it for a project, so you might have a project called Project X. So you'd create a resource group with that same name and deploy project resources into it. That way you have a single unit of management in the resource group and also for tracking costs. Let's take a look at that.
So I'm going to go into my Resource groups view here in Azure, and I'm going to open up an existing resource group I've got named Rg1, so I'll click on it.
And what I want to do is scroll down in the navigation bar and click on Cost analysis to open that blade.
So what's going to happen is we're going to see a cost breakdown for resources deployed only into this resource group. And we can see it's coming up with the numbers listed here. So we have our standard charts where we can scroll down below and see it broken down by service. So it looks like we've got SQL databases eating up the lion share of the cost in this particular case for this time frame, the location here, Canada East. So we have all the normal stuff that we would normally see we can even filter. I could add a filter here for anything that I'm interested in such as a specific service type or Service name in this case. So I could open up the list and choose that I'm only interested in sql database.
And I could filter based only on sql database. So then the cost analysis will update to show me only that. And as usual, we also have the option of exporting. So for example, I could choose to Export.
Let's see a PNG graphic file. Let's go ahead and do that. And I'll click Download charts. And once that's done, I'll just click Open down at the bottom of the screen. And we can see here it's opened it up in Paint on my machine, but we essentially have the same type of information that we can see visually directly in the Azure portal. Let's go back and export that as, let's say a, document in the format of Excel. So I'm going to choose Excel and choose Download data. And then I'll just go ahead and click on Open. So when you open it in Excel, you're going to have two sheets. You could have a worksheet, which is the summary that you're looking at here and also the actual data itself.
  - Not only can we work with our cost analysis at this level at the resource group level
    - But we can also go into Cost alerts over on the left and Add an alert and notification 
    - When the costs for resources deployed into this resource group get to a certain level.
    - We could add a filter but we will just going to leave it on Rg1, don't change the scope and call this Rg1Budgets1.
  - The idea here is that we want to be alerted when costs exceed a certain value
    - We can specify the period, we are going to leave it on Billing month but we could specify quarter here, and so on
    - We are going to set the amount here to 50, as we scroll down
    - We can see here that the max over the past five months has been about $25 specifically in Canadian dollars.
  - It depends on your subscription and how it's configured for the currency, that's been specified
    - Now that we've done that, we are going to go ahead and click on Next> and scroll back up to the top.
  - Basically, we are going to say when we get to 75% of our budgeted amount
    - We want to use an existing Action group if we have any, in order to send a notification
    - If we don't have any existing action groups that are available in the list, then we can click the Manage action group link.
  - Down below, we can also specify an alert recipient email address, such as for a group, which we've specified here, then just click Create.
    - We didn't create an Action Group, we could have, if we wanted as an alternative alert notification method like SMS text or something like that
    - At this point, we now have a budget created, if we go into the Budgets.
    - Portion here, we can see our budget is listed here for the resource group
    - The key is that we can work with cost analysis at the resource group level.


Resource Group Budgets
  - In Azure, you create budgets so that you can be notified when a certain percentage of a given value has been reached
    - For example, if you set a budget for $500 per month, you might want to be notified when you get to 80% of that $500.
  - We can go in and take a look to make sure that issues such as leaving virtual machines or databases running by mistake hasn't occurred
    - That's why you have an increase in cost, we can do this at the subscription level.
  - If we were to go into an Azure subscription, we can click on the subscription to open it up, and can click Budgets and manage the budgets from there.
  - But what we're talking about in this particular case is doing same type of thing but at the resource group level.
  - It only applies to charges for resources deployed to a specific resource group
    - In our Resource groups view, we are going to click on a resource group we have called Rg1.
  - In the Overview blade over on the right, we can see any resources currently deployed there
    - In this case, it's only a single storage account
    - However, as we scroll down in the navigation bar for the resource group, we can see Cost analysis, Cost alerts, and Budgets
    - Well, Cost alerts allows me to add an alert which ends up creating a budget
    - We are just going to go here to the Budgets view, we don't have any budgets currently.
  - We are going to go ahead and click the Add button to add a new budget. Now remember again, the budget is really about sending a numeric threshold value for costs.
And then setting up some kind of an alert notification mechanism. So Rg1 is the current scope. I'm not going to change that. I could click Add filter, if I want to filter within the resource group by something else.
So maybe for example, by ServiceName. Maybe, I'm only interested in looking at sql database costs within Rg1 and sending alerts for that, so I could do that. However, I'm going to remove that filter by clicking the little x.
And down below, I'm going to call this Rg1Budget1All, indicating it's for all costs, not by particular service or anything like that.
I'm going to leave it on billing month, but you can change the period to be something different, like monthly, maybe you only want to track this and be notified from a quarterly perspective or annual. But I want it done every Billing month.
I can see the start and ending date for that. I'll leave those set as they are, so two years into the future, pretty much. I'm going to set my BUDGET AMOUNT to 500, so $500 and that will be in the currency specified with my subscription, in my case, Canadian dollars.
  - We can see our past five month maximum costs, which can help us sometimes gauge what we should be putting in for my budget amount
    - However, we are going to leave mine at $500 we could go down to the bottom but are going to click Next>.
  - We'll scroll back up here because we can specify the percentage of that budget amount, then we want to trigger an alert
    - Let's say it's 80% of that $500, which works out as we can see here to be $400.
  - We could select an existing Action group, if we have one, we don't, we could create one by going to Manage action group
    - Action groups let you define targets that should receive things like notifications
    - Whether it's through email, or SMS text messages, or push notifications and so on
    - However, we already have the option built-in here when we are creating a budget to send an alert message to a group
    - We are going to specify a group here for my organization
    - They were the ones that will receive a notification when we get to 80% of our budget on a monthly billing basis.
  - Having done that, we are going to go ahead and click on Create
    - It's going to validate my selections, after which it will create the budget.
    - After a moment, we get a notification in the upper right that the Budget was created
    - Here, in the Rg1, navigation panel under the Budgets blade, we can see our budget now exists.
  - At any point in time, we can click on the Name of the budget and open it up 
    - And either edit it to change any of the items within it, such as the Amount, or we can delete the budget.


Azure ARM Template Editor
  - Azure Resource Manager templates, otherwise called ARM, for Azure Resource Manager, allow you to define your resources as code
    - It's often referred to as Infrastructure as Code.
  - You could use a template or a blueprint to specify that you want to create a storage account, a virtual machine,
    - A web application, a public IP address, all of these things together
    - It allows for the automation for the deployment and management of resources
    - In the portal, we can create a template deployment by choosing Create a resource
    - We could type in template, and are going to select Template deployment.
    -A template is technically just a text file that uses json syntax.
    - From this screen, we can select from Common templates that are available here in Azure.
  - To create a Linux virtual machine, Windows virtual machine, a web app, a SQL database. You could also, down below, select a GitHub quickstart template from the list. So whether you want to start working with things like Azure container services or kubernetes, which is kind of an orchestration platform for containerized applications. Or we might go down and choose things like an Azure DNS zone that we want to create. It could be any type of resource, a backup vault to be created, content delivery networks, on and on and on. Or you could Build your own template in the editor. When I do that, it takes me into an editor environment where we have the base skeletal format for the JSON.
Now we can also specify Variables. If you want to allow for template reusability, you shouldn't be hard coding values, things like storage account names or virtual machine names. Instead, those should be variables, and you can specify those parameters to pass in values to those variables. Now, at this point, we could load an existing file. When I choose Load file, it allows me to search for file on-premises, on my local computer that I'm doing this from, that is a template that I want to bring in here. Or I could choose Quickstart template, for example.
I'm going to go through and select just a very simple template. How about we search for storage, and we'll take a look here for storage account. Now, what I want to do is basically create a very basic storage account using a template, so that we can at least see the code here. So I'll choose storage-account-create, from the template list, OK.
And what it's done is populated all of the json syntax here in my ARM template for the creation of a storage account.
Now notice there are some variables here. A variable is being defined here for the storageAccountName. And, If I click Variables over here on the left and expand it by clicking little triangle, I can see storageAccountName.
Of course, when I click it, it takes me to that line. So I can use this template editor to tweak what I've just essentially imported from a Quickstart template. I can make changes, if I know what I'm doing. And once I'm happy with this, I can actually save it. So if I click Save, at this point it's saved my changes here in the GUI. And what I can then do is actually run a deployment from that template.
So, for example, I want to deploy a storage account into Rg1, that's a Resource group.
And based on the template definition will determine what you need to specify. If pretty much everything is hardwired and there are no variables, then you might not have much to specify at all. But here we can specify the Storage Account Type. And the Location will be determined by looking at the Resource group up above, and calling upon its .location property.
So that's going to be taken care of. Notice what's missing is the name. What will the name of the storage account be? Well, in the template the storage account name is going to be determined by concatenating some text items together. Let's just go back here for a moment in our web browser, and let's step through what we just did to create that template. We created a Template deployment, we chose Create, we wanted to use the template editor here in the GUI, and we clicked on Quickstart template. And essentially what we searched for here was storage. We want to create a storage account using the template. So, storage-account-create, we did OK. Now if we take a look here at the code within the template, when it comes to dealing with the storage account name, it's concatenating the word store, so that's going to be the prefix. Then it's going to generate a unique string from the resource group ID. And so, that is how the name will be derived.
Okay, let's get back to where we were. Let's Save that. Let's deploy this into Rg1. And let's go ahead and agree with it and click Purchase.
  - After a moment, our template deployment has succeeded for a storage account
    - We can go to the resource group, that's one way to navigate here
    - In the Overview blade, we'll see any items deployed in this location
    - We might have to click Refresh, a time or two until we see new items
    - Here's our new storage account, it's got store as part of the prefix of the name followed by what looks like some kind of a unique string
      - The same thing would appear, of course, if we were to go to the Storage accounts view
      - Creating a storage account is the same, regardless of how you actually do it, the end result is the same
      - Our storage account is now showing up as having been created from a template that we pulled up in the template editor.


Azure AD Overview
Azure Active Directory is otherwise called Azure AD or sometimes AAD, but it all means the same thing. It means that we have an Active Directory instance in the Azure Cloud. It's managed. We don't have to set up a server and install the domain, controller, components, and so on. So what this means is that we have a centralized identity provider in the cloud. It can contain users, groups, application registrations, and security principles. Security principles are often used to make sure that software components have specific permissions to needed cloud resources. You can also link Azure Active Directory to your on-premises Active Directory if you wish. There are many configurations such that users authenticate to cloud apps using their familiar on-prem apps, and password changes are synchronized between both locations.
You can manage Azure Active Directory and everything within it using the GUI. So using the portal, you can also use command-line management tools, like PowerShell cmdlets, and the Azure CLI. Identity in Access Management or IAM, is all about authentication in authorization. So authentication is the proving of identity. Single factor authentication, for users for instance, would include items in the same category, such as something you know as a username and password would be. So it's single factor. But multi-factor meshes categories. So username and password fall under the something you know category, but the possession of a smartcard falls under the something you have category. Hence, we would have Multifactor Authentication or MFA in that instance.
The authorization is controlled access to resources that occurs after successful authentication, such as having the appropriate permissions to a SharePoint site, or perhaps the ability to deploy specific virtual machines only within a specific geographical region. So it's permissions or policies that get assigned to groups. So with Identity and Access Management or IAM, we are talking about controlling the authentication and then the authorization related to users and groups and even devices, such as Windows 10 computers joined to Azure AD, or Android smartphones registered with Azure AD for centralized control. And we know that IAM also deals with software permissions, specifically in the form of security principles.
So Azure AD then is a centralized repository of credentials, you could say, among other things. There are other security things that we have to consider, like RBAC roles. RBAC stands for Role Based Access Control. A role is a collection of related permissions, such as the ability to manage Azure virtual machines. And we could assign that role to certain users, or groups, that would apply to either the entire subscription in Azure, or a resource group, or just a single virtual machine for that matter. Conditional access is an important option. You can build policies that basically check conditions that must be met before allowing access to something.
So an example is that, if we have a sales associate that needs access to some kind of a Sales Cloud based application, then they can only do that, they can only access it if they sign in using Multifactor Authentication. Then we've got access reviews. This is something that you can schedule or run whenever you wish to take a look at things like group memberships in Azure AD, or permissions granted to enterprise applications registered in Azure AD. Because sometimes these permissions are granted and left, even though they may no longer be required, and that presents a security risk. So access reviews are good from a security perspective.
Then there's Privileged Identity Management, otherwise called PIM, P-I-M. The purpose of PIM is really to only provide administrative access to administrators when they need it. So you could think of this as, just-in-time or J-I-T, JIT administrative access. And of course, we can enable Multifactor Authentication or MFA to enhance user sign in security. So for instance, instead of Azure AD users only being required to enter a username and password, in addition to that, they might have to enter a six-digit PIN that gets texted to their smartphone.


Azure AD and the Portal
To properly manage Microsoft Azure, it's important to have a clear understanding of the association of an Azure AD tenant and a subscription. Now, an Azure AD tenant is essentially an instance of Azure Active Directory in the cloud, where you have users and groups, and devices and so on.
And you can associate a subscription with a tenant, for example, here in the portal in the upper right along with my sign in information, I can see the name of the Azure AD tenant I'm currently switched to it's called QUICK24X7.
And so here, I can click Subscriptions on my screen, I can also search for subscriptions if it wasn't there, to view any subscriptions associated with this Azure AD tenant. And I see I've got one it's a Pay-As-You-Go subscription. So I'm just going to click Home here in the upper left.
So if I were to view for example, All resources, it takes me to the All resources view but I have not yet created anything so I don't really see anything, but at least it did take me to the view. Now let me switch over to a different Azure AD tenant.
So I'm going to click in the upper right and choose Switch directory, and maybe I'll choose the one by the name of EarthFarm.
So this is a separate Azure AD tenant or separate instance of Azure AD Directory Services.
Now when I take a look here, I have a different looking screen. And if I were to try, for example, to look about why don't we start by trying to see which subscriptions are associated with this tenant. So when I go to Subscriptions for EarthFarm, there are none although I do have the ability to add one, let me just go back Home.
If I were to try to go to the All resources view, well, it just won't let me do it. Because you need to at least have a subscription associated with the Azure AD tenant to be able to do anything.
So let's switch back to our active tenant, but when I say that what I really mean is the one that has an associated subscription, that was Quick24x7. 
Now when I look at Quick24x7, we can go to Azure Active Directory from the main screen, we could also search for it and choose it from the resultant list.
I could click on my left-hand navigation bar to open it up, and scroll down and choose Azure Active Directory, it doesn't matter. But at this point I can start actually doing something meaningful with Azure AD.
For example, I could go to the Users view, I can see any existing users, or begin creating users, or inviting users, or bulk creating them from a CSV file.
I'll just click back on Quick24x7 in the breadcrumb trail in the upper left, I can also view Groups and also Devices.
So Azure AD then is a centralized cloud-based identity provider that can have one or more Azure subscriptions associated with it.


Azure AD and the CLI
While you can use the Azure portal to manage and navigate through your Azure AD tenant, you can also do that using the Azure CLI.
In this case in the portal, I'm going to click the Cloud Shell icon at the top where I'm going to run CLI commands.
The first thing I'm going to do is run az account list and I'll press Enter.
So the first thing I see is the homeTenantId, so it starts here with 96421. Now as a matter of fact, if I just minimize that, we can see that 96421 is actually the tenant ID for my Azure AD tenant which is named, Quick24x7.
So we can see that information. As we go further down, we can also see the name of the subscription associated with that Azure AD tenant, because there can be one or more subscriptions.
So I'm going to go ahead and minimize Cloud Shell for a second. And I'm going to search up subscriptions in the bar at the top center here. And when I do that, I'll be able to see which Subscriptions are associated with the Quick24x7 tenant. There's one, it's called Pay-As-You-Go.
We can see the Subscription ID for that is 048b82 and so on. Well, let's go back and take a look here.
We can also see Pay-As-You-Go is shown here. The state of our subscription is that it's Enabled, okay. So this looks good. We're getting a bit of information simply from the az account list about our Azure AD tenant. I'm going to go ahead and just clear the screen with cls. Let's take a look at a few other things that we could do.
For example, I'm going to run az space ad space -h for help. What can I do in Azure Active Directory here from the CLI?
So we can manage applications that are registered, groups. We can get information about the signed-in-user. We can manage service principals which is often used when you have software components that need authorization to resources in Azure, like storage accounts for instance. And we can manage of course Azure AD users. So if I were to run az ad user -h, tells me the next level commands about users I can work with.
So create, delete, get-member-groups, list, show, update, and so on. So there's a lot we can learn from within the help system. So for example, if I were to run az ad signed-inuser -h, just talks a little bit about what that would do.
Well, looks like I have the wrong name here, so signed-in-user. So make sure you have the command syntax spelled out correctly, that's a little bit better.
So show graph information about the current signed-in user in the CLI, okay, so we can either run list-owned-objects after that or show. Let's just do show. So I'm going to use the up arrow key and our full command that is going to be az ad signed-in-user show. Just to get some information about who we're currently signed in as here in the CLI.
So as we scroll up, it's a lot of details because it's showing me the properties of my user account. So things like the companyName, the country, department, employeeId, displayName, givenName, all of those types of things. And as we go further and further down, we can also see all the details all the way down. So it's just showing me details about the user that I'm currently signed in as here in the CLI. Now of course, we can do other things here, navigating through our Azure AD tenant for example, az ad group list. So this will show me all my groups, but the problem if you consider it a problem is that it's telling me too much. It's giving me all of the detail. I'm really only interested in the displayName property.
So what can we do about that? We can do a few things. One thing I could do is run az ad group list again and pipe that to grep. That's the grep line filtering tool built into Linux. And I can tell it what I want to see, and it's case sensitive by default. So I want to see the displayName, name with capital N, I can ask for that and that seems to work. Those are the names of my Azure AD groups.
I can also alternatively use the --query parameter built in to the Azure CLI. So for example, I could do az ad group list, and instead of grep and grep is fine. But instead of that I could use --query and I can tell it I want to see the displayName. 
Now the problem is that it won't work by default because what we have is a collection of items. We have an array of items and those items are the multiple groups. So we have to tell it here in our syntax after query, open and close square bracket. In other words, array element dot and for each item I want to see the displayName property. And when I do that, I get what I expect, the names of the groups.
And it's a little bit cleaner, if you take a look at than what do you get when you use a grep line filtering. Because grep displays everything on the line, so displayName colon all that stuff. All we're seeing here are the actual value. So depending on what your need is, it might be easier to parse this text down below that results from using --query than it would from trying to parse the text that results up above here by piping to grep.


Azure AD and PowerShell
Not only can we use the Azure portal to manage our Azure AD tenant, as well as the Azure CLI, we can also use PowerShell cmdlets.
Whether you're running PowerShell on-premises with the Azure module, or whether you're doing it here in the portal through Cloud Shell, which is what I'm going to do. So I'm going to point to Cloud Shell here, which allows me to run PowerShell cmdlets and Azure CLI commands.
So I'm using PowerShell here. And to get started here, let's just navigate a little bit around Azure AD. Let's figure out what we can type in, begin with. So get-command, and let's say I want to retrieve information about Azure AD. So I know that the verb part of that cmdlet, the prefix, is going to be get. Don't know what would be after that so how about a wildcard symbol, an asterisk. And probably azad and then something else.
Looks pretty good. Here I can use Get-AzADGroup to get groups from my directory, or group members. I can get users, I can get applications that might have been registered in Azure AD. So this isn't bad, we're learning a bit. So I'm going to clear the screen, I'm going to run get-azadgroup.
Let's see what groups we have.
Okay, looks like it's showing us the groups with the default selection of properties. However, if we really wanted to, we could also run get-azadgroup. I know there's more about groups than just those list of properties. So what I could do is, tell it that I want to pipe that, to select, and I'll tell it I want to select all properties, select *.
Now what we could also do is pipe that command to the select alias and select specifically the properties that we want. So get-azadgroup, let's say, and pipe that to select and say I only want to see the displayname. So we can ask it for which properties we are interested. So that's all we see. Now you might wonder, how do you know it's called DisplayName?
Well, if you're not sure what these properties are called, you can pipe the result of a cmdlet in PowerShell to get-member. And you can ask it for properties, so -type property, otherwise it'll show you properties and methods. And here I can see, indeed, there is a property called DisplayName, and MailNickname, and so on and so forth.
So we can learn about that quite easy. Now another thing that I might be interested in doing is running get-azureadcurrentsessioninfo, it's a long one.
Well, it's actually telling me I need to first run connect-azuread. Okay, let's do that, up arrow. Let's go back to get-azureadcurrentsessioninfo. All right, this is telling me some interesting stuff.
So I can see here the tenant ID for my Azure AD tenant starts with 96421. And if we go back here and check that in the portal, yeah, that looks right, that's correct.
We can also see our domain name. So we aren't using a custom DNS domain here because we've got the .onmicrosoft.com DNS suffix.
We can also run cmdlets here in PowerShell, like get-azureadtenantdetail. And when I do that it's just giving me a little bit of the same type of listing from above, just presented in a different format.
Now, of course, if I want to manage Azure AD objects such as building users, I could also do that by searching up what the appropriate cmdlets are, so get-command. Let's see, I'm assuming it starts with new, and it's probably got user in the name. Looks about right, such as new-AzADUser. And I can take that further, say well, what else can I do with users?
get-command *azaduser*, okay. So I can build a new one. I can retrieve Azure AD users. I can update something about them. I can remove them, and so on.
So if I were to run, get-azaduser, then we can see in fact, it's showing me the user accounts. And just like with the groups, if I really want to, I can pipe that.
For example, to select and tell it what I want to see, which properties. I want displayname.
And in the same way, I can also discover which properties are there with get-member. So piping to get-member -type property. And we can see some of those properties listed there.


Azure AD Users and the Portal
You can use the Azure portal to create Azure AD user accounts.
Now why would you create an Azure AD user account? You would do this so that you have a way to allow people to authenticate, so they can access things like cloud-based apps, and in some cases, depending on your configuration, also on-premises apps. So to get started here in the portal, I'm going to go to Azure Active Directory. I could also launch that from my left-hand navigation menu, it doesn't matter how I get there.
And within my Azure AD tenant, I'm going to click on Users. From here, I'll get a list of existing user accounts.
Now I've got my initial Microsoft Account that reflects my Azure account that I initially set up. However, I'm going to click the New user button to build a new user. Now this user is going to be an Azure AD user, I'm not going to invite them, they are an external user. So I'm going to leave it on Create user.
And for the identity here, I'm going to specify that the username is cblackwell, so Codey Blackwell. And after the add symbol here, it's going to use my DNS domain suffix for my Azure AD tenant, so that's already filled in.
So I'm going to leave that as it is, and then scroll down and just fill in a couple of other details. So Codey Blackwell, that's the full name, and I'll just fill in the first name, the last name.
And down below because we're creating a new account, it asks whether we want to auto-generate the password, or do we want to specify it? I'm going to let it Auto-generate it. I'm just going to choose Show Password and copy it, so I can communicate that to the user.
At this time, we can also determine if the user is going to be a member of a group, and which roles they have, which gives them certain permissions. However, I'm not going to change any of that, I certainly don't want a Block sign in for this user. And I'm not going to fill in any other details. So let's go ahead and click Create to create user Codey Blackwell. And before you know it, the user shows up here in the list of Azure AD users, we're going to go ahead and test logging in as Codey Blackwell.
Now one way to do that is to connect to account.activedirectory.windowsazure.com/, which I will do now.
So I'm going to specify the full email address of the new user, so cblackwell@ and then of course my Azure AD tenant DNS domain name. Now the default is that it will always end with.onmicrosoft.com unless you create custom DNS domain names, but that's the default setting. Let me go ahead and click Next, it's going to ask me for the password. So I'm going to go ahead and put in the auto-generated password that I previously copied and I'll choose Sign in.
Now, of course it wants me to change the passwords, so I'll put in the existing auto-generated password, and I will specify a new password and confirm it. And then I'll click Sign in. And when it asks me to stay signed into my web browser, I'll just choose No.
And we can now see that we are successfully signed in as user Codey Blackwell as part of the QUICK24X7 Azure AD tenant.


Azure AD Users and the CLI
Not only can you use the Azure portal to create and manage Azure AD user accounts, but you can also do this using the Azure CLI.
The CLI can also be spawned here in the Azure portal as opposed to running it on-premises, and that's how I'm going to run it. So here in the portal, I'm going to click the Cloud Shell icon at the top in the bar. And I'm going to make sure I'm in a PowerShell session which allows me to run PowerShell cmdlets as well as Azure CLI commands.
And the first thing I'm going to want to do here is, create an account in Azure AD. So to do that, I'm going to run az ad user, now there is a space between each of those words. Now if I'm not sure where to progress from here I can use the -h to get help with the next level commands.
It looks like create as opposed to add or new. And I could also use the up arrow key, to bring up the previous command and we know that creates the next level part of the syntax, okay. But what after that, I don't know what to put in. Well, we could use -h and we can learn more about the various parameters that we could specify to create the user.
So we can see arguments like display-name, password, user-principal-name, force-password-change-next-login, and so on. So this gives us enough to get started. So az ad user create --display-name and in this case, let's say I'm going to create a user whose name will be "Jen Hill" -- user-principal-name. It's going to be jhill@ and then I have to put in the DNS domain suffix for my tenant. Now if I'm not sure what that is, I can, for example, let's minimize this, click to open up my left-hand navigator menu.
Go to Azure Active Directory, there's much ways to view this, of course. And in the Overview, I'll see the entire name.
So in this case, it's quick24x7test.onmicrosoft.com. So, .onmicrosoft.com is the default DNS suffix unless you've created a custom DNS domain name for your tenant, which I haven't. Let's go back into the CLI here. I'm just going to go ahead and paste that right in there. So we're just going to right click and choose Paste. Okay, that part is in there. Next thing I want to do is, specify the passwords. So I can do that with --password and I'm going to tell that within double quotes, a specific password that I want to use. Okay, and once I've done that, I can press Enter to create the user account.
Now if I don't have a password that complies with password complexity requirements, as we can see has not been done here, then I'm going to have to come up with something different. So I'm going to use the up arrow key and specify a different password for this account. Now once I filled in that password, we can go ahead and try to see if it will accept our newly created password.
This time, we didn't get the red error message, so it looks good. And as a matter of fact, let's just minimize Cloud Shell for a second. Let's just check our work here in the GUI.
So in my Quick24x7 Azure AD tenant, if I go to the Users view, among other users that already might have been there, we'll see the newly created Jen Hill.
So let's go back into the CLI and poke around a little bit. I'm going to clear the screen. So if I were to run az ad user list, it'll list my Azure AD users, but notice what we get returned all of the properties.
And at this level, we'd have to scroll through to find exactly what we wanted to see. I don't want to have to do that, there's got to be a better way. So let me clear the screen with the clear command. I could do stuff like this. I could say az ad user list. And if you're a UNIX or a Linux shell scripting person or just a command line person, you could pipe it to the grep line filtering command and tell it what you want to see. For example, all I want to see is the mailNickname property. So only show me those lines. And sure enough, it looks like it's working.
However, you could also do some CLI-specific stuff. What I mean by that is you could run, for example, az ad user list and you could use --query. This will work with anything in the CLI to query something out. Now, the problem is, it's not a problem, but if I were to just assume I could put in the property name, mailNickname, then I would get a whole lot of nothing.
However, you may say well maybe it's case sensitive, it's not going to make a difference. So if I just put it all lowercase, still nothing.
And the reason is because if you think about the command output, it's returning more than one item. It's returning an array or a collection of users and you need to reference that before the property names. So up arrow key to bring up previous command and I'm going to put an open and close square bracket to reference the fact that we're dealing with an array. Dot, to separate the array item, the user, from the property, in this case mailnickname. And I'll go ahead and press Enter.
Now, again, if I change the n in nickname to a capital N because it is case sensitive, we can now see that it's returning the mailNickname. So there are a few things then, that we can do using the Azure CLI to work with user accounts in Azure AD.


Azure AD Users and PowerShell
You can use PowerShell cmdlets to create and manage Azure AD user accounts.
Of course, you could also use the portal, as we see here to create new users, or to click on existing users to make changes to any properties and so on. Now, here I'm going to click on Cloud Shell at the top of the bar here in my Azure Portal screen.
And I'm going to make sure I'm in PowerShell, where I can run both PowerShell cmdlets and Azure CLI commands.
Now I could download PowerShell locally on my computer, but I'm going to choose to use the Cloud Shell here instead. Now, the first thing I need to figure out is what might the name of the cmdlet be if I want to add a new Azure Active Directory user? So I can figure that out using get-command. For example, get-command. Maybe I'll use an asterisk. And maybe I'll put in azaduser. That's a guess, I'm assuming that would be part of the name. Otherwise I could try different variations.
But luckily this looks reasonable. I've got a New-AzADUser cmdlet as opposed to add or anything like that or create.
Well, that's good news, because now I can get help about that cmdlet now that I know what it's called. So I might run get-help and I might ask for help for the new-azaduser cmdlet, maybe even ask for details, -details. Or detail in singular rather not details. And here I can see that it's returned back the information that I wanted for this, so it gives me a brief synopsis, creates a new active directory user.
Now, that's true specifically in Azure and I get a sense of how the syntax would be used. And what's important here because there could be a lot of parameters is that it explains each and every one of them. And even more handy, as I go way down. I have some examples of how we might actually create, a new Azure Active Directory user. We can see here, they are converting a regular string for a password to a secure string using the ConvertTo-SecureString cmdlet, before they actually build the new user and pass the password with the -Password priority.
You can see the variable they're using here is $SecureStringPassword.
Variables in PowerShell, are always prefixed with a dollar sign. So we have some great help here.
So let's clear the screen, let's make it happen. First thing I want to do, is make a password very long. So going to call it $pw for password. And I'm going to put in =, and I'm going to run the convertto-securestring cmdlet. And I'm going to use the -string parameter. And I'm going to specify the password that I want to use for this. Let's say it's something like this. So I'm specifying the password here within double quotation marks. It's plain text, so -asplaintext and I'm going to -force this, and I'm going to press Enter.
So if I just do $pw to see what's in that variable, it doesn't even return the actual password, that's the point, it's been converted to a secure string item, and I can pass that, to the new-azaduser cmdlet.
So I'm going to set -displayname, let's say here -displayname to a user Sharon Bishop. Creating Sharon Bishop the -userprincipalname will be determined by well first of all it's going to be determined by organizational naming conventions but in this case it's going to be sbishop@ and then the DNS name of my Azure AD tenant. And I'll just close the double quotes after that and I'll specify -password and this is where we're I'm going to pass it my variable. So $pw, which we know from above is a secure string representation of the password I specified up above.
Now it requires the MailNickname parameters. So because I did not supply it, it asks for it. Let's cancel out of that just for fun.
And I'll clear the screen. If I were to use the up arrow key to bring up the new-azaduser cmdlet, we could add the -MailNickname parameter. So -mailnickname. Let's say it's just going to be sbishop. And if I press Enter, it creates the account and doesn't ask me anything. Now that's going to be an important thing to consider mandatory parameter values when it comes to trying to automate some of these things.
Let's just check our work. First of all here, directly in the portal since we have it opened up, let's go to the users view of our Azure AD tenant. Indeed we can see Sharon Bishop has been created.
But let's go back into PowerShell for a second. Because there are some cmdlets that we can use, for example, get-azaduser to check to see what's in our Azure AD tenant.
We can see the last user here, of course, is user Sharon Bishop. Of course in PowerShell, we can start filtering out what we want to see. So for example, get-azaduser, we can pipe the result of a PowerShell command using the pipe symbol, the vertical bar symbol. Now most keyboards you can get that symbol by shifting your backslash key. I can then refer to select and tell it what I want to see. Let's say I want to see the display name property. You have to know what the properties are called comma, and the id.
So there's the display name and there's the internal Id identifier for the Azure AD user accounts. So we have the option then of using a number of PowerShell cmdlets for managing. Azure AD users, and we can take that a step further. So let's clear the screen. Remember how we ran get-command. So I'm going to use wildcards here and going to put azaduser. We used New-AzADUser and Get-AzADUser.
But if you want to make modifications to a user account, you could use Set-AzADUser. You could also remove accounts also using Remove-AzADUser. So there are a lot of options that are available. So for example, let's say we wanted to change Sharon Bishop's last name, I could use update -azaduser and I could specify the -objectId. So we're going to have to go back to a previous command to see what Sharon Bishop's ID is, there it is right there.
I'm going to go ahead and copy that to my clipboard, let's clear the screen here and let's try this, let's run update-azaduser-objectid.
And here I'll just right-click and paste Sharon Bishop's ID. And let's say I want to change the display names, so -displayname. And now I want it to be Sharon and for lack of a better choice, just so we can illustrate the example, her last name will now say changed. So Sharon Changed. And if we do that looks like, it took let's kind of use our up arrow key to go back to get-azaduser. And indeed we can see Sharon's last name is now changed.

                    
Azure Guest Users
User accounts in Azure AD provide accountability. Everyone would have their own account that they would use to sign in, to access cloud based apps. Or in some cases even on-premises based apps. But sometimes the users that you want to participate in that kind of, functionality already have an account with an external provider. Let's talk about how to add guest user in Azure AD.
So here on the portal, I'm going to navigate to Azure Active Directory and then into the Users view.
Now, I'm going to go ahead and click the New guest user button, up at the top of the All users view. Although, technically, if I were just to click New user, the first part of the wizard is whether you want to create the user directly in Azure AD. Or you want to invite them, inviting is the same as just clicking the guest user button, it doesn't make a difference.
Let's go back to the All users view. I'm going to click the New guest user button up at the top.
So the first thing I have to do is fill in some details, who is this user? I'm just going to call this user Fake External user. And I'm going to specify an email address for an account. Now, I have a sample account that I can use here. It's a Hotmail account. So I'm going to go ahead and specify that information. And I'll just put some information in here for the first and last names.
And I can also personalize the message. Welcome! You can join us to access APP1. I did just as an example. I could also specify the group and role affiliation for this account. The roles will be important when it comes to permissions that might be required by that account. I don't want to block the sign in or anything like that. I'm not going to fill in job information. I'm just going to click Invite. And it's inviting the users. So the next thing to do is to check that person's mail account.
In that users inbox, I'm going to have a Microsoft Invitation messages that says, You're invited to the QUICK24X7 organization.
How nice is that? And there's my personalized message. Welcome! You can join us to access APP1. And the user can click the Get Started button. This is what the user will then see. So review the permissions here.
I'm going to accept all of this. I'll click Accept. And it automatically takes that user to Access Panel Applications that might have been made available for this user to access, in the QUICK24X7 Azure Active Directory tenant. Of course, there are no applications configured, but the user is successfully signed in.
Back here in the Azure portal, when we take a look at our list of users in our Azure AD tenant, we can see our Fake External User. Notice the icon is a little bit different because they aren't actually a part of Azure Active Directory.
Here we can see, we have a user that just says Microsoft Account. That's the original accounts that signed up for Azure.
Then we've got a couple of users created in Azure Active Directory. And then we've got our User type of Guest. 
If you're a PowerShell person, so I'm just going to launch Cloud Shell up here in the portal. You might also run connect-azuread.
And then from there, you might run a command like to review guest users, just make sure it took. So get-azureaduser -filter. And I'm going to put in quotes usertype eq and single quotes Guest, that's what I'm looking for. So I'll spell that correctly. Close the single quote, close the double quote. And I'll press Enter. 
And indeed, we can see that our Fake External User is the only account that shows up here.


Azure Bulk User Create
When you have multiple Azure AD user accounts that you need to create, you could create them one at a time, such as in the GUI, but there's a better way.
You could of course also write a script in PowerShell or in the CLI, but we're going to use the bulk create option. So to get started here in the portal, I'm going to navigate to Azure Active Directory and specifically, I'm going to go to the Users view.
I'm going to see any existing users but I've got a Bulk create button at the top. Now that's used when you want to essentially import a number of Azure AD or Azure Active Directory users. Whereas Bulk invite is for external users that you want to invite to participate. So I'm going to choose Bulk create, I can then Download a CSV template. I've already done this and edited it, I've populated it. Let's take a look at that.
Now I'm using Microsoft Excel where I've added the required information but you need to make sure you save it as a CSV file, which I've done. Here it says some of your features in your workbook might not be available. That's okay, it needs to be CSV. So yes, I want to use that format. So what you get in this template when you download it is the version number at the top and then all of these column headers. And you need to leave that stuff in there. Notice some of these column headers have an asterisk. Well, that means that it's required information. So things like First name, Last name, Job title, Department, that stuff isn't required to create the account in Azure AD. But the Name, the User name, and also the Initial password and whether the account is enabled, that is needed. So I've got that stored in a file, called Azure_BulkUserCreate_Users. Let's bring that into Azure AD. Now what you're looking for here is it to say, File uploaded successfully.
If there's a problem, maybe you deleted the header row from the file or perhaps you didn't specify something that's required as denoted with the asterisk, you'll see it here listed in red. So at this point, I'm going to click Submit. We can see currently, it's in progress. Now naturally, it might take a while if you have a lot of users that you're creating all at the same time. You can also, as it says, click to view the status of each operation. So when you do that, it takes us to the Bulk operations results, part of our Azure AD tenant. Here it says it's Completed with no errors. That was quick.
And we have our message up here that popped up in the upper right, in the notification area that tells us the same type of thing. Let's go to the All users view to see if our two new users exist. And they do, there's Lucas Brenner and there's Marcia Lin.


Azure Bulk User Invite
In Azure AD, inviting users is different than creating them. When you create a user, you create them directly so that, they actually exist in the Azure AD tenant. But when you invite a user, you're inviting an external account, usually by sending an invitation email message. We're going to take a look at how to perform a bulk user invite in Azure AD.
So to get started, let's flip over to Azure Active Directory. And what we're going to do is go to the Users view. And when we're in the All users view, we have a Bulk invite option.
However, if we click on it, it opens up another page that talks about the fact, that the feature has been temporarily disabled. 
So instead you should look at some PowerShell solutions for doing that, which is exactly what we're going to do here.
To do a bulk invite, you need to have a CSV file that's formulated in this manner.
With the Name column at the top, and then the InvitedUserEmailAddress following it to the right, under which you then populate your data. Now, I'm doing this in Microsoft Excel, which is fine. You can use any application, just make sure you save it as a CSV. So having done that, we can then flip over to PowerShell and use this file to perform the bulk invite. It's not really a bulk invite, there's only one entry in here, but it really is the same thing whether you've got one or a thousand.
Here in the PowerShell ISE, I've got a script to do the bulk invite. In line 1, I'm connecting, using the Connect-AzureAD, to my tenant domain. So I'll use the -TenantDomain parameter, and I'm specifying my Azure AD tenant.
And then creating a variable called users, variables in PowerShell are always prefixed with the dollar sign. The users variable will store the result of running import-csv. And I'm going to specify the location and name of the file that we just looked at, the CSV file.
Then I'm creating a variable called custom underscore message or msg. That is going to be a result of instantiating a new object of type Microsoft.Open.MSGraph.Model.InvitedUserMessageInfo, it's quite a mouthful.
Next thing we're doing for that instantiated object variable custom_msg is we're calling upon the dot custom message body property. And it's going to have a little custom welcome message, says, Hello. You are invited to the Quick24x7 organization, or something like that.
Then I need a loop, because I need to process all of the entries in the import file, whether it's one, which is in our case, or a 1,000. So I'm using a foreach loop, and in parentheses, I'm creating a temporary placeholder variable here. I'm calling $email, could be called anything, that's what we're going to use to reference each entry in the imported CSV file within the loop. And that is going to be gathered from looking at the $users variable above. Which would contain, again, either one or thousands of users, whatever's in the file. So within the loop we've got the opening and closing curly braces. And then I'm calling upon New-AzureADMSInvitation. And I'm using a number of parameters, -InvitedUserEmailAddress. I call upon the $email variable. That's our looping variable, that will contain the current entry from the CSV file. And I'm calling upon the .InvitedUserEmailAddress property, which is really just a column header in the CSV file. Doing the same type of thing for the DisplayName. I'm setting a redirect url for that user to myapps.microsoft.com. Setting the InvitedUserMessageInfo to my custom_msg variable, and SendInvitationMessage is being set to $true.
Okay, so having done that, let's go ahead and run the script by clicking the Run Script button up at the top. Now, if I haven't already signed in in this PowerShell ISE session, I'll be prompted to sign in with my Azure account credentials. So I'm going to go ahead and do that.
And after a moment, we'll see that it looks like the script has executed and the message has been sent. It says the Status is PendingAcceptance. Let's start by taking a look at our Azure AD tenant in the portal to see if this user even shows up there.
Here in the Portal, I'm already looking at the All users view in Azure AD.
Let's just click Refresh. And there's our Fake User account, fakeuser173@hotmail.com. Let's just check that person's email address, or email account rather, to make sure they received the invitation.
Here in their account, we have an invitation, a Microsoft Invitations. And we can see here Hello. You are invited to the Quick24x7 organization. So it looks good, the user has been invited. They would just continue following through the process by clicking the Get Started button, which I'll do here. It will then prompt them to Accept. So it's gone to the Access Panel for applications for that user.


Multifactor Authentication
Multifactor Authentication, otherwise known as MFA, enhances user sign in security. How does it do this? If I'm logging in with a username and a password, isn't that MFA? It's two things, it's not because it's one category. It's something you know. So the idea here is to use additional authentication factors, such as requiring the possession of a smart card in addition to username and password. Or maybe having a pin sent as an SMS text message to a phone in addition to a username and password, you have to possess the phone. So that would constitute Multifactor Authentication.
So out-of-band authentication codes means that, some kind of authentication code is being sent through an alternate mechanism. So you might be using a web browser to try to authenticate to Azure. And you might need to specify username and password in that browser, and that's fine. But as MFA might be configured, you might be sent a six-digit PIN to your phone through an SMS text message that you would then also have to enter. It's out of band, because it's not being transmitted through the web browser. Some other communication mechanism. So then, this is more secure than only a username and password, which can be guessed or brute forced by malicious users. Multifactor Authentication then combines two or more categories, so something you know plus something you have. Or it could be something you know, like a username and password, plus something you are, like a fingerprint scan. Or it could be something you have, like a smart card, and something you do, like a certain type of gesture-based authentication on a touchscreen. So with Multifactor Authentication, or MFA, whatever the configuration is, all of the factors get validated at the same time. 
And you can also use the Microsoft Authenticator app, as a form of Multifactor Authentication where codes are sent. So it's an MFA software app. Alternatively, you could just use whatever app is used for texting on your smart phone as another mechanism to receive a six-digit PIN that would be used in conjunction with the username and password to fulfill MFA requirements. So in the case of some MFA software apps, you might get a six-digit PIN that is only good for 30 seconds. Whereas if you opt for an SMS text messaging mechanism, then it would send you the six-digit PIN that doesn't expire within 30 seconds. You have a number of options available.


Azure User MFA
You can use the Azure portal to enable MFA or Multifactor Authentication for Azure AD users. Now you would do this to enhance sign in security. So that instead of just a username and password to get into Azure, they would need another factor. Such as a six-digit PIN sent to an authenticator app on a smartphone.
I'm going to enable MFA for user Codey Blackwell here in Azure AD. Now I'm looking at my list of all users in my Azure AD Tenant. Notice across the top we have a series of buttons. And one of the things that we can do here, if we click the three dots or the More button, is we'll see other options including Multi-Factor Authentication. Now you might not need to click the three dot button if your screen resolution is set such that everything can be spread across the screen. Either way, I'm going to click Multi-Factor Authentication. Now when I do that it opens up a new window, it'll show me my users.
And I can look into the MULTI-FACTOR AUTH STATUS column to see if it's Enabled or Disabled or actually being enforced. If the user has signed in, since it's been Enabled. So for user Codey Blackwell, clearly it's Disabled. So I'm going to turn on the check mark for Codey Blackwell.
And over on the right I'm going to click the Enable link.
And I'll click enable multi-factor auth. And after a moment it's done, it says Updates successful. I'll click Close. And notice that the MULTI-FACTOR AUTH STATUS column for Codey now shows Enabled. So what we're going to do is, we're going to log in as user Codey Blackwell. So I'm going to go ahead and connect to the My Apps type of panel here in Azure.
And that means I'm going to try to connect to account.activedirectory.windowsazure.com/. Where I'm going to Sign in as my user, cblackwell@, and then my DNS domain name for my Azure AD tenant. I'll click Next. Of course, I'm going to have to put in a password. So I'll do that. And it says, more information is required. Well, that makes sense because we've now just enabled MFA for this account. So I'll go ahead and click Next. So, it wants some Additional security verification information.
So I'm going to specify some details about the phone that I'm going to use. I'll specify the country or region, the phone number. And I'm going to have it, Send me a code by text message. This is going to be the additional Multifactor Authentication factor. So I'm going to go ahead and enter in the six digit code that was texted to my phone, my smartphone number. And I'll click Verify. Then I'll click Done. And at this point it takes me into my Access Panel Application, so we're signed in. But let's test this again. Let's sign out from being logged in as Codey and let's try it again from scratch now that MFA is completely set up. So I'm just going to go ahead and Sign out from that account.
So I'm going to sign back in again, same email address for Codey Blackwell. I'll put in the password for the account. And now it says we've texted your phone with the code. So you need to enter that to sign in. Okay, that's the Multifactor Authentication. So I'm going to put in the code here. And then I will click Verify. I don't want to stay signed in, so I'll choose No. And after a moment, I'm back at the Access Panel Applications screen. So there are many different mechanisms by which a code like that can be received. But in this case, it's just being sent through SMS text. Now, back here in the portal, looking at my All users view in my Azure AD Tenant, let's go back into Multi-Factor Authentication. Notice now that for user Codey Blackwell, it used to be Enabled, but now it's Enforced.
Because that user had signed in since MFA was Enabled.


